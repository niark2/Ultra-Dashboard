var Ne=Object.defineProperty;var S=(l,e)=>()=>(l&&(e=l(l=0)),e);var qe=(l,e)=>()=>(e||l((e={exports:{}}).exports,e),e.exports),Oe=(l,e)=>{for(var t in e)Ne(l,t,{get:e[t],enumerable:!0})};var G,me=S(()=>{G=class{constructor(){this.navItems=document.querySelectorAll(".nav-item"),this.tabContents=document.querySelectorAll(".tab-content"),this.currentTab="convert",this.init()}init(){this.navItems.forEach(e=>{e.addEventListener("click",()=>{if(e.disabled)return;let t=e.dataset.tab;this.switchTab(t)})}),document.addEventListener("switch-tab",e=>{e.detail&&e.detail.tab&&this.switchTab(e.detail.tab)})}switchTab(e){document.querySelectorAll(".nav-item").forEach(s=>{let i=s.dataset.tab===e;if(s.classList.toggle("active",i),i){let n=s.closest(".nav-section");n&&n.classList.remove("collapsed")}}),this.tabContents.forEach(s=>{s.classList.toggle("active",s.id===`tab-${e}`)}),this.currentTab=e,console.log(`Tab switched to: ${e}`),document.dispatchEvent(new CustomEvent("tab-changed",{detail:{tabId:e}}))}}});var q,R,re,le,k,Q=S(()=>{q=l=>{if(l===0)return"0 B";let e=1024,t=["B","KB","MB","GB","TB"],s=Math.floor(Math.log(l)/Math.log(e));return parseFloat((l/Math.pow(e,s)).toFixed(2))+" "+t[s]},R=l=>q(l)+"/s",re=l=>{if(!l||l<=0)return"0:00";let e=Math.floor(l/3600),t=Math.floor(l%3600/60),s=Math.floor(l%60);return e>0?`${e}:${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${t}:${s.toString().padStart(2,"0")}`},le=l=>{if(l>=864e4)return"\u221E";if(l<=0)return"Termin\xE9";let t=Math.floor(l/3600),s=Math.floor(l%3600/60);return t>0?`${t}h ${s}m`:s>0?`${s}m`:`${l}s`},k=()=>{window.lucide&&window.lucide.createIcons()}});var H,he=S(()=>{H={en:{Accueil:"Home",MULTIM\u00C9DIA:"MULTIMEDIA",Convertisseur:"Converter",Downloader:"Downloader","INTELLIGENCE ARTIFICIELLE":"ARTIFICIAL INTELLIGENCE","Image AI":"Image AI","Speech-to-Text":"Speech-to-Text","AI Chat":"AI Chat",Plexus:"Plexus",UTILITAIRES:"UTILITIES","Metadata Editor":"Metadata Editor",Torrents:"Torrents",LocalDrop:"LocalDrop",Toolbox:"Toolbox",Notifications:"Notifications",Databank:"Databank",R\u00E9glages:"Settings",D\u00E9connexion:"Logout",G\u00E9n\u00E9ral:"General",Navigation:"Navigation","Outils & IA":"Tools & AI",Serveurs:"Servers",S\u00E9curit\u00E9:"Security","Variables d'env":"Env Variables","\xC0 propos":"About","Personnalisez votre exp\xE9rience Ultra Dashboard":"Customize your Ultra Dashboard experience",Apparence:"Appearance","Th\xE8me Sombre":"Dark Theme","Basculez entre le mode sombre et le mode clair":"Switch between dark and light mode","Couleur d'accentuation":"Accent Color","Choisissez la couleur principale de l'interface":"Choose the primary interface color",Interface:"Interface","Animations r\xE9duites":"Reduced Motion","D\xE9sactive les animations pour plus de fluidit\xE9 sur les vieux PC":"Disables animations for better performance on old PCs","Barre lat\xE9rale r\xE9duite":"Compact Sidebar","Affiche uniquement les ic\xF4nes dans la barre lat\xE9rale":"Only show icons in the sidebar",Langue:"Language","Choisissez la langue de l'interface":"Choose the interface language",Syst\u00E8me:"System","Notification de fin":"Completion Notification","\xC9mettre un son quand une conversion est termin\xE9e":"Play a sound when a conversion is finished","Cache local":"Local Cache","Vider le cache des fichiers temporaires":"Clear temporary files cache","Vider le cache":"Clear Cache","Bienvenue sur Ultra Dashboard":"Welcome to Ultra Dashboard","Votre espace de productivit\xE9 personnel":"Your personal productivity space","Ajouter un widget":"Add widget","Widget Store":"Widget Store",Horloge:"Clock","Affiche l'heure et la date":"Display time and date",M\u00E9t\u00E9o:"Weather","Pr\xE9visions locales":"Local forecasts",Actions:"Actions","Raccourcis rapides":"Quick shortcuts",Syst\u00E8me:"System","Status du PC":"PC Status",Notes:"Notes","Bloc-notes rapide":"Quick notepad","Statut T\xE9l\xE9chargements":"Download Status","Progr\xE8s YouTube/Torrent":"YouTube/Torrent progress",Actualit\u00E9s:"News","France Info en direct":"France Info live","Ultra Dashboard - Productivit\xE9":"Ultra Dashboard - Productivity","Dashboard de productivit\xE9 tout-en-un : conversion de fichiers, t\xE9l\xE9chargement YouTube, suppression d'arri\xE8re-plan, transcription audio.":"All-in-one productivity dashboard: file conversion, YouTube download, background removal, audio transcription.","Recherche intelligente avec sources v\xE9rifi\xE9es en temps r\xE9el":"Intelligent search with real-time verified sources","Explorez le web avec l'intelligence artificielle":"Explore the web with artificial intelligence","Deep Research":"Deep Research","Posez votre question...":"Ask your question...","Actualit\xE9s tech":"Tech news","Quelles sont les derni\xE8res actualit\xE9s tech ?":"What are the latest tech news?","Explique-moi la cryptographie quantique":"Explain quantum cryptography to me","Science & Tech":"Science & Tech","R\xE9sume les derni\xE8res d\xE9couvertes en IA":"Summarize the latest discoveries in AI","Intelligence Artificielle":"Artificial Intelligence","Quel est le cours du Bitcoin aujourd'hui ?":"What is the price of Bitcoin today?","Finance & Crypto":"Finance & Crypto","Analyse en cours":"Analysis in progress","Recherche sur le web...":"Searching the web...","Questions li\xE9es":"Related questions",Sources:"Sources","Convertisseur de fichiers":"File Converter","Convertissez vos images, audio et vid\xE9os en un clic":"Convert your images, audio and videos in one click","Glissez votre fichier ici":"Drop your file here","ou cliquez pour s\xE9lectionner":"or click to select",Retirer:"Remove","Convertir en :":"Convert to:","Compresser le fichier":"Compress file","R\xE9duit la taille du fichier (qualit\xE9 optimis\xE9e)":"Reduces file size (optimized quality)",Convertir:"Convert",Sauvegarder:"Save","Conversion en cours...":"Conversion in progress...","Conversion r\xE9ussie !":"Conversion successful!","Media Downloader":"Media Downloader","T\xE9l\xE9chargez des vid\xE9os et musiques de YouTube, TikTok, Instagram, Twitter et plus":"Download videos and music from YouTube, TikTok, Instagram, Twitter and more","Collez le lien (YouTube, TikTok, Instagram...) ici...":"Paste link (YouTube, TikTok, Instagram...) here...","Multi-Plateforme":"Multi-Platform","Supporte plus de 1000 sites web.":"Supports over 1000 websites.","Audio HQ":"HQ Audio","Extraction MP3 haute fid\xE9lit\xE9 (320kbps).":"High fidelity MP3 extraction (320kbps).","Trim & Crop":"Trim & Crop","D\xE9coupez vos s\xE9quences facilement.":"Trim your footage easily.","T\xE9l\xE9chargements R\xE9cents":"Recent Downloads",Effacer:"Clear","Aucun t\xE9l\xE9chargement r\xE9cent":"No recent downloads","Titre du m\xE9dia":"Media Title",Plateforme:"Platform",Mode:"Mode",Vid\u00E9o:"Video",Audio:"Audio",Qualit\u00E9:"Quality","Auto (Max)":"Auto (Max)",Format:"Format","Options avanc\xE9es":"Advanced Options",M\u00E9tadonn\u00E9es:"Metadata",Miniature:"Thumbnail","Sous-titres":"Subtitles",D\u00E9coupage:"Trimming","(Optionnel)":"(Optional)",T\u00E9l\u00E9charger:"Download","Initialisation...":"Initializing...","D\xE9marrage...":"Starting...","Pr\xEAt !":"Ready!","T\xE9l\xE9chargement...":"Downloading...","T\xE9l\xE9chargement termin\xE9":"Download complete","Le m\xE9dia":"The media","est pr\xEAt.":"is ready.","Enregistr\xE9 dans la Databank !":"Saved to Databank!","Erreur inconnue":"Unknown error","Image AI Tools":"Image AI Tools","Supprimez l'arri\xE8re-plan ou agrandissez vos images avec l'IA":"Remove background or upscale your images with AI","Remove Background":"Remove Background","Upscale Image":"Upscale Image","Serveur REMBG non connect\xE9":"REMBG Server not connected","Le serveur Python doit \xEAtre d\xE9marr\xE9 pour utiliser cette fonctionnalit\xE9.":"Python server must be started to use this feature.",R\u00E9essayer:"Retry","Serveur Upscale non connect\xE9":"Upscale Server not connected","Mod\xE8le IA":"AI Model","Choisissez le mod\xE8le optimal pour vos images":"Choose the optimal model for your images","Mod\xE8le d'IA":"AI Model","Facteur d'agrandissement":"Upscale Factor",D\u00E9bruitage:"Denoising","Glissez vos images ici":"Drop your images here","Traiter les images":"Process Images","Traitement en cours...":"Processing...","V\xE9rification...":"Checking...","Transcrivez vos fichiers audio et vid\xE9o en texte avec Whisper IA":"Transcribe your audio and video files to text with Whisper AI","Serveur Whisper non connect\xE9":"Whisper Server not connected","Mod\xE8le AI Whisper":"Whisper AI Model","Lancer la transcription":"Start Transcription","Transcription en cours...":"Transcription in progress...","R\xE9sultat de la transcription":"Transcription Result","Copier le texte":"Copy text","T\xE9l\xE9charger .txt":"Download .txt","Nouveau fichier":"New File","AI Chat / PDF Expert":"AI Chat / PDF Expert","Discutez avec l'IA ou posez des questions sur vos documents":"Chat with AI or ask questions about your documents","Document Context":"Document Context","Ajouter un PDF":"Add PDF","Retirer le document":"Remove document","Effacer l'historique":"Clear History","Bonjour ! Je suis Ultra AI. Comment puis-je vous aider aujourd'hui ?":"Hello! I am Ultra AI. How can I help you today?","Vous pouvez m'envoyer un PDF via la barre lat\xE9rale pour que j'y r\xE9ponde pr\xE9cis\xE9ment.":"You can send me a PDF via the sidebar so I can answer precisely.","Posez votre question ici...":"Ask your question here...","Posez votre question":"Ask your question","\xC9ditez les m\xE9tadonn\xE9es de vos fichiers localement (Audio, Images, Vid\xE9os)":"Edit file metadata locally (Audio, Images, Videos)","Parcourir...":"Browse...","Chemin du dossier (ex: C:\\Musique\\Album)":"Folder path (ex: C:\\Music\\Album)",Scanner:"Scan","Appliquer les modifications":"Apply changes","Magic Auto-Tag":"Magic Auto-Tag","0 fichiers charg\xE9s":"0 files loaded","Filtrer...":"Filter...",Fichier:"File",Titre:"Title",Artiste:"Artist",Album:"Album",Genre:"Genre",Ann\u00E9e:"Year","Aucun dossier s\xE9lectionn\xE9":"No folder selected","Entrez le chemin d'un dossier pour commencer l'\xE9dition.":"Enter a folder path to start editing.","Analyse des fichiers...":"Analyzing files...","Dossier s\xE9lectionn\xE9":"Selected folder",fichiers:"files",modifi\u00E9s:"modified","mis \xE0 jour avec succ\xE8s !":"updated successfully!","Application...":"Applying...","Voulez-vous appliquer les modifications \xE0":"Do you want to apply changes to","fichiers charg\xE9s":"files loaded","Deep Research: Exploration approfondie...":"Deep Research: Deep exploration...","Recherche sur le web...":"Searching the web...","Sources trouv\xE9es":"Sources found","Analyse et synth\xE8se...":"Analysis and synthesis...","R\xE9daction de la r\xE9ponse...":"Drafting answer...","Analyse termin\xE9e":"Analysis complete","Aucune source trouv\xE9e":"No sources found","Erreur lors de la recherche":"Error during search","Torrent Manager":"Torrent Manager","G\xE9rez vos t\xE9l\xE9chargements qBittorrent":"Manage your qBittorrent downloads","Connexion qBittorrent":"qBittorrent Connection","Veuillez vous connecter \xE0 votre interface WebUI":"Please log in to your WebUI interface","Nom d'utilisateur":"Username","Mot de passe":"Password","Se connecter":"Login",Ajouter:"Add","Tout pauser":"Pause All","Tout reprendre":"Resume All","Vitesse de t\xE9l\xE9chargement":"Download Speed","Vitesse d'envoi":"Upload Speed",\u00C9tat:"State",Nom:"Name",Taille:"Size",Progression:"Progress",Vitesse:"Speed","Ajouter un Torrent":"Add Torrent","Coller du presse-papier":"Paste from clipboard","Collez vos liens Magnet ou Hash ici...":"Paste your Magnet links or Hash here...","Partagez des fichiers en P2P avec les appareils sur votre r\xE9seau":"Share P2P files with devices on your network","Mon appareil":"My Device","Scanner pour partager":"Scan to share","Copier l'URL":"Copy URL","Recherche d'autres appareils sur le r\xE9seau...":"Searching for other devices on the network...","Ouvrez Ultra Dashboard sur un autre appareil pour le voir ici.":"Open Ultra Dashboard on another device to see it here.","Transfert en cours":"Transfer in progress","Envoi vers...":"Sending to...","Mega Toolbox":"Mega Toolbox","Une collection d'outils essentiels regroup\xE9s dans une interface \xE9pur\xE9e":"A collection of essential tools grouped in a clean interface","G\xE9n\xE9rateur QR Code":"QR Code Generator","Lien ou texte...":"Link or text...","Votre QR code appara\xEEtra ici":"Your QR code will appear here","T\xE9l\xE9charger l'image":"Download image","G\xE9n\xE9rer le mot de passe":"Generate Password",Longueur:"Length","Outils Texte":"Text Tools","Collez votre texte ici...":"Paste your text here...",Nettoyer:"Clean","0 caract\xE8res":"0 characters","0 mots":"0 words","Devises (Live)":"Currencies (Live)","Taux de change en direct":"Live exchange rates","Miroir Webcam":"Webcam Mirror","Cam\xE9ra d\xE9sactiv\xE9e":"Camera disabled",Activer:"Enable",Capturer:"Capture","S\xE9lectionner une cam\xE9ra...":"Select a camera...","Historique et stockage centralis\xE9 de toutes vos g\xE9n\xE9rations":"History and centralized storage of all your generations","Rechercher...":"Search...","Tous les types":"All types",Images:"Images",Texte:"Text",Actualiser:"Refresh","Tout effacer":"Clear All","Chargement des donn\xE9es...":"Loading data...",Pr\u00E9c\u00E9dent:"Previous","Page 1":"Page 1",Suivant:"Next",Aper\u00E7u:"Preview","Centre de Notifications":"Notification Center","Historique de vos activit\xE9s et t\xE2ches termin\xE9es":"History of your activities and completed tasks","Effacer tout":"Clear All","Aucune notification":"No notifications","Vos nouvelles notifications appara\xEEtront ici.":"Your new notifications will appear here.","\xC0 l'instant":"Just now","Configuration initiale":"Initial Setup","Configuration initiale : cr\xE9ez votre compte.":"Initial setup: create your account.","Votre pseudonyme":"Your username","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022":"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022","Cr\xE9er le compte":"Create Account","Cr\xE9ation de compte":"Account Creation","S'inscrire":"Sign Up","D\xE9j\xE0 un compte ?":"Already have an account?","Se connecter":"Login","Authentification requise":"Authentication Required","Pas de compte ?":"No account?","Cr\xE9er un compte":"Create an account","Traitement...":"Processing...","Erreur de connexion":"Connection Error","Erreur serveur":"Server Error","\xC9l\xE9ments de la barre lat\xE9rale":"Sidebar Items","Choisissez les outils \xE0 afficher dans la barre lat\xE9rale":"Choose which tools to display in the sidebar","Utiliser les regroupements":"Use grouping","Affiche les \xE9l\xE9ments par cat\xE9gories (sections) ou tout en vrac.":"Display items by categories (sections) or all together.","\xC9pingler sous Accueil":"Pin under Home","Databank (Fichiers)":"Databank (Files)","Configuration Plexus AI":"Plexus AI Configuration","Nombre de sources":"Number of sources","Nombre maximum de sources \xE0 utiliser pour les recherches":"Maximum number of sources to use for searches","Informations compl\xE9mentaires":"Additional information","Context ou instructions sp\xE9cifiques pour l'IA":"Context or specific instructions for AI","Ex: Toujours r\xE9pondre en fran\xE7ais, \xEAtre concis...":"Ex: Always answer in English, be concise...","Configuration Remove BG":"Remove BG Configuration","Mod\xE8le par d\xE9faut":"Default model","Choisissez le mod\xE8le de d\xE9tourage utilis\xE9 par d\xE9faut":"Choose the default background removal model","Configuration AI Upscaler":"AI Upscaler Configuration","Mod\xE8le pr\xE9f\xE9r\xE9":"Preferred model","Mod\xE8le utilis\xE9 par d\xE9faut pour l'agrandissement":"Default model used for upscaling","Facteur par d\xE9faut":"Default factor","Facteur d'agrandissement initial":"Initial upscale factor","Speech-to-Text (STT)":"Speech-to-Text (STT)","Mod\xE8le Whisper":"Whisper Model","Taille du mod\xE8le pour la transcription (tiny \xE0 large)":"Model size for transcription (tiny to large)","\xC9tat des Services AI":"AI Services Status","Chargement des serveurs...":"Loading servers...","M\xE9triques Syst\xE8me":"System Metrics",Maintenance:"Maintenance","Logs Serveur":"Server Logs","Voir les journaux d'activit\xE9 en temps r\xE9el":"View real-time activity logs","Mod\xE8les IA T\xE9l\xE9charg\xE9s":"Downloaded AI Models","Recherche des mod\xE8les...":"Searching for models...","Changement de mot de passe":"Password Change","Confirmez votre nom d'utilisateur":"Confirm your username","Votre nom d'utilisateur":"Your username","Mot de passe actuel":"Current password","Saisissez votre mot de passe actuel pour v\xE9rification":"Enter your current password for verification","Nouveau mot de passe":"New password","Choisissez un nouveau mot de passe fort":"Choose a strong new password","Mettre \xE0 jour le mot de passe":"Update password","Configuration des API & Services":"API & Services Configuration","Ces r\xE9glages surchargent les valeurs par d\xE9faut du fichier .env pour votre compte.":"These settings override the default .env file values for your account.","OpenRouter API Key":"OpenRouter API Key","Cl\xE9 API utilis\xE9e pour AI Chat et Plexus":"API key used for AI Chat and Plexus","Mod\xE8le OpenRouter":"OpenRouter Model","Mod\xE8le par d\xE9faut (ex: google/gemini-2.0-pro-exp-02-05:free)":"Default model (ex: google/gemini-2.0-pro-exp-02-05:free)","URL SearXNG":"SearXNG URL","URL de votre instance SearXNG (utilis\xE9e par Plexus)":"URL of your SearXNG instance (used by Plexus)","URL REMBG":"REMBG URL","URL du service Python RemoveBG":"Python RemoveBG service URL","URL Whisper":"Whisper URL","URL du service Python Speech-to-Text":"Python Speech-to-Text service URL","URL Upscale":"Upscale URL","URL du service Python AI Upscaler":"Python AI Upscaler service URL","Fournisseur d'IA":"AI Provider","Choisissez entre OpenRouter (Cloud) ou Ollama (Local)":"Choose between OpenRouter (Cloud) or Ollama (Local)","URL Ollama":"Ollama URL","URL de votre instance locale Ollama":"URL of your local Ollama instance","Mod\xE8le Ollama":"Ollama Model","Nom du mod\xE8le Local (ex: llama3, mistral, deepseek-r1)":"Name of the local model (ex: llama3, mistral, deepseek-r1)","Enregistrer les variables d'environnement":"Save environment variables","Un outil tout-en-un con\xE7u pour la performance et le style.":"An all-in-one tool designed for performance and style.",Documentation:"Documentation",Support:"Support",GitHub:"GitHub","Logs d'activit\xE9 serveur":"Server Activity Logs","Chargement...":"Loading...",Enregistrer:"Save",Annuler:"Cancel",Succ\u00E8s:"Success",Erreur:"Error"},fr:{Accueil:"Accueil",MULTIM\u00C9DIA:"MULTIM\xC9DIA",Convertisseur:"Convertisseur",Downloader:"Downloader","INTELLIGENCE ARTIFICIELLE":"INTELLIGENCE ARTIFICIELLE","Image AI":"Image AI","Speech-to-Text":"Speech-to-Text","AI Chat":"AI Chat",Plexus:"Plexus",UTILITAIRES:"UTILITAIRES","Metadata Editor":"Metadata Editor",Torrents:"Torrents",LocalDrop:"LocalDrop",Toolbox:"Toolbox",Notifications:"Notifications",Databank:"Databank",R\u00E9glages:"R\xE9glages",D\u00E9connexion:"D\xE9connexion",G\u00E9n\u00E9ral:"G\xE9n\xE9ral",Navigation:"Navigation","Outils & IA":"Outils & IA",Serveurs:"Serveurs",S\u00E9curit\u00E9:"S\xE9curit\xE9","Variables d'env":"Variables d'env","\xC0 propos":"\xC0 propos","Personnalisez votre exp\xE9rience Ultra Dashboard":"Personnalisez votre exp\xE9rience Ultra Dashboard",Apparence:"Apparence","Th\xE8me Sombre":"Th\xE8me Sombre","Basculez entre le mode sombre et le mode clair":"Basculez entre le mode sombre et le mode clair","Couleur d'accentuation":"Couleur d'accentuation","Choisissez la couleur principale de l'interface":"Choisissez la couleur principale de l'interface",Interface:"Interface","Animations r\xE9duites":"Animations r\xE9duites","D\xE9sactive les animations pour plus de fluidit\xE9 sur les vieux PC":"D\xE9sactive les animations pour plus de fluidit\xE9 sur les vieux PC","Barre lat\xE9rale r\xE9duite":"Barre lat\xE9rale r\xE9duite","Affiche uniquement les ic\xF4nes dans la barre lat\xE9rale":"Affiche uniquement les ic\xF4nes dans la barre lat\xE9rale",Langue:"Langue","Choisissez la langue de l'interface":"Choisissez la langue de l'interface",Syst\u00E8me:"Syst\xE8me","Notification de fin":"Notification de fin","\xC9mettre un son quand une conversion est termin\xE9e":"\xC9mettre un son quand une conversion est termin\xE9e","Cache local":"Cache local","Vider le cache des fichiers temporaires":"Vider le cache des fichiers temporaires","Vider le cache":"Vider le cache","Bienvenue sur Ultra Dashboard":"Bienvenue sur Ultra Dashboard","Votre espace de productivit\xE9 personnel":"Votre espace de productivit\xE9 personnel","Ajouter un widget":"Ajouter un widget","Widget Store":"Widget Store",Horloge:"Horloge","Affiche l'heure et la date":"Affiche l'heure et la date",M\u00E9t\u00E9o:"M\xE9t\xE9o","Pr\xE9visions locales":"Pr\xE9visions locales",Actions:"Actions","Raccourcis rapides":"Raccourcis rapides",Syst\u00E8me:"Syst\xE8me","Status du PC":"Status du PC",Notes:"Notes","Bloc-notes rapide":"Bloc-notes rapide","Statut T\xE9l\xE9chargements":"Statut T\xE9l\xE9chargements","Progr\xE8s YouTube/Torrent":"Progr\xE8s YouTube/Torrent",Actualit\u00E9s:"Actualit\xE9s","France Info en direct":"France Info en direct","Recherche intelligente avec sources v\xE9rifi\xE9es en temps r\xE9el":"Recherche intelligente avec sources v\xE9rifi\xE9es en temps r\xE9el","Explorez le web avec l'intelligence artificielle":"Explorez le web avec l'intelligence artificielle","Deep Research":"Deep Research","Posez votre question...":"Posez votre question...","Actualit\xE9s tech":"Actualit\xE9s tech","Quelles sont les derni\xE8res actualit\xE9s tech ?":"Quelles sont les derni\xE8res actualit\xE9s tech ?","Explique-moi la cryptographie quantique":"Explique-moi la cryptographie quantique","Science & Tech":"Science & Tech","R\xE9sume les derni\xE8res d\xE9couvertes en IA":"R\xE9sume les derni\xE8res d\xE9couvertes en IA","Intelligence Artificielle":"Intelligence Artificielle","Quel est le cours du Bitcoin aujourd'hui ?":"Quel est le cours du Bitcoin aujourd'hui ?","Finance & Crypto":"Finance & Crypto","Analyse en cours":"Analyse en cours","Recherche sur le web...":"Recherche sur le web...","Questions li\xE9es":"Questions li\xE9es",Sources:"Sources","Convertisseur de fichiers":"Convertisseur de fichiers","Convertissez vos images, audio et vid\xE9os en un clic":"Convertissez vos images, audio et vid\xE9os en un clic","Glissez votre fichier ici":"Glissez votre fichier ici","ou cliquez pour s\xE9lectionner":"ou cliquez pour s\xE9lectionner",Retirer:"Retirer","Convertir en :":"Convertir en :","Compresser le fichier":"Compresser le fichier","R\xE9duit la taille du fichier (qualit\xE9 optimis\xE9e)":"R\xE9duit la taille du fichier (qualit\xE9 optimis\xE9e)",Convertir:"Convertir",Sauvegarder:"Sauvegarder","Conversion en cours...":"Conversion en cours...","Conversion r\xE9ussie !":"Conversion r\xE9ussie !","Media Downloader":"Media Downloader","T\xE9l\xE9chargez des vid\xE9os et musiques de YouTube, TikTok, Instagram, Twitter et plus":"T\xE9l\xE9chargez des vid\xE9os et musiques de YouTube, TikTok, Instagram, Twitter et plus","Collez le lien (YouTube, TikTok, Instagram...) ici...":"Collez le lien (YouTube, TikTok, Instagram...) ici...","Multi-Plateforme":"Multi-Plateforme","Supporte plus de 1000 sites web.":"Supporte plus de 1000 sites web.","Audio HQ":"Audio HQ","Extraction MP3 haute fid\xE9lit\xE9 (320kbps).":"Extraction MP3 haute fid\xE9lit\xE9 (320kbps).","Trim & Crop":"Trim & Crop","D\xE9coupez vos s\xE9quences facilement.":"D\xE9coupez vos s\xE9quences facilement.","T\xE9l\xE9chargements R\xE9cents":"T\xE9l\xE9chargements R\xE9cents",Effacer:"Effacer","Aucun t\xE9l\xE9chargement r\xE9cent":"Aucun t\xE9l\xE9chargement r\xE9cent","Titre du m\xE9dia":"Titre du m\xE9dia",Plateforme:"Plateforme",Mode:"Mode",Vid\u00E9o:"Vid\xE9o",Audio:"Audio",Qualit\u00E9:"Qualit\xE9","Auto (Max)":"Auto (Max)",Format:"Format","Options avanc\xE9es":"Options avanc\xE9es",M\u00E9tadonn\u00E9es:"M\xE9tadonn\xE9es",Miniature:"Miniature","Sous-titres":"Sous-titres",D\u00E9coupage:"D\xE9coupage","(Optionnel)":"(Optionnel)",T\u00E9l\u00E9charger:"T\xE9l\xE9charger","Initialisation...":"Initialisation...","D\xE9marrage...":"D\xE9marrage...","Pr\xEAt !":"Pr\xEAt !","T\xE9l\xE9chargement...":"T\xE9l\xE9chargement...","T\xE9l\xE9chargement termin\xE9":"T\xE9l\xE9chargement termin\xE9","Le m\xE9dia":"Le m\xE9dia","est pr\xEAt.":"est pr\xEAt.","Enregistr\xE9 dans la Databank !":"Enregistr\xE9 dans la Databank !","Erreur inconnue":"Erreur inconnue","Image AI Tools":"Image AI Tools","Supprimez l'arri\xE8re-plan ou agrandissez vos images avec l'IA":"Supprimez l'arri\xE8re-plan ou agrandissez vos images avec l'IA","Remove Background":"Remove Background","Upscale Image":"Upscale Image","Serveur REMBG non connect\xE9":"Serveur REMBG non connect\xE9","Le serveur Python doit \xEAtre d\xE9marr\xE9 pour utiliser cette fonctionnalit\xE9.":"Le serveur Python doit \xEAtre d\xE9marr\xE9 pour utiliser cette fonctionnalit\xE9.",R\u00E9essayer:"R\xE9essayer","Serveur Upscale non connect\xE9":"Serveur Upscale non connect\xE9","Mod\xE8le IA":"Mod\xE8le IA","Choisissez le mod\xE8le optimal pour vos images":"Choisissez le mod\xE8le optimal pour vos images","Mod\xE8le d'IA":"Mod\xE8le d'IA","Facteur d'agrandissement":"Facteur d'agrandissement",D\u00E9bruitage:"D\xE9bruitage","Glissez vos images ici":"Glissez vos images ici","Traiter les images":"Traiter les images","Traitement en cours...":"Traitement en cours...","V\xE9rification...":"V\xE9rification...","Transcrivez vos fichiers audio et vid\xE9o en texte avec Whisper IA":"Transcrivez vos fichiers audio et vid\xE9o en texte avec Whisper IA","Serveur Whisper non connect\xE9":"Serveur Whisper non connect\xE9","Mod\xE8le AI Whisper":"Mod\xE8le AI Whisper","Lancer la transcription":"Lancer la transcription","Transcription en cours...":"Transcription en cours...","R\xE9sultat de la transcription":"R\xE9sultat de la transcription","Copier le texte":"Copier le texte","T\xE9l\xE9charger .txt":"T\xE9l\xE9charger .txt","Nouveau fichier":"Nouveau fichier","AI Chat / PDF Expert":"AI Chat / PDF Expert","Discutez avec l'IA ou posez des questions sur vos documents":"Discutez avec l'IA ou posez des questions sur vos documents","Document Context":"Document Context","Ajouter un PDF":"Ajouter un PDF","Retirer le document":"Retirer le document","Effacer l'historique":"Effacer l'historique","Bonjour ! Je suis Ultra AI. Comment puis-je vous aider aujourd'hui ?":"Bonjour ! Je suis Ultra AI. Comment puis-je vous aider aujourd'hui ?","Vous pouvez m'envoyer un PDF via la barre lat\xE9rale pour que j'y r\xE9ponde pr\xE9cis\xE9ment.":"Vous pouvez m'envoyer un PDF via la barre lat\xE9rale pour que j'y r\xE9ponde pr\xE9cis\xE9ment.","Posez votre question ici...":"Posez votre question ici...","Posez votre question":"Posez votre question","\xC9ditez les m\xE9tadonn\xE9es de vos fichiers localement (Audio, Images, Vid\xE9os)":"\xC9ditez les m\xE9tadonn\xE9es de vos fichiers localement (Audio, Images, Vid\xE9os)","Parcourir...":"Parcourir...","Chemin du dossier (ex: C:\\Musique\\Album)":"Chemin du dossier (ex: C:\\Musique\\Album)",Scanner:"Scanner","Appliquer les modifications":"Appliquer les modifications","Magic Auto-Tag":"Magic Auto-Tag","0 fichiers charg\xE9s":"0 fichiers charg\xE9s","Filtrer...":"Filtrer...",Fichier:"Fichier",Titre:"Titre",Artiste:"Artiste",Album:"Album",Genre:"Genre",Ann\u00E9e:"Ann\xE9e","Aucun dossier s\xE9lectionn\xE9":"Aucun dossier s\xE9lectionn\xE9","Entrez le chemin d'un dossier pour commencer l'\xE9dition.":"Entrez le chemin d'un dossier pour commencer l'\xE9dition.","Analyse des fichiers...":"Analyse des fichiers...","Dossier s\xE9lectionn\xE9":"Dossier s\xE9lectionn\xE9",fichiers:"fichiers",modifi\u00E9s:"modifi\xE9s","mis \xE0 jour avec succ\xE8s !":"mis \xE0 jour avec succ\xE8s !","Application...":"Application...","Voulez-vous appliquer les modifications \xE0":"Voulez-vous appliquer les modifications \xE0","fichiers charg\xE9s":"fichiers charg\xE9s","Deep Research: Exploration approfondie...":"Deep Research: Exploration approfondie...","Recherche sur le web...":"Recherche sur le web...","Sources trouv\xE9es":"Sources trouv\xE9es","Analyse et synth\xE8se...":"Analyse et synth\xE8se...","R\xE9daction de la r\xE9ponse...":"R\xE9daction de la r\xE9ponse...","Analyse termin\xE9e":"Analyse termin\xE9e","Aucune source trouv\xE9e":"Aucune source trouv\xE9e","Erreur lors de la recherche":"Erreur lors de la recherche","Torrent Manager":"Torrent Manager","G\xE9rez vos t\xE9l\xE9chargements qBittorrent":"G\xE9rez vos t\xE9l\xE9chargements qBittorrent","Connexion qBittorrent":"Connexion qBittorrent","Veuillez vous connecter \xE0 votre interface WebUI":"Veuillez vous connecter \xE0 votre interface WebUI","Nom d'utilisateur":"Nom d'utilisateur","Mot de passe":"Mot de passe","Se connecter":"Se connecter",Ajouter:"Ajouter","Tout pauser":"Tout pauser","Tout reprendre":"Tout reprendre","Vitesse de t\xE9l\xE9chargement":"Vitesse de t\xE9l\xE9chargement","Vitesse d'envoi":"Vitesse d'envoi",\u00C9tat:"\xC9tat",Nom:"Nom",Taille:"Taille",Progression:"Progression",Vitesse:"Vitesse","Ajouter un Torrent":"Ajouter un Torrent","Coller du presse-papier":"Coller du presse-papier","Collez vos liens Magnet ou Hash ici...":"Collez vos liens Magnet ou Hash ici...","Partagez des fichiers en P2P avec les appareils sur votre r\xE9seau":"Partagez des fichiers en P2P avec les appareils sur votre r\xE9seau","Mon appareil":"Mon appareil","Scanner pour partager":"Scanner pour partager","Copier l'URL":"Copier l'URL","Recherche d'autres appareils sur le r\xE9seau...":"Recherche d'autres appareils sur le r\xE9seau...","Ouvrez Ultra Dashboard sur un autre appareil pour le voir ici.":"Ouvrez Ultra Dashboard sur un autre appareil pour le voir ici.","Transfert en cours":"Transfert en cours","Envoi vers...":"Envoi vers...","Mega Toolbox":"Mega Toolbox","Une collection d'outils essentiels regroup\xE9s dans une interface \xE9pur\xE9e":"Une collection d'outils essentiels regroup\xE9s dans une interface \xE9pur\xE9e","G\xE9n\xE9rateur QR Code":"G\xE9n\xE9rateur QR Code","Lien ou texte...":"Lien ou texte...","Votre QR code appara\xEEtra ici":"Votre QR code appara\xEEtra ici","T\xE9l\xE9charger l'image":"T\xE9l\xE9charger l'image","G\xE9n\xE9rer le mot de passe":"G\xE9n\xE9rer le mot de passe",Longueur:"Longueur","Outils Texte":"Outils Texte","Collez votre texte ici...":"Collez votre texte ici...",Nettoyer:"Nettoyer","0 caract\xE8res":"0 caract\xE8res","0 mots":"0 mots","Devises (Live)":"Devises (Live)","Taux de change en direct":"Taux de change en direct","Miroir Webcam":"Miroir Webcam","Cam\xE9ra d\xE9sactiv\xE9e":"Cam\xE9ra d\xE9sactiv\xE9e",Activer:"Activer",Capturer:"Capturer","S\xE9lectionner une cam\xE9ra...":"S\xE9lectionner une cam\xE9ra...","Historique et stockage centralis\xE9 de toutes vos g\xE9n\xE9rations":"Historique et stockage centralis\xE9 de toutes vos g\xE9n\xE9rations","Rechercher...":"Rechercher...","Tous les types":"Tous les types",Images:"Images",Texte:"Texte",Actualiser:"Actualiser","Tout effacer":"Tout effacer","Chargement des donn\xE9es...":"Chargement des donn\xE9es...",Pr\u00E9c\u00E9dent:"Pr\xE9c\xE9dent","Page 1":"Page 1",Suivant:"Suivant",Aper\u00E7u:"Aper\xE7u","Centre de Notifications":"Centre de Notifications","Historique de vos activit\xE9s et t\xE2ches termin\xE9es":"Historique de vos activit\xE9s et t\xE2ches termin\xE9es","Effacer tout":"Effacer tout","Aucune notification":"Aucune notification","Vos nouvelles notifications appara\xEEtront ici.":"Vos nouvelles notifications appara\xEEtront ici.","\xC0 l'instant":"\xC0 l'instant","Configuration initiale":"Configuration initiale","Cr\xE9er le compte":"Cr\xE9er le compte","Cr\xE9ation de compte":"Cr\xE9ation de compte","S'inscrire":"S'inscrire","D\xE9j\xE0 un compte ?":"D\xE9j\xE0 un compte ?","Se connecter":"Se connecter","Authentification requise":"Authentification requise","Pas de compte ?":"Pas de compte ?","Cr\xE9er un compte":"Cr\xE9er un compte","Traitement...":"Traitement...","Erreur de connexion":"Erreur de connexion","Erreur serveur":"Erreur serveur","Mod\xE8les IA T\xE9l\xE9charg\xE9s":"Mod\xE8les IA T\xE9l\xE9charg\xE9s","Recherche des mod\xE8les...":"Recherche des mod\xE8les...","Logs d'activit\xE9 serveur":"Logs d'activit\xE9 serveur","Chargement...":"Chargement...",Enregistrer:"Enregistrer",Annuler:"Annuler",Succ\u00E8s:"Succ\xE8s",Erreur:"Erreur"}}});var pe={};Oe(pe,{Storage:()=>m});var m,M=S(()=>{m=class{static async get(e,t=null){try{let n=await(await fetch(`/api/settings/${e}`)).json();if(n.value!==null&&n.value!==void 0&&n.value!==""||n.effectiveValue)return n.value}catch(i){console.warn(`Error fetching setting ${e}:`,i)}let s=localStorage.getItem(e);if(s!==null)try{return JSON.parse(s)}catch{return s}return t}static async getFull(e){try{return await(await fetch(`/api/settings/${e}`)).json()}catch{return{key:e,value:null,source:"error"}}}static async set(e,t){localStorage.setItem(e,typeof t=="object"?JSON.stringify(t):t);try{await fetch("/api/settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:e,value:t})})}catch(s){console.error(`Error saving setting ${e}:`,s)}}static async migrate(){let e={};for(let t=0;t<localStorage.length;t++){let s=localStorage.key(t);if(s.startsWith("ultra-")){let i=localStorage.getItem(s);try{i=JSON.parse(i)}catch{}e[s]=i}}if(Object.keys(e).length!==0)try{(await fetch("/api/settings/batch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({settings:e})})).ok&&console.log("\u2705 Migration to SQLite successful")}catch(t){console.error("Migration failed:",t)}}static async getAll(){try{return await(await fetch("/api/settings")).json()}catch(e){return console.error("Error fetching all settings:",e),{}}}}});var c,P=S(()=>{he();M();c=class{static async init(){let e=await m.get("ultra-language","en");await this.applyLanguage(e)}static async applyLanguage(e){document.documentElement.setAttribute("lang",e);let t=H[e]||H.en,s=document.querySelector("title");s&&t[s.textContent.trim()]&&(s.textContent=t[s.textContent.trim()]);let i=document.querySelector('meta[name="description"]');i&&t[i.content.trim()]&&(i.content=t[i.content.trim()]),document.querySelectorAll("[data-i18n]").forEach(r=>{let d=r.dataset.i18n||r.textContent.trim();t[d]&&(r.tagName==="INPUT"||r.tagName==="TEXTAREA"?r.placeholder&&t[r.placeholder]&&(r.placeholder=t[r.placeholder]):r.textContent=t[d])}),document.querySelectorAll("[data-i18n-placeholder]").forEach(r=>{let d=r.dataset.i18nPlaceholder;t[d]&&(r.placeholder=t[d])}),document.querySelectorAll("[data-i18n-title]").forEach(r=>{let d=r.dataset.i18nTitle;t[d]&&(r.title=t[d])}),this.translateBySelectors(t)}static translateBySelectors(e){[".nav-label",".nav-section-title",".content-header h1",".content-header .subtitle",".settings-group-title",".setting-title",".setting-description",".welcome-text h1",".welcome-text p","#addWidgetBtn",".store-header h2",".store-item h4",".store-item p",".btn-primary",".btn-secondary",".btn-add-widget span",".version",".plexus-tagline",".plexus-suggestion span",".plexus-followup h4",".plexus-sources-title",".plexus-thinking-header span",".thinking-step span",".plexus-logo-text",".tool-title",".drop-text",".drop-subtext",".btn-text",".option-title",".option-desc",".progress-text",".success-message p",".empty-history-text",".history-header h3",".feature-text h4",".feature-text p",".platform-card span",".yt-channel",".yt-info label",".yt-select option",".custom-checkbox",".trim-group label",".checkbox-group label",".header-with-status h1",".server-error h3",".server-error p",".model-label",".model-name",".model-desc",".badge-perf",".result-label",".chat-sidebar .section-title",".pdf-upload-label .text",".message-content",".metadata-table th",".empty-state h3",".empty-state p",".status-info",".login-overlay h3",".login-overlay p",".stat-item",".torrent-header-row div",".modal-title",".device-label",".share-label",".no-devices p",".tool-button",".stat-label-row span",".tool-checkbox",".text-stats span",".mirror-placeholder p",".header-title p","#authSubtitle","#authToggleText","#authToggleBtn","#setupNotice span","#authForm .btn-text"].forEach(s=>{document.querySelectorAll(s).forEach(i=>{let n=Array.from(i.childNodes).filter(a=>a.nodeType===Node.TEXT_NODE);if(n.length>0)n.forEach(a=>{let o=a.textContent.trim();if(o&&e[o]){let r=a.textContent.match(/^\s*/)[0],d=a.textContent.match(/\s*$/)[0];a.textContent=r+e[o]+d}});else{let a=i.textContent.trim();a&&e[a]&&(i.textContent=e[a])}})}),document.querySelectorAll("input, textarea").forEach(s=>{s.placeholder&&e[s.placeholder]&&(s.placeholder=e[s.placeholder])}),document.querySelectorAll(".settings-tab-link").forEach(s=>{Array.from(s.childNodes).filter(n=>n.nodeType===Node.TEXT_NODE).forEach(n=>{let a=n.textContent.trim();if(a&&e[a]){let o=n.textContent.match(/^\s*/)[0];n.textContent=o+e[a]}})})}static t(e){if(!e)return"";let t=document.documentElement.getAttribute("lang")||"en";return(H[t]||H.en)[e]||e}static async setLanguage(e){await m.set("ultra-language",e),window.location.reload()}}});var _,ge=S(()=>{Q();P();_=class{constructor(){this.selectedFile=null,this.selectedFormat=null,this.supportedFormats=null,this.compressEnabled=!1,this.compressQuality=75,this.elements={dropZone:document.getElementById("dropZone"),fileInput:document.getElementById("fileInput"),fileInfo:document.getElementById("fileInfo"),formatSection:document.getElementById("formatSection"),formatGrid:document.getElementById("formatGrid"),convertBtn:document.getElementById("convertBtn"),progressContainer:document.getElementById("progressContainer"),successMessage:document.getElementById("successMessage"),fileName:document.getElementById("fileName"),fileSize:document.getElementById("fileSize"),convertOptions:document.getElementById("convertOptions"),compressToggle:document.getElementById("compressToggle"),saveBtn:document.getElementById("convertSaveBtn")},this.init()}init(){this.loadFormats(),this.elements.dropZone.addEventListener("click",()=>{this.elements.fileInput.click()}),this.elements.dropZone.addEventListener("dragover",t=>{t.preventDefault(),this.elements.dropZone.classList.add("drag-over")}),this.elements.dropZone.addEventListener("dragleave",()=>{this.elements.dropZone.classList.remove("drag-over")}),this.elements.dropZone.addEventListener("drop",t=>{t.preventDefault(),this.elements.dropZone.classList.remove("drag-over");let s=t.dataTransfer.files[0];s&&this.handleFile(s)}),this.elements.fileInput.addEventListener("change",t=>{let s=t.target.files[0];s&&this.handleFile(s)});let e=document.getElementById("removeFile");e&&e.addEventListener("click",()=>this.reset()),this.elements.compressToggle&&this.elements.compressToggle.addEventListener("change",t=>{this.compressEnabled=t.target.checked,this.updateButtonState()}),this.elements.convertBtn&&this.elements.convertBtn.addEventListener("click",()=>this.processFile())}handleFile(e){this.selectedFile=e,this.selectedFormat=null,this.elements.dropZone.classList.add("hidden"),this.elements.fileInfo.classList.remove("hidden"),this.elements.formatSection.classList.remove("hidden"),this.elements.convertOptions.classList.remove("hidden"),this.elements.successMessage.classList.add("hidden"),this.elements.saveBtn.classList.add("hidden"),this.elements.fileName.textContent=e.name,this.elements.fileSize.textContent=q(e.size);let t=document.getElementById("imagePreview"),s=document.getElementById("fileIconLarge");if(e.type.startsWith("image/")){let i=new FileReader;i.onload=n=>{t.src=n.target.result,t.classList.remove("hidden"),s.classList.add("hidden")},i.readAsDataURL(e)}else t.classList.add("hidden"),s.classList.remove("hidden");this.generateFormatButtons(e)}generateFormatButtons(e){let t=this.elements.formatGrid;if(t.innerHTML="",!this.supportedFormats)return;let s=e.type.split("/")[0];(this.supportedFormats[s]||[]).forEach(n=>{let a=document.createElement("button");a.className="format-btn",a.textContent=n.toUpperCase(),a.addEventListener("click",()=>{t.querySelectorAll(".format-btn").forEach(o=>o.classList.remove("active")),a.classList.add("active"),this.selectedFormat=n,this.updateButtonState()}),t.appendChild(a)}),k()}async loadFormats(){try{let e=await fetch("/api/convert/formats");this.supportedFormats=await e.json()}catch(e){console.error("Erreur chargement formats",e)}}updateButtonState(){let e=this.selectedFormat||this.compressEnabled;this.elements.convertBtn.classList.toggle("hidden",!e);let t=this.elements.convertBtn.querySelector(".btn-text");this.selectedFormat&&this.compressEnabled?t.innerHTML=`<i data-lucide="refresh-cw" class="inline-icon"></i> ${c.t("Convertir")} & ${c.t("Compresser")}`:this.compressEnabled?t.innerHTML=`<i data-lucide="package" class="inline-icon"></i> ${c.t("Compresser")}`:t.innerHTML=`<i data-lucide="refresh-cw" class="inline-icon"></i> ${c.t("Convertir")}`,k()}async processFile(){this.elements.convertBtn.disabled=!0,this.elements.progressContainer.classList.remove("hidden");let e=this.elements.convertBtn.querySelector(".btn-text"),t=e.textContent;e.textContent=c.t("Traitement en cours...");let s=new FormData;s.append("file",this.selectedFile),this.selectedFormat&&s.append("targetFormat",this.selectedFormat),s.append("compress",this.compressEnabled.toString()),s.append("quality",this.compressQuality.toString());try{let i=await fetch("/api/convert",{method:"POST",body:s});if(!i.ok){let a=await i.json();throw new Error(a.error||c.t("Erreur lors du traitement"))}let n=await i.json();this.elements.successMessage.classList.remove("hidden"),document.dispatchEvent(new CustomEvent("app-notification",{detail:{title:c.t("Conversion termin\xE9e"),message:`${c.t("Le fichier")} ${this.selectedFile.name} ${c.t("a \xE9t\xE9 trait\xE9 avec succ\xE8s.")}`,type:"success",icon:"refresh-cw"}})),n.databankUrl&&this.elements.saveBtn&&(this.elements.saveBtn.href=n.databankUrl,this.elements.saveBtn.setAttribute("download",n.fileName||"converted-file"),this.elements.saveBtn.classList.remove("hidden"),this.elements.convertBtn.classList.add("hidden"))}catch(i){alert("\u{1F6A8} "+i.message)}finally{this.elements.convertBtn.disabled=!1,e.textContent=t,this.elements.progressContainer.classList.add("hidden")}}reset(){this.selectedFile=null,this.selectedFormat=null,this.compressEnabled=!1,this.compressQuality=75,this.elements.dropZone.classList.remove("hidden"),this.elements.fileInfo.classList.add("hidden"),this.elements.formatSection.classList.add("hidden"),this.elements.convertOptions.classList.add("hidden"),this.elements.convertBtn.classList.add("hidden"),this.elements.successMessage.classList.add("hidden"),this.elements.fileInput.value="",this.elements.compressToggle.checked=!1}}});var Z,fe=S(()=>{Q();P();Z=class{constructor(){this.elements={urlInput:document.getElementById("dlUrl"),searchBtn:document.getElementById("dlSearchBtn"),preview:document.getElementById("dlPreview"),loading:document.getElementById("dlLoading"),thumbnail:document.getElementById("dlThumbnail"),title:document.getElementById("dlTitle"),channel:document.getElementById("dlChannel"),duration:document.getElementById("dlDuration"),downloadBtn:document.getElementById("dlDownloadBtn"),saveBtn:document.getElementById("dlSaveBtn"),modeToggles:document.querySelectorAll(".dl-mode-toggle .toggle-btn"),qualitySelect:document.getElementById("dlQuality"),formatSelect:document.getElementById("dlFormat"),advancedBtn:document.getElementById("dlAdvancedBtn"),advancedPanel:document.getElementById("dlAdvancedOptions"),chkMetadata:document.getElementById("chkDlMetadata"),chkThumbnail:document.getElementById("chkDlThumbnail"),chkSubs:document.getElementById("chkDlSubs"),trimStart:document.getElementById("trimDlStart"),trimEnd:document.getElementById("trimDlEnd"),containerSubtitles:document.getElementById("containerDlSubtitles"),progressContainer:document.getElementById("dlProgressContainer"),progressFill:document.getElementById("dlProgressFill"),progressStatus:document.getElementById("dlProgressStatus"),progressPercent:document.getElementById("dlProgressPercent"),emptyState:document.getElementById("dlEmptyState"),historyList:document.getElementById("dlHistoryList"),clearHistoryBtn:document.getElementById("btnClearDlHistory"),playlistContainer:document.getElementById("dlPlaylistContainer"),playlistList:document.getElementById("dlPlaylistList"),playlistCount:document.getElementById("playlistCount"),btnPlaylistSelectAll:document.getElementById("btnPlaylistSelectAll")},this.currentMode="video",this.currentUrl="",this.mediaInfo=null,this.elements.urlInput&&this.init()}init(){this.elements.searchBtn.onclick=()=>this.fetchInfo(),this.elements.urlInput.onkeypress=e=>{e.key==="Enter"&&this.fetchInfo()},this.elements.modeToggles.forEach(e=>{e.onclick=()=>{this.elements.modeToggles.forEach(t=>t.classList.remove("active")),e.classList.add("active"),this.setMode(e.dataset.mode)}}),this.elements.advancedBtn&&(this.elements.advancedBtn.onclick=()=>{this.elements.advancedPanel.classList.toggle("hidden")}),this.elements.downloadBtn.onclick=()=>this.download(),this.elements.clearHistoryBtn.onclick=()=>this.clearHistory(),this.loadHistory(),this.elements.btnPlaylistSelectAll&&(this.elements.btnPlaylistSelectAll.onclick=()=>this.toggleAllPlaylistEntries()),this.setMode("video")}isYoutube(e){return e.includes("youtube.com")||e.includes("youtu.be")}setMode(e){this.currentMode=e;let t=this.elements.formatSelect;t.innerHTML="",e==="video"?(["mp4","mkv","webm"].forEach(s=>{t.add(new Option(s.toUpperCase(),s))}),this.elements.qualitySelect.disabled=!1,this.elements.chkSubs&&(this.elements.chkSubs.disabled=!1),this.elements.containerSubtitles&&(this.elements.containerSubtitles.style.opacity="1")):(["mp3","m4a","wav","flac","opus"].forEach(s=>{t.add(new Option(s.toUpperCase(),s))}),this.elements.qualitySelect.disabled=!0,this.elements.chkSubs&&(this.elements.chkSubs.disabled=!0,this.elements.chkSubs.checked=!1),this.elements.containerSubtitles&&(this.elements.containerSubtitles.style.opacity="0.5")),this.mediaInfo&&e==="video"&&this.populateQualities(this.mediaInfo.resolutions)}async fetchInfo(){let e=this.elements.urlInput.value.trim();if(!e)return;this.currentUrl=e,this.showLoading(!0),this.elements.preview.classList.add("hidden"),this.elements.emptyState.classList.add("hidden"),this.elements.saveBtn.classList.add("hidden"),this.elements.downloadBtn.classList.remove("hidden");let s=this.isYoutube(e)?"/api/youtube/info":"/api/social/info";try{let n=await(await fetch(`${s}?url=${encodeURIComponent(e)}`)).json();if(n.error)throw new Error(n.error);this.mediaInfo=n,this.updatePreview(n)}catch(i){alert(c.t("Erreur")+": "+i.message)}finally{this.showLoading(!1)}}updatePreview(e){this.elements.thumbnail.src=e.thumbnail||"/img/social-placeholder.png",this.elements.title.textContent=e.title;let t=e.platform?e.platform.toUpperCase():"YOUTUBE";this.elements.channel.textContent=t+(e.channel?` \u2022 ${e.channel}`:""),e.isPlaylist?(this.elements.duration.textContent=`${e.entriesCount} vid\xE9os`,this.renderPlaylist(e.entries),this.elements.playlistContainer.classList.remove("hidden")):(this.elements.duration.textContent=re(e.duration),this.elements.playlistContainer.classList.add("hidden"),this.populateQualities(e.resolutions),this.setMode(this.currentMode)),this.elements.preview.classList.remove("hidden"),this.elements.emptyState.classList.add("hidden")}renderPlaylist(e){this.elements.playlistCount.textContent=`${e.length} vid\xE9os`,this.elements.playlistList.innerHTML=e.map((t,s)=>`
            <div class="playlist-entry" data-index="${s}" data-url="${t.url}">
                <input type="checkbox" class="playlist-entry-checkbox" checked>
                <img src="${t.thumbnail||"/img/social-placeholder.png"}" class="playlist-entry-thumb">
                <div class="playlist-entry-info">
                    <div class="playlist-entry-title">${t.title}</div>
                    <div class="playlist-entry-duration">${re(t.duration)}</div>
                </div>
            </div>
        `).join(""),this.elements.playlistList.querySelectorAll(".playlist-entry").forEach(t=>{t.onclick=s=>{if(s.target.type==="checkbox")return;let i=t.querySelector(".playlist-entry-checkbox");i.checked=!i.checked}})}toggleAllPlaylistEntries(){let e=this.elements.playlistList.querySelectorAll(".playlist-entry-checkbox"),t=Array.from(e).some(s=>!s.checked);e.forEach(s=>s.checked=t)}async addToHistory(e){let t=await this.getHistory(),s={id:Date.now(),title:e.title,thumbnail:e.thumbnail,platform:e.platform||"YouTube",timestamp:new Date().toISOString()};t=t.filter(i=>i.title!==e.title),t.unshift(s),t=t.slice(0,10),localStorage.setItem("ultra-dl-history",JSON.stringify(t)),this.renderHistory(t)}async getHistory(){let e=localStorage.getItem("ultra-dl-history");if(!e){let t=localStorage.getItem("ultra-yt-history"),s=localStorage.getItem("ultra-social-history");if(t||s){let i=[];return t&&(i=i.concat(JSON.parse(t))),s&&(i=i.concat(JSON.parse(s))),i.sort((n,a)=>new Date(a.timestamp)-new Date(n.timestamp)),i=i.slice(0,10),localStorage.setItem("ultra-dl-history",JSON.stringify(i)),i}return[]}return JSON.parse(e)}async loadHistory(){let e=await this.getHistory();this.renderHistory(e)}renderHistory(e){let t=this.elements.historyList;if(!e||e.length===0){t.innerHTML=`<p class="empty-history-text">${c.t("Aucun t\xE9l\xE9chargement r\xE9cent")}</p>`;return}t.innerHTML=e.map(s=>`
            <div class="history-item">
                <img src="${s.thumbnail||"/img/social-placeholder.png"}" class="history-item-thumb">
                <div class="history-item-info">
                    <div class="history-item-title">${s.title}</div>
                    <div class="history-item-meta">${s.platform.toUpperCase()} \u2022 ${new Date(s.timestamp).toLocaleDateString()}</div>
                </div>
            </div>
        `).join(""),k()}clearHistory(){localStorage.removeItem("ultra-dl-history"),localStorage.removeItem("ultra-yt-history"),localStorage.removeItem("ultra-social-history"),this.renderHistory([])}populateQualities(e){let t=this.elements.qualitySelect;t.innerHTML='<option value="best">Auto (Max)</option>',e&&e.length&&e.forEach(s=>{let i=s>=2160?"4K/2160p":s>=1440?"2K/1440p":s>=1080?"1080p":`${s}p`;t.add(new Option(i,s))})}async download(){let e=Array.from(this.elements.playlistList.querySelectorAll(".playlist-entry")).filter(t=>t.querySelector(".playlist-entry-checkbox").checked);if(this.mediaInfo.isPlaylist&&e.length>0){let t=e.length,s=0;for(let i of e){s++;let n=i.dataset.url,a=i.querySelector(".playlist-entry-title").textContent;try{await this.downloadItem(n,a,`${s}/${t}`,t)}catch(o){console.error(`Failed to download ${a}:`,o)}}}else await this.downloadItem(this.currentUrl,this.mediaInfo.title)}async downloadItem(e,t,s="",i=1){let n=this.elements.downloadBtn,a=n.querySelector(".btn-text"),o=n.querySelector(".btn-loader"),r=Date.now().toString()+Math.floor(Math.random()*1e3);n.disabled=!0;let d=s?`[${s}] `:"";a.textContent=d+c.t("Initialisation..."),o.classList.remove("hidden"),this.elements.progressContainer&&(this.elements.progressContainer.classList.remove("hidden"),this.elements.progressFill.style.width="0%",this.elements.progressStatus.textContent=d+c.t("D\xE9marrage..."),this.elements.progressPercent.textContent="0%");let u=this.isYoutube(e),h=u?`/api/youtube/progress/${r}`:`/api/social/progress/${r}`,f=u?"/api/youtube/download":"/api/social/download",E=new EventSource(h);E.onmessage=y=>{let b=JSON.parse(y.data);b.type==="progress"?(this.elements.progressFill&&(this.elements.progressFill.style.width=`${b.percent}%`),this.elements.progressPercent&&(this.elements.progressPercent.textContent=`${Math.round(b.percent)}%`),this.elements.progressStatus&&(this.elements.progressStatus.textContent=d+b.status),a.textContent=`${d}${b.status} (${Math.round(b.percent)}%)`):b.type==="complete"&&(this.elements.progressFill&&(this.elements.progressFill.style.width="100%"),this.elements.progressPercent&&(this.elements.progressPercent.textContent="100%"),this.elements.progressStatus&&(this.elements.progressStatus.textContent=d+c.t("Pr\xEAt !")))};try{let y={url:e,mode:this.currentMode,quality:this.elements.qualitySelect.value,format:this.elements.formatSelect.value};u?(y.videoId=r,y.embedMetadata=this.elements.chkMetadata.checked,y.embedThumbnail=this.elements.chkThumbnail.checked,y.embedSubs=this.elements.chkSubs.checked):y.downloadId=r;let b=await fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)});if(!b.ok){let g=await b.json();throw new Error(g.error||c.t("Erreur inconnue"))}E.close();let w=await b.json();document.dispatchEvent(new CustomEvent("app-notification",{detail:{title:c.t("T\xE9l\xE9chargement termin\xE9"),message:`${c.t("Le m\xE9dia")} "${t}" ${c.t("est pr\xEAt.")}`,type:"success",icon:"download"}})),w.fileName&&!s&&(this.elements.saveBtn.href=`/databank/${w.fileName}`,this.elements.saveBtn.download=w.prettyName||w.fileName,this.elements.saveBtn.classList.remove("hidden"),this.elements.downloadBtn.classList.add("hidden"))}catch(y){E.close(),alert(c.t("Erreur")+": "+y.message)}finally{(!s||s.endsWith(`${i}/${i}`))&&(n.disabled=!1,a.textContent=c.t("T\xE9l\xE9charger"),o.classList.add("hidden"),setTimeout(()=>{this.elements.progressContainer&&this.elements.progressContainer.classList.add("hidden")},5e3))}}showLoading(e){e?this.elements.loading.classList.remove("hidden"):(this.elements.loading.classList.add("hidden"),this.elements.preview.classList.contains("hidden")&&this.elements.emptyState.classList.remove("hidden"))}}});var J,ve=S(()=>{M();J=class{constructor(){this.currentTool="removebg",this.selectedFiles=[],this.results=[],this.selectedModel="u2net",this.selectedUpscaleModel="edsr",this.selectedScale=4,this.denoise=!1,this.isRembgAvailable=!1,this.isUpscaleAvailable=!1,this.reconnectIntervals={rembg:null,upscale:null},this.isProcessing=!1,this.elements={toolBtns:document.querySelectorAll(".tool-btn"),rembgStatus:document.getElementById("imageAiRembgStatus"),upscaleStatus:document.getElementById("imageAiUpscaleStatus"),rembgError:document.getElementById("imageAiRembgError"),upscaleError:document.getElementById("imageAiUpscaleError"),rembgOptions:document.getElementById("imageAiRembgOptions"),upscaleOptions:document.getElementById("imageAiUpscaleOptions"),dropZone:document.getElementById("imageAiDropZone"),fileInput:document.getElementById("imageAiFileInput"),fileList:document.getElementById("imageAiFileList"),modelOptions:document.querySelectorAll(".model-option"),upscaleModelToggles:document.querySelectorAll("#imageAiUpscaleOptions .model-toggle .toggle-btn"),scaleToggles:document.querySelectorAll(".scale-toggle .toggle-btn"),denoiseToggles:document.querySelectorAll(".denoise-toggle .toggle-btn"),processBtn:document.getElementById("imageAiProcessBtn"),processText:document.getElementById("imageAiProcessText"),progressContainer:document.getElementById("imageAiProgressContainer"),progressFill:document.getElementById("imageAiProgressFill"),progressText:document.getElementById("imageAiProgressText"),resultContainer:document.getElementById("imageAiResultContainer")},this.init()}async init(){await this.loadDefaultSettings(),await this.checkServers(),this.setupEventListeners(),this.updateToolUI(),document.addEventListener("tab-changed",e=>{e.detail.tabId==="image-ai"&&this.loadDefaultSettings()})}async loadDefaultSettings(){if(this.isProcessing)return;let e=await m.get("ultra-rembg-default-model","u2net");this.selectedModel=e,this.elements.modelOptions.forEach(i=>{i.classList.toggle("active",i.dataset.model===e)});let t=await m.get("ultra-upscale-default-model","edsr"),s=await m.get("ultra-upscale-default-scale","4");this.selectedUpscaleModel=t,this.selectedScale=parseInt(s),this.elements.upscaleModelToggles.forEach(i=>{i.classList.toggle("active",i.dataset.model===this.selectedUpscaleModel)}),this.elements.scaleToggles.forEach(i=>{i.classList.toggle("active",i.dataset.scale===this.selectedScale.toString())})}async checkServers(){try{let t=await(await fetch("/api/rembg/health")).json();this.isRembgAvailable=t.available===!0}catch{this.isRembgAvailable=!1}try{let t=await(await fetch("/api/upscale/health")).json();this.isUpscaleAvailable=t.available===!0}catch{this.isUpscaleAvailable=!1}this.updateServerStatus()}updateServerStatus(){this.isRembgAvailable?(this.elements.rembgStatus.textContent="\u25CF REMBG",this.elements.rembgStatus.classList.add("connected"),this.elements.rembgStatus.classList.remove("disconnected"),this.elements.rembgError.classList.add("hidden")):(this.elements.rembgStatus.textContent="\u25CB REMBG",this.elements.rembgStatus.classList.add("disconnected"),this.elements.rembgStatus.classList.remove("connected"),this.currentTool==="removebg"&&(this.elements.rembgError.classList.remove("hidden"),this.startAutoReconnect("rembg"))),this.isUpscaleAvailable?(this.elements.upscaleStatus.textContent="\u25CF Upscale",this.elements.upscaleStatus.classList.add("connected"),this.elements.upscaleStatus.classList.remove("disconnected"),this.elements.upscaleError.classList.add("hidden")):(this.elements.upscaleStatus.textContent="\u25CB Upscale",this.elements.upscaleStatus.classList.add("disconnected"),this.elements.upscaleStatus.classList.remove("connected"),this.currentTool==="upscale"&&(this.elements.upscaleError.classList.remove("hidden"),this.startAutoReconnect("upscale")))}startAutoReconnect(e){this.reconnectIntervals[e]||(this.reconnectIntervals[e]=setInterval(async()=>{await this.checkServers(),(e==="rembg"?this.isRembgAvailable:this.isUpscaleAvailable)&&(clearInterval(this.reconnectIntervals[e]),this.reconnectIntervals[e]=null)},3e3))}setupEventListeners(){this.elements.toolBtns.forEach(e=>{e.onclick=()=>{this.isProcessing||(this.elements.toolBtns.forEach(t=>t.classList.remove("active")),e.classList.add("active"),this.currentTool=e.getAttribute("data-tool"),this.updateToolUI(),this.reset())}}),this.elements.dropZone.onclick=()=>{this.canProcess()&&!this.isProcessing&&this.elements.fileInput.click()},this.elements.fileInput.onchange=e=>{e.target.files.length>0&&(this.handleFiles(Array.from(e.target.files)),this.elements.fileInput.value="")},this.elements.dropZone.ondragover=e=>{e.preventDefault(),this.canProcess()&&!this.isProcessing&&this.elements.dropZone.classList.add("drag-over")},this.elements.dropZone.ondragleave=()=>{this.elements.dropZone.classList.remove("drag-over")},this.elements.dropZone.ondrop=e=>{e.preventDefault(),this.elements.dropZone.classList.remove("drag-over"),this.canProcess()&&!this.isProcessing&&e.dataTransfer.files.length&&this.handleFiles(Array.from(e.dataTransfer.files))},this.elements.processBtn.onclick=()=>this.processImages(),this.elements.modelOptions.forEach(e=>{e.onclick=()=>{this.isProcessing||(this.elements.modelOptions.forEach(t=>t.classList.remove("active")),e.classList.add("active"),this.selectedModel=e.getAttribute("data-model"))}}),this.elements.scaleToggles.forEach(e=>{e.onclick=()=>{this.isProcessing||(this.elements.scaleToggles.forEach(t=>t.classList.remove("active")),e.classList.add("active"),this.selectedScale=parseInt(e.getAttribute("data-scale")))}}),this.elements.upscaleModelToggles.forEach(e=>{e.onclick=()=>{this.isProcessing||(this.elements.upscaleModelToggles.forEach(t=>t.classList.remove("active")),e.classList.add("active"),this.selectedUpscaleModel=e.getAttribute("data-model"))}}),this.elements.denoiseToggles.forEach(e=>{e.onclick=()=>{this.isProcessing||(this.elements.denoiseToggles.forEach(t=>t.classList.remove("active")),e.classList.add("active"),this.denoise=e.getAttribute("data-denoise")==="true")}}),document.getElementById("imageAiRembgRetryBtn")?.addEventListener("click",()=>{this.checkServers()}),document.getElementById("imageAiUpscaleRetryBtn")?.addEventListener("click",()=>{this.checkServers()})}updateToolUI(){this.currentTool==="removebg"?(this.elements.rembgOptions.classList.remove("hidden"),this.elements.upscaleOptions.classList.add("hidden"),this.elements.rembgError.classList.toggle("hidden",this.isRembgAvailable),this.elements.upscaleError.classList.add("hidden"),this.elements.processText.textContent="Supprimer l'arri\xE8re-plan",this.elements.dropZone.classList.toggle("disabled",!this.isRembgAvailable)):(this.elements.rembgOptions.classList.add("hidden"),this.elements.upscaleOptions.classList.remove("hidden"),this.elements.upscaleError.classList.toggle("hidden",this.isUpscaleAvailable),this.elements.rembgError.classList.add("hidden"),this.elements.processText.textContent="Agrandir les images",this.elements.dropZone.classList.toggle("disabled",!this.isUpscaleAvailable))}canProcess(){return this.currentTool==="removebg"?this.isRembgAvailable:this.isUpscaleAvailable}handleFiles(e){let t=["image/png","image/jpeg","image/jpg","image/webp","image/gif","image/bmp"];e.forEach(s=>{if(!t.includes(s.type)){console.warn(`Type de fichier non support\xE9: ${s.name}`);return}if(s.size>30*1024*1024){console.warn(`Fichier trop volumineux: ${s.name}`);return}this.selectedFiles.some(n=>n.name===s.name&&n.size===s.size)||this.selectedFiles.push({file:s,name:s.name,size:s.size,status:"pending",preview:URL.createObjectURL(s)})}),this.updateUI()}updateUI(){this.selectedFiles.length>0?(this.elements.dropZone.classList.add("hidden"),this.elements.fileList.classList.remove("hidden"),this.elements.processBtn.classList.remove("hidden"),this.renderFileList()):(this.elements.dropZone.classList.remove("hidden"),this.elements.fileList.classList.add("hidden"),this.elements.processBtn.classList.add("hidden"))}renderFileList(){this.elements.fileList.innerHTML="",this.selectedFiles.forEach((e,t)=>{let s=document.createElement("div");s.className=`rembg-file-item ${e.status}`,s.innerHTML=`
                <div class="rembg-preview">
                    <img src="${e.preview}" alt="Aper\xE7u">
                </div>
                <div class="file-details">
                    <h3>${e.name}</h3>
                    <p>${this.formatSize(e.size)}</p>
                    <div class="item-status">${this.getStatusText(e.status)}</div>
                </div>
                ${this.isProcessing?"":`
                    <button class="btn-remove-item" data-index="${t}">
                        <i data-lucide="trash-2"></i>
                    </button>
                `}
            `,this.elements.fileList.appendChild(s)}),window.lucide&&window.lucide.createIcons(),this.elements.fileList.querySelectorAll(".btn-remove-item").forEach(e=>{e.onclick=()=>{let t=parseInt(e.getAttribute("data-index"));this.removeFile(t)}})}getStatusText(e){switch(e){case"pending":return"En attente";case"processing":return"Traitement...";case"completed":return"Termin\xE9";case"error":return"Erreur";default:return""}}removeFile(e){let t=this.selectedFiles[e];t.preview&&URL.revokeObjectURL(t.preview),this.selectedFiles.splice(e,1),this.updateUI()}async processImages(){if(this.selectedFiles.length===0||this.isProcessing||!this.canProcess())return;this.isProcessing=!0,this.results=[],this.elements.processBtn.disabled=!0,this.elements.processBtn.classList.add("hidden"),this.elements.progressContainer.classList.remove("hidden");let e=this.selectedFiles.length,t=this.currentTool==="removebg"?"/api/rembg/remove":"/api/upscale/process";for(let s=0;s<this.selectedFiles.length;s++){let i=this.selectedFiles[s];i.status="processing",this.renderFileList(),this.elements.progressText.textContent=`Traitement de ${s+1}/${e} : ${i.name}`,this.updateProgress(s/e*100);try{let n=new FormData;n.append("file",i.file),this.currentTool==="removebg"?n.append("model",this.selectedModel):(n.append("model",this.selectedUpscaleModel),n.append("scale",this.selectedScale),n.append("denoise",this.denoise));let a=await fetch(t,{method:"POST",body:n});if(!a.ok){let d=await a.json();throw new Error(d.error||"Erreur lors du traitement")}let o=await a.json(),r=`/databank/${o.fileName}`;i.status="completed",i.resultUrl=r,this.results.push({name:i.name,url:r,fileName:o.fileName})}catch(n){console.error(`Error processing ${i.name}:`,n),i.status="error",i.error=n.message}}this.updateProgress(100),this.elements.progressText.textContent="Traitement termin\xE9 !",this.isProcessing=!1,setTimeout(()=>{this.showResults();let s=this.currentTool==="removebg"?"Remove Background":"Upscale";document.dispatchEvent(new CustomEvent("app-notification",{detail:{title:`${s} termin\xE9`,message:`${this.results.length} image(s) trait\xE9e(s) avec succ\xE8s.`,type:"success",icon:"sparkles"}}))},800)}updateProgress(e){this.elements.progressFill.style.width=`${e}%`}showResults(){this.elements.fileList.classList.add("hidden"),this.elements.progressContainer.classList.add("hidden"),this.elements.resultContainer.classList.remove("hidden");let e=document.createElement("div");e.className="results-grid",this.results.forEach((a,o)=>{let r=document.createElement("div");r.className="result-card",r.innerHTML=`
                <img src="${a.url}" alt="${a.name}">
                <h4>${a.name}</h4>
                <button class="btn-secondary btn-sm" onclick="window.downloadImageAIResult(${o})">
                    <i data-lucide="download"></i> T\xE9l\xE9charger
                </button>
            `,e.appendChild(r)}),window.downloadImageAIResult=a=>{let o=this.results[a],r=document.createElement("a");r.href=o.url;let d=this.currentTool==="removebg"?"nobg":`upscaled-x${this.selectedScale}`;r.download=`${d}-${o.name.replace(/\.[^.]+$/,"")}.png`,r.click()};let t=this.elements.resultContainer;t.innerHTML="";let s=document.createElement("h3");s.textContent=`${this.results.length} image(s) trait\xE9e(s)`,s.style.marginBottom="24px",t.appendChild(s),t.appendChild(e);let i=document.createElement("div");if(i.className="result-actions",this.results.length>1){let a=document.createElement("button");a.className="btn-convert",a.innerHTML='<span class="btn-text"><i data-lucide="package"></i> Tout t\xE9l\xE9charger (ZIP)</span>',a.onclick=()=>this.downloadAllAsZip(),i.appendChild(a)}else if(this.results.length===1){let a=document.createElement("button");a.className="btn-convert",a.innerHTML='<span class="btn-text"><i data-lucide="download"></i> T\xE9l\xE9charger</span>',a.onclick=()=>window.downloadImageAIResult(0),i.appendChild(a)}let n=document.createElement("button");n.className="btn-secondary",n.textContent="Nouvelles images",n.onclick=()=>this.reset(),i.appendChild(n),t.appendChild(i),window.lucide&&window.lucide.createIcons()}async downloadAllAsZip(){if(window.JSZip||typeof JSZip<"u"){let e=new JSZip,t=this.currentTool==="removebg"?"nobg":`upscaled-x${this.selectedScale}`;for(let n of this.results){let o=await(await fetch(n.url)).blob();e.file(`${t}-${n.name.replace(/\.[^.]+$/,"")}.png`,o)}let s=await e.generateAsync({type:"blob"}),i=document.createElement("a");i.href=URL.createObjectURL(s),i.download=`${t}-images.zip`,i.click()}else for(let e=0;e<this.results.length;e++)window.downloadImageAIResult(e),await new Promise(t=>setTimeout(t,300))}reset(){this.selectedFiles.forEach(e=>{e.preview&&URL.revokeObjectURL(e.preview)}),this.results.forEach(e=>{e.url&&URL.revokeObjectURL(e.url)}),this.selectedFiles=[],this.results=[],this.isProcessing=!1,this.elements.dropZone.classList.remove("hidden"),this.elements.fileList.classList.add("hidden"),this.elements.resultContainer.classList.add("hidden"),this.elements.progressContainer.classList.add("hidden"),this.elements.processBtn.classList.add("hidden"),this.elements.processBtn.disabled=!1,this.elements.fileInput.value="",this.elements.progressFill.style.width="0%"}formatSize(e){if(e===0)return"0 B";let t=1024,s=["B","KB","MB","GB"],i=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,i)).toFixed(2))+" "+s[i]}}});var Y,ye=S(()=>{M();Y=class{constructor(){this.selectedFile=null,this.isServerAvailable=!1,this.reconnectInterval=null,this.availableModels=[],this.elements={dropZone:document.getElementById("sttDropZone"),fileInput:document.getElementById("sttFileInput"),fileInfo:document.getElementById("sttFileInfo"),fileName:document.getElementById("sttFileName"),fileSize:document.getElementById("sttFileSize"),fileDuration:document.getElementById("sttFileDuration"),removeBtn:document.getElementById("sttRemoveFile"),modelSelect:document.getElementById("sttModelSelect"),transcribeBtn:document.getElementById("sttTranscribeBtn"),progressContainer:document.getElementById("sttProgressContainer"),progressFill:document.getElementById("sttProgressFill"),progressText:document.getElementById("sttProgressText"),resultContainer:document.getElementById("sttResultContainer"),resultText:document.getElementById("sttResultText"),copyBtn:document.getElementById("sttCopyBtn"),downloadBtn:document.getElementById("sttDownloadBtn"),newBtn:document.getElementById("sttNewBtn"),statusBadge:document.getElementById("sttStatusBadge"),serverError:document.getElementById("sttServerError")},this.init()}async init(){await this.checkServer(),await this.loadModels(),this.setupEventListeners(),document.addEventListener("tab-changed",e=>{e.detail.tabId==="stt"&&this.loadModels()})}async checkServer(){try{let t=await(await fetch("/api/stt/health")).json();return this.isServerAvailable=t.available===!0,this.updateServerStatus(),this.isServerAvailable}catch{return this.isServerAvailable=!1,this.updateServerStatus(),!1}}startAutoReconnect(){this.reconnectInterval||(this.reconnectInterval=setInterval(async()=>{this.isServerAvailable?(clearInterval(this.reconnectInterval),this.reconnectInterval=null):await this.checkServer()&&(await this.loadModels(),clearInterval(this.reconnectInterval),this.reconnectInterval=null)},3e3))}async loadModels(){if(this.isServerAvailable)try{let t=await(await fetch("/api/stt/models")).json();this.availableModels=t.models||[];let{Storage:s}=await Promise.resolve().then(()=>(M(),pe)),i=await s.get("ultra-whisper-default-model","");this.populateModelSelect(i||t.default||"base")}catch(e){console.error("Failed to load models:",e)}}populateModelSelect(e){let t=this.elements.modelSelect;t&&(t.innerHTML="",this.availableModels.forEach(s=>{let i=document.createElement("option");i.value=s.id,i.textContent=`${s.name} - ${s.description}`,i.selected=s.id===e,t.appendChild(i)}))}updateServerStatus(){let e=this.elements.statusBadge,t=this.elements.serverError;this.isServerAvailable?(e.textContent="\u25CF Connect\xE9",e.classList.add("connected"),e.classList.remove("disconnected"),t.classList.add("hidden"),this.elements.dropZone.classList.remove("disabled")):(e.textContent="\u25CB D\xE9connect\xE9",e.classList.add("disconnected"),e.classList.remove("connected"),t.classList.remove("hidden"),this.elements.dropZone.classList.add("disabled"),this.startAutoReconnect())}setupEventListeners(){this.elements.dropZone.onclick=()=>{this.isServerAvailable&&this.elements.fileInput.click()},this.elements.fileInput.onchange=e=>{e.target.files[0]&&this.handleFile(e.target.files[0])},this.elements.dropZone.ondragover=e=>{e.preventDefault(),this.isServerAvailable&&this.elements.dropZone.classList.add("drag-over")},this.elements.dropZone.ondragleave=()=>{this.elements.dropZone.classList.remove("drag-over")},this.elements.dropZone.ondrop=e=>{e.preventDefault(),this.elements.dropZone.classList.remove("drag-over"),this.isServerAvailable&&e.dataTransfer.files.length&&this.handleFile(e.dataTransfer.files[0])},this.elements.removeBtn.onclick=()=>this.reset(),this.elements.transcribeBtn.onclick=()=>this.transcribe(),this.elements.newBtn.onclick=()=>this.reset(),this.elements.copyBtn.onclick=()=>this.copyResult(),this.elements.downloadBtn.onclick=()=>this.downloadResult(),document.getElementById("sttRetryBtn")?.addEventListener("click",()=>{this.checkServer().then(()=>this.loadModels())})}handleFile(e){let t=["audio/mpeg","audio/mp3","audio/wav","audio/x-wav","audio/m4a","audio/x-m4a","audio/mp4","audio/ogg","audio/flac","audio/webm","video/webm","video/mp4"],s=["mp3","wav","m4a","ogg","flac","webm","mp4"],i=e.name.split(".").pop().toLowerCase();if(!t.includes(e.type)&&!s.includes(i)){alert("\u274C Type de fichier non support\xE9. Utilisez MP3, WAV, M4A, OGG, FLAC ou WebM.");return}if(e.size>500*1024*1024){alert("\u274C Fichier trop volumineux. Maximum: 500MB");return}this.selectedFile=e,this.elements.dropZone.classList.add("hidden"),this.elements.fileInfo.classList.remove("hidden"),this.elements.resultContainer.classList.add("hidden"),this.elements.transcribeBtn.classList.remove("hidden"),this.elements.fileName.textContent=e.name,this.elements.fileSize.textContent=this.formatSize(e.size),this.getAudioDuration(e)}getAudioDuration(e){let t=new Audio;t.src=URL.createObjectURL(e),t.onloadedmetadata=()=>{let s=this.formatDuration(t.duration);this.elements.fileDuration.textContent=s,URL.revokeObjectURL(t.src)},t.onerror=()=>{this.elements.fileDuration.textContent="--:--"}}formatDuration(e){let t=Math.floor(e/60),s=Math.floor(e%60);return`${t}:${s.toString().padStart(2,"0")}`}async transcribe(){if(!this.selectedFile)return;let e=this.elements.modelSelect.value;this.elements.transcribeBtn.disabled=!0,this.elements.progressContainer.classList.remove("hidden"),this.elements.progressText.textContent=`Transcription avec le mod\xE8le ${e}...`,this.animateProgress(0,90,3e4);let t=new FormData;t.append("file",this.selectedFile),t.append("model",e);try{let s=await fetch("/api/stt/transcribe",{method:"POST",body:t});if(!s.ok){let n=await s.json();throw new Error(n.error||"Erreur lors de la transcription")}let i=await s.json();this.animateProgress(90,100,300),setTimeout(()=>{this.showResult(i),document.dispatchEvent(new CustomEvent("app-notification",{detail:{title:"Transcription termin\xE9e",message:`La transcription de ${this.selectedFile.name} est pr\xEAte.`,type:"success",icon:"mic"}}))},400)}catch(s){console.error("STT Error:",s),alert("\u{1F6A8} "+s.message),this.elements.progressContainer.classList.add("hidden"),this.elements.transcribeBtn.disabled=!1}}showResult(e){this.elements.fileInfo.classList.add("hidden"),this.elements.progressContainer.classList.add("hidden"),this.elements.transcribeBtn.classList.add("hidden"),this.elements.resultContainer.classList.remove("hidden"),this.elements.resultText.value=e.text||"",this.transcriptionResult=e}copyResult(){let e=this.elements.resultText.value;navigator.clipboard.writeText(e).then(()=>{let t=this.elements.copyBtn,s=t.innerHTML;t.innerHTML='<span class="btn-text">\u2713 Copi\xE9!</span>',setTimeout(()=>{t.innerHTML=s},2e3)})}downloadResult(){let e=this.elements.resultText.value,t=this.selectedFile?.name.replace(/\.[^.]+$/,"")||"transcription",s=new Blob([e],{type:"text/plain;charset=utf-8"}),i=URL.createObjectURL(s),n=document.createElement("a");n.href=i,n.download=`${t}.txt`,n.click(),URL.revokeObjectURL(i)}animateProgress(e,t,s){let i=Date.now(),n=()=>{let a=Date.now()-i,o=Math.min(a/s,1),r=e+(t-e)*this.easeOutQuad(o);this.elements.progressFill.style.width=`${r}%`,o<1&&requestAnimationFrame(n)};n()}easeOutQuad(e){return e*(2-e)}reset(){this.selectedFile=null,this.transcriptionResult=null,this.elements.dropZone.classList.remove("hidden"),this.elements.fileInfo.classList.add("hidden"),this.elements.resultContainer.classList.add("hidden"),this.elements.progressContainer.classList.add("hidden"),this.elements.transcribeBtn.classList.add("hidden"),this.elements.transcribeBtn.disabled=!1,this.elements.fileInput.value="",this.elements.progressFill.style.width="0%"}formatSize(e){if(e===0)return"0 B";let t=1024,s=["B","KB","MB","GB"],i=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,i)).toFixed(2))+" "+s[i]}}});var K,we=S(()=>{M();P();K=class{constructor(){this.themeToggle=document.getElementById("themeToggle"),this.reduceMotionToggle=document.getElementById("reduceMotionToggle"),this.compactSidebarToggle=document.getElementById("compactSidebarToggle"),this.sidebarSectionsToggle=document.getElementById("sidebarSectionsToggle"),this.soundToggle=document.getElementById("soundToggle"),this.clearCacheBtn=document.getElementById("clearCacheBtn"),this.accentPicker=document.getElementById("accentPicker"),this.accentDots=document.querySelectorAll(".accent-dot"),this.sidebarItemCheckboxes=document.querySelectorAll("[data-sidebar-item]"),this.settingsTabLinks=document.querySelectorAll(".settings-tab-link"),this.settingsTabPanes=document.querySelectorAll(".settings-tab-pane"),this.plexusSourceCount=document.getElementById("plexusSourceCount"),this.plexusExtraInfo=document.getElementById("plexusExtraInfo"),this.rembgModelToggles=document.querySelectorAll("#settingsRembgModelToggle .toggle-btn"),this.upscaleModelToggles=document.querySelectorAll("#settingsUpscaleModelToggle .toggle-btn"),this.upscaleScaleToggles=document.querySelectorAll("#settingsUpscaleScaleToggle .toggle-btn"),this.whisperModelToggles=document.querySelectorAll("#settingsWhisperModelToggle .toggle-btn"),this.languageToggles=document.querySelectorAll("#languageToggle .toggle-btn"),this.pinItemBtns=document.querySelectorAll(".pin-item-btn"),this.pinnedItemsContainer=document.getElementById("pinnedItemsContainer"),this.secUsername=document.getElementById("secUsername"),this.secCurrentPassword=document.getElementById("secCurrentPassword"),this.secNewPassword=document.getElementById("secNewPassword"),this.updatePasswordBtn=document.getElementById("updatePasswordBtn"),this.passwordUpdateMsg=document.getElementById("passwordUpdateMsg"),this.servicesStatusContainer=document.getElementById("servicesStatusContainer"),this.systemMetricsContainer=document.getElementById("systemMetricsContainer"),this.downloadedModelsContainer=document.getElementById("downloadedModelsContainer"),this.statusRefreshInterval=null,this.envOpenRouterKey=document.getElementById("envOpenRouterKey"),this.envOpenRouterModel=document.getElementById("envOpenRouterModel"),this.envSearxngUrl=document.getElementById("envSearxngUrl"),this.envRembgUrl=document.getElementById("envRembgUrl"),this.envWhisperUrl=document.getElementById("envWhisperUrl"),this.envUpscaleUrl=document.getElementById("envUpscaleUrl"),this.envOllamaUrl=document.getElementById("envOllamaUrl"),this.envOllamaModel=document.getElementById("envOllamaModel"),this.aiProviderToggles=document.querySelectorAll("#settingsAiProviderToggle .toggle-btn"),this.openRouterSection=document.getElementById("settingsOpenRouterSection"),this.ollamaSection=document.getElementById("settingsOllamaSection"),this.saveEnvSettingsBtn=document.getElementById("saveEnvSettingsBtn"),this.refreshLogsBtn=document.getElementById("refreshLogsBtn"),this.clearLogsBtn=document.getElementById("clearLogsBtn"),this.settingsLogsContainer=document.getElementById("settingsLogsContainer"),this.logsRefreshInterval=null,this.saveTimeout=null,this.init()}async init(){await m.migrate(),await this.loadSettings(),this.themeToggle&&this.themeToggle.addEventListener("change",()=>this.toggleTheme()),this.reduceMotionToggle&&this.reduceMotionToggle.addEventListener("change",()=>this.toggleReduceMotion()),this.compactSidebarToggle&&this.compactSidebarToggle.addEventListener("change",()=>this.toggleCompactSidebar()),this.sidebarSectionsToggle&&this.sidebarSectionsToggle.addEventListener("change",()=>this.toggleSidebarSections()),this.clearCacheBtn&&this.clearCacheBtn.addEventListener("click",()=>this.clearCache()),this.accentDots&&this.accentDots.forEach(t=>{t.addEventListener("click",()=>this.setAccentColor(t.dataset.color,t))}),this.sidebarItemCheckboxes&&this.sidebarItemCheckboxes.forEach(t=>{t.addEventListener("change",()=>this.toggleSidebarItem(t))}),this.settingsTabLinks&&this.settingsTabLinks.forEach(t=>{t.addEventListener("click",()=>this.switchSettingsTab(t.dataset.settingsTab))}),this.plexusSourceCount&&this.plexusSourceCount.addEventListener("input",()=>this.savePlexusSettings()),this.plexusExtraInfo&&this.plexusExtraInfo.addEventListener("input",()=>this.savePlexusSettings()),this.setupToggleGroupListeners(this.rembgModelToggles,"ultra-rembg-default-model"),this.setupToggleGroupListeners(this.upscaleModelToggles,"ultra-upscale-default-model"),this.setupToggleGroupListeners(this.upscaleScaleToggles,"ultra-upscale-default-scale"),this.setupToggleGroupListeners(this.whisperModelToggles,"ultra-whisper-default-model"),this.languageToggles&&this.languageToggles.forEach(t=>{t.addEventListener("click",()=>c.setLanguage(t.dataset.lang))}),this.pinItemBtns&&this.pinItemBtns.forEach(t=>{t.addEventListener("click",()=>this.togglePinItem(t))}),this.updatePasswordBtn&&this.updatePasswordBtn.addEventListener("click",()=>this.handlePasswordUpdate()),this.setupToggleGroupListeners(this.aiProviderToggles,"AI_PROVIDER","provider",t=>this.updateAiProviderVisibility(t)),[this.envOpenRouterKey,this.envOpenRouterModel,this.envSearxngUrl,this.envRembgUrl,this.envWhisperUrl,this.envUpscaleUrl,this.envOllamaUrl,this.envOllamaModel,this.plexusSourceCount,this.plexusExtraInfo].forEach(t=>{t&&t.addEventListener("input",()=>this.debouncedSaveIntelligence())}),this.refreshLogsBtn&&this.refreshLogsBtn.addEventListener("click",()=>this.refreshServerLogs()),this.clearLogsBtn&&this.clearLogsBtn.addEventListener("click",()=>this.clearServerLogs()),await this.updatePinnedSidebar()}async handlePasswordUpdate(){let e=this.secUsername.value,t=this.secCurrentPassword.value,s=this.secNewPassword.value;if(!e||!t||!s){this.showPasswordMsg("Tous les champs sont requis","error");return}this.updatePasswordBtn.disabled=!0,this.updatePasswordBtn.textContent="Mise \xE0 jour...";try{let i=await fetch("/api/auth/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,currentPassword:t,newPassword:s})}),n=await i.json();i.ok?(this.showPasswordMsg(n.message,"success"),this.secCurrentPassword.value="",this.secNewPassword.value=""):this.showPasswordMsg(n.error||"Erreur lors de la mise \xE0 jour","error")}catch{this.showPasswordMsg("Erreur de connexion au serveur","error")}finally{this.updatePasswordBtn.disabled=!1,this.updatePasswordBtn.textContent="Mettre \xE0 jour le mot de passe"}}showPasswordMsg(e,t){this.passwordUpdateMsg.textContent=e,this.passwordUpdateMsg.style.display="block",this.passwordUpdateMsg.style.color=t==="error"?"var(--error)":"var(--success)",setTimeout(()=>{this.passwordUpdateMsg.style.display="none"},5e3)}async loadSettings(){let e=await m.get("ultra-theme","dark");document.documentElement.setAttribute("data-theme",e),this.themeToggle&&(this.themeToggle.checked=e==="dark");let t=await m.get("ultra-reduce-motion",!1);document.body.classList.toggle("reduce-motion",t),this.reduceMotionToggle&&(this.reduceMotionToggle.checked=t);let s=await m.get("ultra-compact-sidebar",!1);document.body.classList.toggle("compact-sidebar",s),this.compactSidebarToggle&&(this.compactSidebarToggle.checked=s);let i=await m.get("ultra-sidebar-sections",!0);document.body.classList.toggle("no-sidebar-sections",!i),this.sidebarSectionsToggle&&(this.sidebarSectionsToggle.checked=i);let n=await m.get("ultra-sound",!0);this.soundToggle&&(this.soundToggle.checked=n);let a=await m.get("ultra-accent-color","#ffffff");this.applyAccentColor(a);let o=await m.get("AI_PROVIDER","openrouter");this.aiProviderToggles.forEach(h=>{h.classList.toggle("active",h.dataset.provider===o)}),this.updateAiProviderVisibility(o),this.accentDots.forEach(h=>{h.classList.toggle("active",h.dataset.color===a)}),await this.loadSidebarItemsVisibility();let r=await m.get("ultra-plexus-source-count",3),d=await m.get("ultra-plexus-extra-info","");this.plexusSourceCount&&(this.plexusSourceCount.value=r),this.plexusExtraInfo&&(this.plexusExtraInfo.value=d),this.loadToggleGroupState(this.rembgModelToggles,"ultra-rembg-default-model","u2net"),this.loadToggleGroupState(this.upscaleModelToggles,"ultra-upscale-default-model","edsr"),this.loadToggleGroupState(this.upscaleScaleToggles,"ultra-upscale-default-scale","4"),this.loadToggleGroupState(this.whisperModelToggles,"ultra-whisper-default-model","base"),this.loadToggleGroupState(this.languageToggles,"ultra-language","en");let u=[{id:"envOpenRouterKey",key:"OPENROUTER_API_KEY"},{id:"envOpenRouterModel",key:"OPENROUTER_MODEL"},{id:"envSearxngUrl",key:"SEARXNG_URL"},{id:"envRembgUrl",key:"REMBG_URL"},{id:"envWhisperUrl",key:"WHISPER_URL"},{id:"envUpscaleUrl",key:"UPSCALE_URL"},{id:"envOllamaUrl",key:"OLLAMA_URL"},{id:"envOllamaModel",key:"OLLAMA_MODEL"}];for(let h of u){let f=document.getElementById(h.id);if(!f)continue;let E=await m.getFull(h.key);E.source==="env"?(f.value=E.effectiveValue||"",f.classList.add("using-env-fallback")):E.value&&(f.value=E.value,f.classList.remove("using-env-fallback"))}await this.loadToggleGroupState(this.aiProviderToggles,"AI_PROVIDER","openrouter","provider")}setupToggleGroupListeners(e,t,s="model",i=null){e.forEach(n=>{n.addEventListener("click",async()=>{e.forEach(o=>o.classList.remove("active")),n.classList.add("active");let a=n.dataset[s]||n.dataset.scale;await m.set(t,a),i&&i(a)})})}updateAiProviderVisibility(e){!this.openRouterSection||!this.ollamaSection||(e==="openrouter"?(this.openRouterSection.style.display="block",this.ollamaSection.style.display="none"):e==="ollama"&&(this.openRouterSection.style.display="none",this.ollamaSection.style.display="block"))}async loadToggleGroupState(e,t,s,i="model"){let n=await m.get(t,s);e.forEach(a=>{let o=a.dataset[i]||a.dataset.scale;a.classList.toggle("active",o===n.toString())})}switchSettingsTab(e){this.settingsTabLinks.forEach(t=>{t.classList.toggle("active",t.dataset.settingsTab===e)}),this.settingsTabPanes.forEach(t=>{t.classList.toggle("active",t.id===`settings-${e}`)}),e==="system"?(this.refreshServerStatus(),this.refreshServerLogs(),this.statusRefreshInterval||(this.statusRefreshInterval=setInterval(()=>this.refreshServerStatus(),5e3)),this.logsRefreshInterval||(this.logsRefreshInterval=setInterval(()=>this.refreshServerLogs(),3e3))):(this.statusRefreshInterval&&(clearInterval(this.statusRefreshInterval),this.statusRefreshInterval=null),this.logsRefreshInterval&&(clearInterval(this.logsRefreshInterval),this.logsRefreshInterval=null))}async refreshServerStatus(){try{let e=await fetch("/api/status/health");if(e.ok){let s=await e.json();this.renderServerStatus(s)}let t=await fetch("/api/status/models");if(t.ok){let s=await t.json();this.renderDownloadedModels(s.models)}}catch(e){console.error("Error fetching health status:",e)}}renderDownloadedModels(e){if(this.downloadedModelsContainer){if(!e||e.length===0){this.downloadedModelsContainer.innerHTML=`
                <div class="status-loading">
                    <i data-lucide="info" style="width: 24px; height: 24px; color: var(--text-muted);"></i>
                    Aucun mod\xE8le t\xE9l\xE9charg\xE9 trouv\xE9.
                </div>
            `,window.lucide&&window.lucide.createIcons();return}this.downloadedModelsContainer.innerHTML=`
            <div class="models-table-wrapper">
                <table class="models-table">
                    <thead>
                        <tr>
                            <th>Mod\xE8le</th>
                            <th>Type</th>
                            <th>Taille</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${e.map(t=>`
                            <tr>
                                <td class="model-name-cell">
                                    <i data-lucide="file-code" class="model-icon"></i>
                                    <span>${t.name}</span>
                                </td>
                                <td><span class="model-tag">${t.type}</span></td>
                                <td class="model-size">${t.size}</td>
                                <td class="model-date">${new Date(t.date).toLocaleDateString()}</td>
                            </tr>
                        `).join("")}
                    </tbody>
                </table>
            </div>
        `,window.lucide&&window.lucide.createIcons()}}renderServerStatus(e){if(!this.servicesStatusContainer||!this.systemMetricsContainer||!e||!e.services)return;if(this.servicesStatusContainer.innerHTML=e.services.map(n=>`
            <div class="status-card">
                <div class="status-header">
                    <span class="service-name">${n.name}</span>
                    <span class="status-indicator ${n.status}">${n.status}</span>
                </div>
                <div class="status-details">
                    ${n.status==="online"?`
                        <div class="detail-row">
                            <span class="detail-label">Service</span>
                            <span class="detail-value">${n.details?.service||"N/A"}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Status</span>
                            <span class="detail-value">${n.details?.status||"OK"}</span>
                        </div>
                    `:`
                        <div class="detail-row">
                            <span class="detail-label">Erreur</span>
                            <span class="detail-value">${n.error||"Inconnu"}</span>
                        </div>
                    `}
                </div>
            </div>
        `).join(""),!e.system||!e.system.memory){this.systemMetricsContainer.innerHTML='<div class="status-loading">Metrics non disponibles</div>';return}let t=Math.round(e.system.memory.rss/1024/1024),s=Math.floor(e.system.uptime/3600),i=Math.floor(e.system.uptime%3600/60);this.systemMetricsContainer.innerHTML=`
            <div class="metric-box">
                <span class="metric-label">Uptime</span>
                <span class="metric-value">${s}h ${i}m</span>
            </div>
            <div class="metric-box">
                <span class="metric-label">M\xE9moire (RSS)</span>
                <span class="metric-value">${t} MB</span>
            </div>
            <div class="metric-box">
                <span class="metric-label">Platform</span>
                <span class="metric-value">${e.system.platform||"N/A"}</span>
            </div>
            <div class="metric-box">
                <span class="metric-label">Node JS</span>
                <span class="metric-value">${e.system.nodeVersion||"N/A"}</span>
            </div>
        `}async refreshServerLogs(){try{let e=await fetch("/api/status/logs");if(e.ok){let t=await e.json();this.renderServerLogs(t.logs)}}catch(e){console.error("Error fetching logs:",e)}}renderServerLogs(e){if(!this.settingsLogsContainer)return;if(!e||e.length===0){this.settingsLogsContainer.innerHTML='<div class="log-placeholder">Aucun log disponible.</div>';return}let t=this.settingsLogsContainer.scrollHeight-this.settingsLogsContainer.scrollTop<=this.settingsLogsContainer.clientHeight+50;this.settingsLogsContainer.innerHTML=e.map(s=>`
            <div class="log-entry">
                <span class="log-time">[${s.time}]</span>
                <span class="log-type ${s.type}">${s.type}</span>
                <span class="log-message">${this.escapeHtml(s.message)}</span>
            </div>
        `).join(""),t&&(this.settingsLogsContainer.scrollTop=this.settingsLogsContainer.scrollHeight)}async clearServerLogs(){if(confirm("Voulez-vous vraiment effacer les logs du serveur ?"))try{(await fetch("/api/status/logs/clear",{method:"POST"})).ok&&this.renderServerLogs([])}catch(e){console.error("Error clearing logs:",e)}}escapeHtml(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}debouncedSaveIntelligence(){this.saveTimeout&&clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(()=>this.saveIntelligenceSettings(),500)}async saveIntelligenceSettings(){console.log("Auto-saving Intelligence settings...");try{let e={OPENROUTER_API_KEY:this.envOpenRouterKey?.value.trim(),OPENROUTER_MODEL:this.envOpenRouterModel?.value.trim(),SEARXNG_URL:this.envSearxngUrl?.value.trim(),REMBG_URL:this.envRembgUrl?.value.trim(),WHISPER_URL:this.envWhisperUrl?.value.trim(),UPSCALE_URL:this.envUpscaleUrl?.value.trim(),OLLAMA_URL:this.envOllamaUrl?.value.trim(),OLLAMA_MODEL:this.envOllamaModel?.value.trim(),"ultra-plexus-source-count":parseInt(this.plexusSourceCount?.value)||3,"ultra-plexus-extra-info":this.plexusExtraInfo?.value};for(let[t,s]of Object.entries(e))s!==void 0&&await m.set(t,s)}catch(e){console.error("Error auto-saving intelligence settings:",e)}}async loadSidebarItemsVisibility(){let e=await m.get("ultra-hidden-sidebar-items",[]);this.sidebarItemCheckboxes.forEach(t=>{let s=t.dataset.sidebarItem,i=e.includes(s);t.checked=!i,this.updateSidebarItemVisibility(s,!i)})}updateSidebarItemVisibility(e,t){let s=document.querySelector(`.nav-item[data-tab="${e}"]`);s&&(t?s.classList.remove("hidden-by-settings"):s.classList.add("hidden-by-settings"))}async toggleSidebarItem(e){let t=e.dataset.sidebarItem,s=e.checked;this.updateSidebarItemVisibility(t,s);let i=await m.get("ultra-hidden-sidebar-items",[]);if(s){let n=i.indexOf(t);n>-1&&i.splice(n,1)}else i.includes(t)||i.push(t);await m.set("ultra-hidden-sidebar-items",i),await this.updatePinnedSidebar()}async togglePinItem(e){let t=e.dataset.pinItem,s=await m.get("ultra-pinned-sidebar-items",[]),i=s.indexOf(t);i>-1?(s.splice(i,1),e.classList.remove("active")):(s.push(t),e.classList.add("active")),await m.set("ultra-pinned-sidebar-items",s),await this.updatePinnedSidebar()}async updatePinnedSidebar(){if(!this.pinnedItemsContainer)return;let e=await m.get("ultra-pinned-sidebar-items",[]),t=await m.get("ultra-hidden-sidebar-items",[]);this.pinItemBtns&&this.pinItemBtns.forEach(i=>{let n=i.dataset.pinItem;i.classList.toggle("active",e.includes(n))}),this.pinnedItemsContainer.innerHTML="";let s=e.filter(i=>!t.includes(i));if(s.length===0){this.pinnedItemsContainer.style.display="none";return}this.pinnedItemsContainer.style.display="flex",s.forEach(i=>{let n=document.querySelector(`.nav-section .nav-item[data-tab="${i}"]`);if(n){let a=n.querySelector(".nav-icon").innerHTML,o=n.querySelector(".nav-label").textContent,r=document.createElement("button");r.className="nav-item pinned-nav-item",r.dataset.tab=i,r.innerHTML=`
                    <span class="nav-icon">${a}</span>
                    <span class="nav-label">${o}</span>
                `,r.addEventListener("click",()=>{let d=new CustomEvent("switch-tab",{detail:{tab:i}});document.dispatchEvent(d)}),this.pinnedItemsContainer.appendChild(r)}}),window.lucide&&window.lucide.createIcons()}async toggleTheme(){let t=this.themeToggle.checked?"dark":"light";document.documentElement.setAttribute("data-theme",t),await m.set("ultra-theme",t)}async toggleReduceMotion(){let e=this.reduceMotionToggle.checked;document.body.classList.toggle("reduce-motion",e),await m.set("ultra-reduce-motion",e)}async toggleCompactSidebar(){let e=this.compactSidebarToggle.checked;document.body.classList.toggle("compact-sidebar",e),await m.set("ultra-compact-sidebar",e)}async toggleSidebarSections(){let e=this.sidebarSectionsToggle.checked;document.body.classList.toggle("no-sidebar-sections",!e),await m.set("ultra-sidebar-sections",e)}async setAccentColor(e,t){this.accentDots.forEach(s=>s.classList.remove("active")),t.classList.add("active"),this.applyAccentColor(e),await m.set("ultra-accent-color",e)}applyAccentColor(e){document.documentElement.style.setProperty("--accent",e),e==="#ffffff"?(document.documentElement.style.setProperty("--accent-hover","#f4f4f5"),document.documentElement.style.setProperty("--accent-dim","#27272a")):(document.documentElement.style.setProperty("--accent-hover",e+"ee"),document.documentElement.style.setProperty("--accent-dim",e+"22"))}async clearCache(){confirm("Voulez-vous vraiment vider le cache local ? Cela r\xE9initialisera \xE9galement vos r\xE9glages.")&&(localStorage.clear(),window.location.reload())}}});var be,Ie=S(()=>{be=()=>{let l=document.getElementById("chatForm"),e=document.getElementById("chatInput"),t=document.getElementById("chatMessages"),s=document.getElementById("pdfInput"),i=document.getElementById("pdfStatusText"),n=document.getElementById("pdfInfo"),a=document.getElementById("currentPdfName"),o=document.getElementById("currentPdfPages"),r=document.getElementById("removePdf"),d=document.getElementById("chatClearBtn"),u=document.querySelector(".model-badge"),h=[],f=null,E=async()=>{try{let L=await(await fetch("/api/chat/config")).json();if(L.model&&u){let I=L.model.split("/"),T=I[I.length-1].toUpperCase();u.textContent=T,u.title=L.model}}catch(g){console.error("Impossible de charger la config du chat",g)}},y=(g,L)=>{let I=document.createElement("div");I.className=`message ${g}`;let T=document.createElement("div");T.className="message-content",g!=="system"&&window.marked?T.innerHTML=marked.parse(L):T.textContent=L,I.appendChild(T),t.appendChild(I),t.scrollTop=t.scrollHeight},b=g=>{let L=document.querySelector(".typing-indicator");if(g&&!L){let I=document.createElement("div");I.className="typing-indicator",I.innerHTML='Ultra AI r\xE9fl\xE9chit <span class="dot"></span><span class="dot"></span><span class="dot"></span>',t.appendChild(I),t.scrollTop=t.scrollHeight}else!g&&L&&L.remove()};s.addEventListener("change",async g=>{let L=g.target.files[0];if(!L)return;i.textContent="Analyse en cours...";let I=new FormData;I.append("pdf",L);try{let T=await fetch("/api/chat/upload-pdf",{method:"POST",body:I});if(!T.ok)throw new Error("Erreur d'analyse");let D=await T.json();f=D.text,n.classList.remove("hidden"),a.textContent=D.filename,o.textContent=`${D.pages} pages`,i.textContent="PDF charg\xE9",y("system",`Document "${D.filename}" charg\xE9. Je peux maintenant r\xE9pondre \xE0 vos questions sur son contenu.`)}catch(T){console.error(T),i.textContent="Erreur de chargement",alert("Erreur lors de l'upload du PDF. Assurez-vous qu'il est valide.")}}),r.addEventListener("click",()=>{f=null,s.value="",n.classList.add("hidden"),i.textContent="Ajouter un PDF",y("system","Le contexte du document a \xE9t\xE9 retir\xE9.")});let w=async()=>{let g=e.value.trim();if(g){e.value="",e.style.height="auto",y("user",g),b(!0);try{let I=await(await fetch("/api/chat/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:g,history:h,context:f})})).json();b(!1),I.error?y("system",`Erreur: ${I.error}`):(y("ai",I.reply),h=I.history)}catch(L){b(!1),y("system","Erreur de connexion avec le serveur."),console.error(L)}}};l.addEventListener("submit",g=>{g.preventDefault(),w()}),e.addEventListener("keydown",g=>{g.key==="Enter"&&!g.shiftKey&&(g.preventDefault(),w())}),e.addEventListener("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"}),d.addEventListener("click",()=>{confirm("Voulez-vous vraiment effacer l'historique de la conversation ?")&&(h=[],t.innerHTML=`
                <div class="message system">
                    <div class="message-content">
                        Historique effac\xE9. Je suis pr\xEAt pour une nouvelle discussion !
                    </div>
                </div>
            `)}),E()}});function Ee(){ze(),je(),We(),Ve(),He(),Ge()}function He(){let l=document.getElementById("cur-from-val"),e=document.getElementById("cur-to-val"),t=document.getElementById("cur-from-type"),s=document.getElementById("cur-to-type"),i=document.getElementById("cur-swap"),n=document.getElementById("cur-rate-info");if(!l)return;let a=async()=>{let r=parseFloat(l.value);if(isNaN(r)||r<=0){e.value="";return}let d=t.value,u=s.value;if(d===u){e.value=r.toFixed(2),n.textContent=`1 ${d} = 1.00 ${u}`;return}try{n.textContent="Mise \xE0 jour du taux...";let f=await(await fetch(`https://api.frankfurter.app/latest?amount=${r}&from=${d}&to=${u}`)).json();if(f.rates&&f.rates[u]){let E=f.rates[u];e.value=E.toFixed(2);let y=E/r;n.textContent=`1 ${d} = ${y.toFixed(4)} ${u}`}}catch(h){console.error("Currency API error:",h),n.textContent="Erreur lors de la r\xE9cup\xE9ration du taux"}},o=null;l.addEventListener("input",()=>{clearTimeout(o),o=setTimeout(a,500)}),[t,s].forEach(r=>r.addEventListener("change",a)),i.addEventListener("click",()=>{let r=t.value;t.value=s.value,s.value=r,a()}),a()}function ze(){let l=document.getElementById("qr-input"),e=document.getElementById("qrcode-result"),t=document.getElementById("qr-download");if(!l||!e)return;let s=null;l.addEventListener("input",()=>{clearTimeout(s);let i=l.value.trim();if(!i){e.innerHTML='<p style="color: var(--text-muted); font-size: 12px;">Votre QR code appara\xEEtra ici</p>',t.classList.add("hidden");return}s=setTimeout(()=>{e.innerHTML="",QRCode.toCanvas(i,{width:200,margin:2,color:{dark:"#000000",light:"#ffffff"}},(n,a)=>{if(n){console.error(n),e.innerHTML='<p style="color: #ef4444; font-size: 12px;">Erreur de g\xE9n\xE9ration</p>';return}e.appendChild(a),t.classList.remove("hidden")})},300)}),t.addEventListener("click",()=>{let i=e.querySelector("canvas");if(!i)return;let n=document.createElement("a");n.download="qrcode.png",n.href=i.toDataURL(),n.click()})}function je(){let l=document.getElementById("pass-length"),e=document.getElementById("pass-length-val"),t=document.getElementById("pass-result"),s=document.getElementById("pass-gen"),i=document.getElementById("pass-copy"),n=document.getElementById("pass-upper"),a=document.getElementById("pass-lower"),o=document.getElementById("pass-num"),r=document.getElementById("pass-sym");if(!l||!s)return;l.addEventListener("input",()=>{e.textContent=l.value});let d=()=>{let u=parseInt(l.value),h={upper:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",lower:"abcdefghijklmnopqrstuvwxyz",num:"0123456789",sym:"!@#$%^&*()_+~`|}{[]:;?><,./-="},f="";n.checked&&(f+=h.upper),a.checked&&(f+=h.lower),o.checked&&(f+=h.num),r.checked&&(f+=h.sym),f||(f=h.lower);let E="";for(let y=0;y<u;y++)E+=f.charAt(Math.floor(Math.random()*f.length));t.textContent=E};s.addEventListener("click",d),i.addEventListener("click",()=>{let u=t.textContent;u!=="********"&&navigator.clipboard.writeText(u).then(()=>{let h=i.innerHTML;i.innerHTML='<i data-lucide="check" style="width: 16px; height: 16px; color: var(--success);"></i>',window.lucide&&window.lucide.createIcons(),setTimeout(()=>{i.innerHTML=h,window.lucide&&window.lucide.createIcons()},2e3)})})}function We(){let l=document.getElementById("text-input"),e=document.getElementById("text-count-chars"),t=document.getElementById("text-count-words"),s=document.querySelectorAll("[data-action]");l&&(l.addEventListener("input",()=>{let i=l.value;e.textContent=`${i.length} caract\xE8res`;let n=i.trim()?i.trim().split(/\s+/).length:0;t.textContent=`${n} mots`}),s.forEach(i=>{i.closest(".tool-card").querySelector(".tool-title").textContent==="Outils Texte"&&i.addEventListener("click",()=>{let n=i.dataset.action,a=l.value;switch(n){case"upper":a=a.toUpperCase();break;case"lower":a=a.toLowerCase();break;case"title":a=a.toLowerCase().split(" ").map(o=>o.charAt(0).toUpperCase()+o.substring(1)).join(" ");break;case"clean":a=a.trim().replace(/\s+/g," ");break}l.value=a,l.dispatchEvent(new Event("input"))})}))}function Ve(){let l=document.getElementById("unit-from-val"),e=document.getElementById("unit-to-val"),t=document.getElementById("unit-type"),s=document.getElementById("unit-swap");if(!l||!e)return;let i=()=>{let n=parseFloat(l.value);if(isNaN(n)){e.value="";return}let a=t.value,o;switch(a){case"length":o=n*3.28084;break;case"weight":o=n*2.20462;break;case"temp":o=n*9/5+32;break}e.value=o.toFixed(2)};l.addEventListener("input",i),t.addEventListener("change",i),s.addEventListener("click",()=>{let n=t.value,a=parseFloat(l.value);e.value&&(l.value=e.value,i())})}function Ge(){let l=document.getElementById("mirrorVideo"),e=document.getElementById("mirrorCanvas"),t=document.getElementById("mirrorPlaceholder"),s=document.getElementById("mirrorToggle"),i=document.getElementById("mirrorCapture"),n=document.getElementById("mirrorDownload"),a=document.getElementById("mirrorDeviceSelect");if(!l||!s)return;let o=null,r=!1,d=[];async function u(){try{d=(await navigator.mediaDevices.enumerateDevices()).filter(g=>g.kind==="videoinput"),d.length>1&&(a.innerHTML='<option value="">S\xE9lectionner une cam\xE9ra...</option>',d.forEach((g,L)=>{let I=document.createElement("option");I.value=g.deviceId,I.textContent=g.label||`Cam\xE9ra ${L+1}`,a.appendChild(I)}),a.style.display="block")}catch(w){console.error("Error enumerating devices:",w)}}async function h(w=null){try{let g={video:w?{deviceId:{exact:w}}:!0,audio:!1};o=await navigator.mediaDevices.getUserMedia(g),l.srcObject=o,l.style.display="block",t.style.display="none",i.style.display="block",s.innerHTML='<i data-lucide="video-off" style="width: 14px; height: 14px;"></i> D\xE9sactiver',window.lucide&&window.lucide.createIcons(),r=!0,await u()}catch(g){console.error("Error accessing webcam:",g),alert("Impossible d'acc\xE9der \xE0 la webcam. V\xE9rifiez les permissions.")}}function f(){o&&(o.getTracks().forEach(w=>w.stop()),o=null),l.style.display="none",e.style.display="none",t.style.display="flex",i.style.display="none",n.style.display="none",s.innerHTML='<i data-lucide="video" style="width: 14px; height: 14px;"></i> Activer',window.lucide&&window.lucide.createIcons(),r=!1}function E(){if(!r)return;let w=e.getContext("2d");e.width=l.videoWidth,e.height=l.videoHeight,w.drawImage(l,0,0,e.width,e.height),l.style.display="none",e.style.display="block",n.style.display="block",i.innerHTML='<i data-lucide="rotate-ccw" style="width: 14px; height: 14px;"></i> Retour',window.lucide&&window.lucide.createIcons()}function y(){l.style.display="block",e.style.display="none",n.style.display="none",i.innerHTML='<i data-lucide="camera" style="width: 14px; height: 14px;"></i> Capturer',window.lucide&&window.lucide.createIcons()}function b(){let w=document.createElement("a"),g=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);w.download=`webcam-capture-${g}.png`,w.href=e.toDataURL("image/png"),w.click()}s.addEventListener("click",()=>{r?f():h()}),i.addEventListener("click",()=>{e.style.display==="block"?y():E()}),n.addEventListener("click",b),a.addEventListener("change",w=>{w.target.value&&r&&(f(),h(w.target.value))})}var Le=S(()=>{});var X,Se=S(()=>{P();X=class{constructor(){this.dirPathInput=document.getElementById("metaDirPath"),this.scanBtn=document.getElementById("metaScanBtn"),this.folderInput=document.getElementById("metaFolderInput"),this.metadataBody=document.getElementById("metadataBody"),this.emptyState=document.getElementById("metaEmptyState"),this.loadingOverlay=document.getElementById("metaLoading"),this.toolbar=document.getElementById("metaToolbar"),this.statusText=document.getElementById("metaStatusText"),this.applyAllBtn=document.getElementById("metaApplyAllBtn"),this.magicBtn=document.getElementById("metaMagicBtn"),this.searchSelector=document.getElementById("metaSearch"),this.files=[],this.filteredFiles=[],this.modifiedIndices=new Set,this.init()}init(){this.scanBtn&&(this.folderInput.addEventListener("change",e=>this.handleFolderSelect(e)),this.scanBtn.addEventListener("click",()=>this.scanDirectory()),this.applyAllBtn.addEventListener("click",()=>this.applyAllChanges()),this.magicBtn.addEventListener("click",()=>this.magicAutoTag()),this.searchSelector.addEventListener("input",e=>this.filterFiles(e.target.value)),this.dirPathInput.addEventListener("keypress",e=>{e.key==="Enter"&&this.scanDirectory()}))}handleFolderSelect(e){let t=e.target.files;if(t.length>0){let s=t[0].webkitRelativePath.split("/")[0];this.dirPathInput.value=`${c.t("Dossier s\xE9lectionn\xE9")}: ${s} (${t.length} ${c.t("fichiers")})`,this.processFilesFromBrowser(t)}}async processFilesFromBrowser(e){this.setLoading(!0),this.metadataBody.innerHTML="",this.files=[],this.modifiedIndices.clear();let t=[".mp3",".flac",".m4a",".wav",".ogg"],s=[".jpg",".jpeg",".png",".webp"];for(let i of e){let n="."+i.name.split(".").pop().toLowerCase();t.includes(n)?this.files.push({type:"audio",fileName:i.name,filePath:i.webkitRelativePath,title:i.name.replace(/\.[^/.]+$/,""),artist:"",album:"",genre:"",year:"",track:"",format:n.substring(1).toUpperCase(),browserFile:i}):s.includes(n)&&this.files.push({type:"image",fileName:i.name,filePath:i.webkitRelativePath,title:i.name,format:n.substring(1).toUpperCase(),browserFile:i})}this.filteredFiles=[...this.files],this.renderTable(),this.updateToolbar(),this.setLoading(!1)}async scanDirectory(){if(this.metadataBody.innerHTML="",this.filteredFiles.length===0){this.emptyState.classList.remove("hidden"),this.toolbar.classList.add("hidden");return}this.emptyState.classList.add("hidden"),this.toolbar.classList.remove("hidden"),this.renderTable(),this.updateToolbar()}renderTable(){if(this.metadataBody.innerHTML="",this.filteredFiles.length===0){this.emptyState.classList.remove("hidden"),this.toolbar.classList.add("hidden");return}this.emptyState.classList.add("hidden"),this.toolbar.classList.remove("hidden"),this.filteredFiles.forEach((e,t)=>{let s=document.createElement("tr");this.modifiedIndices.has(t)&&s.classList.add("modified"),s.innerHTML=`
                <td class="col-type"><span class="badge-type badge-${e.type}">${e.type}</span></td>
                <td class="col-filename" title="${e.fileName}">${e.fileName}</td>
                <td class="col-title"><div class="editable-cell" contenteditable="true" data-field="title" data-index="${t}">${e.title||""}</div></td>
                <td class="col-artist"><div class="editable-cell" contenteditable="true" data-field="artist" data-index="${t}">${e.artist||""}</div></td>
                <td class="col-album"><div class="editable-cell" contenteditable="true" data-field="album" data-index="${t}">${e.album||""}</div></td>
                <td class="col-genre"><div class="editable-cell" contenteditable="true" data-field="genre" data-index="${t}">${e.genre||""}</div></td>
                <td class="col-year"><div class="editable-cell" contenteditable="true" data-field="year" data-index="${t}">${e.year||""}</div></td>
                <td class="col-track"><div class="editable-cell" contenteditable="true" data-field="track" data-index="${t}">${e.track||""}</div></td>
                <td class="col-actions">
                    <button class="btn-icon-small" title="Aper\xE7u"><i data-lucide="eye" style="width: 14px; height: 14px;"></i></button>
                </td>
            `,s.querySelectorAll(".editable-cell").forEach(n=>{n.addEventListener("input",a=>{let o=a.target.dataset.field,r=parseInt(a.target.dataset.index),d=a.target.innerText.trim();this.files[r][o]=d,this.modifiedIndices.add(r),s.classList.add("modified"),this.updateToolbar()})}),this.metadataBody.appendChild(s)}),window.lucide&&window.lucide.createIcons()}filterFiles(e){let t=e.toLowerCase();this.filteredFiles=this.files.filter(s=>s.fileName.toLowerCase().includes(t)||s.title&&s.title.toLowerCase().includes(t)||s.artist&&s.artist.toLowerCase().includes(t)||s.album&&s.album.toLowerCase().includes(t)),this.renderTable()}updateToolbar(){let e=this.modifiedIndices.size;this.statusText=document.getElementById("metaStatusText"),this.statusText.innerText=`${this.files.length} ${c.t("fichiers charg\xE9s")} | ${e} ${c.t("modifi\xE9s")}`,e>0?this.applyAllBtn.classList.remove("hidden"):this.applyAllBtn.classList.add("hidden"),this.files.length>0?this.magicBtn.classList.remove("hidden"):this.magicBtn.classList.add("hidden")}magicAutoTag(){this.files.length!==0&&(this.files.forEach((e,t)=>{let s=e.fileName.replace(/\.[^/.]+$/,"");if(s.includes(" - ")){let i=s.split(" - ");i.length>=2&&(e.artist=i[0].trim(),e.title=i[1].trim(),this.modifiedIndices.add(t))}else e.title=s.replace(/[_-]/g," ").trim(),this.modifiedIndices.add(t)}),this.renderTable(),this.updateToolbar())}async applyAllChanges(){if(this.modifiedIndices.size===0)return;let e=`${c.t("Voulez-vous appliquer les modifications \xE0")} ${this.modifiedIndices.size} ${c.t("fichiers")} ?`;if(!confirm(e))return;this.setApplyLoading(!0);let t=Array.from(this.modifiedIndices),s=0;for(let i of t){let n=this.files[i];try{(await(await fetch("/api/metadata/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filePath:n.filePath,metadata:{title:n.title,artist:n.artist,album:n.album,genre:n.genre,year:n.year,track:n.track}})})).json()).success&&s++}catch(a){console.error(`Error updating ${n.fileName}:`,a)}}this.setApplyLoading(!1),alert(`${s} ${c.t("fichiers")} ${c.t("mis \xE0 jour avec succ\xE8s !")}`),this.modifiedIndices.clear(),this.renderTable(),this.updateToolbar()}setLoading(e){e?this.loadingOverlay.classList.remove("hidden"):this.loadingOverlay.classList.add("hidden")}setApplyLoading(e){let t=this.applyAllBtn.querySelector(".btn-text"),s=this.applyAllBtn.querySelector(".btn-loader");e?(t.innerText=c.t("Application..."),s.classList.remove("hidden"),this.applyAllBtn.disabled=!0):(t.innerHTML=`<i data-lucide="save" class="inline-icon"></i> ${c.t("Appliquer les modifications")}`,s.classList.add("hidden"),this.applyAllBtn.disabled=!1),window.lucide&&window.lucide.createIcons()}}});var ee,Te=S(()=>{Q();ee=class{constructor(){this.dom={tab:document.getElementById("tab-torrent"),status:document.getElementById("torrentConnectionStatus"),loginOverlay:document.getElementById("torrentLoginOverlay"),user:document.getElementById("qbitUser"),pass:document.getElementById("qbitPass"),loginBtn:document.getElementById("qbitLoginBtn"),listBody:document.getElementById("torrentListBody"),addBtn:document.getElementById("torrentAddBtn"),magnetBtn:document.getElementById("torrentMagnetBtn"),fileInput:document.getElementById("torrentFileInput"),addModal:document.getElementById("addTorrentModal"),addOverlay:document.getElementById("addTorrentOverlay"),closeAddModal:document.getElementById("closeAddModal"),magnetInput:document.getElementById("magnetInput"),submitAdd:document.getElementById("submitAddTorrent"),pasteBtn:document.getElementById("pasteMagnetBtn"),totalDl:document.getElementById("totalDlSpeed"),totalUl:document.getElementById("totalUlSpeed"),pauseAll:document.getElementById("torrentPauseAllBtn"),resumeAll:document.getElementById("torrentResumeAllBtn")},this.pollingInterval=null,this.cache=new Map,this.completedTorrents=new Set,this.init()}init(){this.dom.tab&&(this.dom.loginBtn.addEventListener("click",()=>this.login()),this.dom.addBtn.addEventListener("click",()=>this.dom.fileInput.click()),this.dom.fileInput.addEventListener("change",e=>this.handleFileSelect(e)),this.dom.magnetBtn.addEventListener("click",()=>this.showAddModal()),this.dom.closeAddModal.addEventListener("click",()=>this.hideAddModal()),this.dom.addOverlay.addEventListener("click",()=>this.hideAddModal()),this.dom.submitAdd.addEventListener("click",()=>this.addTorrent()),this.dom.pasteBtn.addEventListener("click",async()=>{try{let e=await navigator.clipboard.readText();this.dom.magnetInput.value=e}catch(e){console.error("Failed to read clipboard",e)}}),this.dom.pauseAll.addEventListener("click",()=>this.globalAction("pause")),this.dom.resumeAll.addEventListener("click",()=>this.globalAction("resume")),this.startPolling())}startPolling(){this.pollingInterval=setInterval(()=>{this.dom.tab.classList.contains("active")&&this.fetchData()},2e3),setTimeout(()=>{this.dom.tab.classList.contains("active")&&this.fetchData()},500)}async login(){try{let e=this.dom.user.value,t=this.dom.pass.value;(await(await fetch("/api/torrent/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})})).json()).success?(this.dom.loginOverlay.classList.add("hidden"),this.fetchData()):alert("Login failed")}catch(e){console.error(e),alert("Login error")}}async fetchData(){try{let e=await fetch("/api/torrent/list");if(e.status===403||e.status===401){this.dom.loginOverlay.classList.remove("hidden"),this.updateStatus(!1);return}let t=await e.json();this.dom.loginOverlay.classList.add("hidden"),this.updateStatus(!0),this.render(t)}catch(e){console.error("Fetch error:",e),this.updateStatus(!1)}}updateStatus(e){e?(this.dom.status.innerHTML='<i data-lucide="check-circle" class="status-icon"></i> CONNECT\xC9',this.dom.status.className="status-badge connected"):(this.dom.status.innerHTML='<i data-lucide="power" class="status-icon"></i> D\xC9CONNECT\xC9',this.dom.status.className="status-badge disconnected"),k()}visibleTorrents=new Set;render(e){if(!Array.isArray(e)){console.error("Expected array of torrents, got:",e);return}let t=0,s=0,i=new Set;e.forEach(n=>{t+=n.dlspeed,s+=n.upspeed,i.add(n.hash);let a=this.cache.get(n.hash);a||(a=this.createRow(n),this.dom.listBody.appendChild(a),this.cache.set(n.hash,a)),this.updateRow(a,n),n.progress===1&&!this.completedTorrents.has(n.hash)&&(this.completedTorrents.add(n.hash),document.dispatchEvent(new CustomEvent("app-notification",{detail:{title:"Torrent termin\xE9",message:`Le t\xE9l\xE9chargement de "${n.name}" est fini.`,type:"success",icon:"package"}})))});for(let[n,a]of this.cache)i.has(n)||(a.remove(),this.cache.delete(n));this.dom.totalDl.textContent=R(t),this.dom.totalUl.textContent=R(s),k()}createRow(e){let t=document.createElement("div");return t.className="torrent-item",t.innerHTML=`
            <div class="torrent-icon"><i data-lucide="package"></i></div>
            <div class="torrent-name-col">
                <div class="torrent-name" title="${e.name}">${e.name}</div>
                <div class="torrent-meta">
                    <span class="meta-peers"><i data-lucide="users" class="inline-icon"></i> ${e.num_leechs}/${e.num_seeds}</span>
                    <span class="meta-eta"><i data-lucide="clock" class="inline-icon"></i> ${le(e.eta)}</span>
                </div>
            </div>
            <div class="size-col">${q(e.total_size)}</div>
            <div class="progress-col">
                <div class="progress-track">
                    <div class="progress-fill" style="width: ${e.progress*100}%"></div>
                </div>
                <div class="progress-text">${(e.progress*100).toFixed(1)}%</div>
            </div>
            <div class="speed-col">
                <div class="speed-down"><i data-lucide="arrow-down" class="inline-icon"></i> ${R(e.dlspeed)}</div>
                <div class="speed-up"><i data-lucide="arrow-up" class="inline-icon"></i> ${R(e.upspeed)}</div>
            </div>
            <div class="actions-col">
                <button class="btn-icon-s action-toggle" title="Pause/Resume">
                    <i data-lucide="${e.state==="pausedDL"||e.state==="pausedUP"?"play":"pause"}"></i>
                </button>
                <button class="btn-icon-s delete action-delete" title="Supprimer"><i data-lucide="trash-2"></i></button>
            </div>
        `,t.querySelector(".action-toggle").addEventListener("click",()=>{let s=e.state==="pausedDL"||e.state==="pausedUP";this.singleAction(s?"resume":"pause",e.hash)}),t.querySelector(".action-delete").addEventListener("click",()=>{confirm(`Supprimer ${e.name} ?`)&&this.singleAction("delete",e.hash)}),t}updateRow(e,t){e.querySelector(".torrent-name").textContent=t.name,e.querySelector(".meta-peers").innerHTML=`<i data-lucide="users" class="inline-icon"></i> ${t.num_leechs}L / ${t.num_seeds}S`,e.querySelector(".meta-eta").innerHTML=`<i data-lucide="clock" class="inline-icon"></i> ${le(t.eta)}`,e.querySelector(".size-col").textContent=q(t.total_size),e.querySelector(".progress-fill").style.width=`${t.progress*100}%`,e.querySelector(".progress-text").textContent=`${(t.progress*100).toFixed(1)}%`,e.querySelector(".speed-down").innerHTML=`<i data-lucide="arrow-down" class="inline-icon"></i> ${R(t.dlspeed)}`,e.querySelector(".speed-up").innerHTML=`<i data-lucide="arrow-up" class="inline-icon"></i> ${R(t.upspeed)}`;let s=e.querySelector(".action-toggle"),i=t.state==="pausedDL"||t.state==="pausedUP"||t.state==="stoppedDL"||t.state==="stoppedUP";s.innerHTML=`<i data-lucide="${i?"play":"pause"}"></i>`,k(),t.state.includes("error")?e.style.borderLeft="4px solid #ef4444":t.progress===1?e.style.borderLeft="4px solid #3b82f6":i?e.style.borderLeft="4px solid #6b7280":e.style.borderLeft="4px solid #10b981"}showAddModal(){this.dom.addModal.classList.add("visible"),this.dom.addOverlay.classList.add("visible"),this.dom.magnetInput.focus()}hideAddModal(){this.dom.addModal.classList.remove("visible"),this.dom.addOverlay.classList.remove("visible"),this.dom.magnetInput.value=""}async addTorrent(){let e=this.dom.magnetInput.value.trim();if(e){this.dom.submitAdd.textContent="Envoi...";try{await fetch("/api/torrent/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({urls:e})}),this.hideAddModal(),this.fetchData()}catch(t){alert("Erreur: "+t.message)}finally{this.dom.submitAdd.textContent="T\xE9l\xE9charger"}}}async handleFileSelect(e){let t=e.target.files[0];if(t){if(!t.name.endsWith(".torrent")){alert("Veuillez s\xE9lectionner un fichier .torrent");return}await this.addTorrentFile(t),e.target.value=""}}async addTorrentFile(e){let t=new FormData;t.append("torrents",e);let s=this.dom.addBtn.innerHTML;this.dom.addBtn.disabled=!0,this.dom.addBtn.innerHTML='<span class="btn-loader"></span>';try{let i=await fetch("/api/torrent/add-file",{method:"POST",body:t});if(i.ok)this.fetchData();else{let n=await i.json();alert("Erreur: "+(n.error||"\xC9chec de l'ajout du torrent"))}}catch(i){console.error(i),alert("Erreur de connexion")}finally{this.dom.addBtn.disabled=!1,this.dom.addBtn.innerHTML=s,k()}}async singleAction(e,t){try{await fetch(`/api/torrent/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hashes:t})}),setTimeout(()=>this.fetchData(),200)}catch(s){console.error(s)}}async globalAction(e){let t=Array.from(this.cache.keys()).join("|");t&&(await fetch(`/api/torrent/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hashes:t})}),setTimeout(()=>this.fetchData(),500))}}});var te,Ce=S(()=>{te=class{constructor(){this.socket=io(),this.myId=null,this.peers=new Map,this.dataChannels=new Map,this.devicesGrid=document.getElementById("devicesGrid"),this.fileInput=document.getElementById("localdropFileInput"),this.modal=document.getElementById("transferModal"),this.targetPeerId=null,this.initSocket(),this.initEvents()}initShare(e){let t=window.location.hostname,s=window.location.port;(t==="localhost"||t==="127.0.0.1")&&e&&(t=e);let i=`http://${t}${s?":"+s:""}/#localdrop`,n=document.getElementById("localUrlDisplay");n&&(n.textContent=i);let a=document.getElementById("copyUrlBtn");a&&a.addEventListener("click",()=>{navigator.clipboard.writeText(i);let r=a.innerHTML;a.innerHTML='<i data-lucide="check"></i>',window.lucide&&window.lucide.createIcons(),setTimeout(()=>{a.innerHTML=r,window.lucide&&window.lucide.createIcons()},2e3)});let o=document.getElementById("qrcode");o&&window.QRCode&&(o.innerHTML="",new QRCode(o,{text:i,width:120,height:120,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H}))}initSocket(){this.socket.on("init",e=>{this.myId=e.id;let t=document.getElementById("myName"),s=document.getElementById("myAvatar");t&&(t.textContent=e.name),s&&(s.textContent=e.name.charAt(0),s.style.background=this.getAvatarColor(e.name)),this.initShare(e.serverIp)}),this.socket.on("clients-list",e=>{e.forEach(t=>this.addDeviceCard(t))}),this.socket.on("client-connected",e=>{this.addDeviceCard(e)}),this.socket.on("client-disconnected",e=>{this.removeDeviceCard(e),this.peers.has(e)&&(this.peers.get(e).close(),this.peers.delete(e)),this.dataChannels.delete(e)}),this.socket.on("signal",async({from:e,signal:t})=>{this.peers.has(e)||this.createPeerConnection(e,!1);let s=this.peers.get(e);try{if(t.type==="offer"){await s.setRemoteDescription(new RTCSessionDescription(t));let i=await s.createAnswer();await s.setLocalDescription(i),this.socket.emit("signal",{to:e,from:this.myId,signal:i})}else t.type==="answer"?await s.setRemoteDescription(new RTCSessionDescription(t)):t.candidate&&await s.addIceCandidate(new RTCIceCandidate(t))}catch(i){console.error("Signal error:",i)}})}initEvents(){this.fileInput.addEventListener("change",e=>{let t=e.target.files[0];t&&this.targetPeerId&&this.sendFile(this.targetPeerId,t)})}getAvatarColor(e){let t=["#3b82f6","#10b981","#ef4444","#f59e0b","#8b5cf6","#ec4899","#06b6d4"],s=0;for(let i=0;i<e.length;i++)s=e.charCodeAt(i)+((s<<5)-s);return t[Math.abs(s)%t.length]}addDeviceCard(e){let t=this.devicesGrid.querySelector(".no-devices");if(t&&t.remove(),document.getElementById(`device-${e.id}`))return;let s=document.createElement("div");s.id=`device-${e.id}`,s.className="device-card",s.innerHTML=`
            <div class="device-avatar" style="background: ${this.getAvatarColor(e.name)}">${e.name.charAt(0)}</div>
            <div class="device-name">${e.name}</div>
        `,s.addEventListener("click",()=>{this.targetPeerId=e.id,this.fileInput.click()}),this.devicesGrid.appendChild(s)}removeDeviceCard(e){let t=document.getElementById(`device-${e}`);t&&t.remove(),this.devicesGrid.children.length===0&&(this.devicesGrid.innerHTML=`
                <div class="no-devices">
                    <div class="no-devices-icon"><i data-lucide="radar"></i></div>
                    <p>Recherche d'autres appareils sur le r\xE9seau...</p>
                    <p class="subtext">Ouvrez Ultra Dashboard sur un autre appareil pour le voir ici.</p>
                </div>
            `,window.lucide&&window.lucide.createIcons())}createPeerConnection(e,t){let s=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});if(this.peers.set(e,s),s.onicecandidate=i=>{i.candidate&&this.socket.emit("signal",{to:e,from:this.myId,signal:i.candidate})},t){let i=s.createDataChannel("fileTransfer");this.setupDataChannel(e,i),s.createOffer().then(n=>{s.setLocalDescription(n),this.socket.emit("signal",{to:e,from:this.myId,signal:n})})}else s.ondatachannel=i=>{this.setupDataChannel(e,i.channel)};return s}setupDataChannel(e,t){this.dataChannels.set(e,t);let s=[],i=null;t.onopen=()=>console.log(`Data Channel open with ${e}`),t.onclose=()=>console.log(`Data Channel closed with ${e}`),t.onmessage=n=>{let a=n.data;if(typeof a=="string"){let o=JSON.parse(a);o.type==="metadata"&&(i=o.data,s=[],this.showTransferModal(i.name,"R\xE9ception..."))}else{s.push(a);let o=Math.round(s.length*16384/i.size*100);if(this.updateProgress(o),s.length*16384>=i.size){let r=new Blob(s),d=URL.createObjectURL(r);this.updateProgress(100);let u=document.getElementById("transferStatus");u.innerHTML=`Transfert termin\xE9 ! <br><a href="${d}" download="${i.name}" class="btn-primary btn-sm" style="display:inline-block; margin-top:10px; text-decoration:none; padding: 5px 10px; background: var(--primary); color: white; border-radius: 4px;">T\xE9l\xE9charger ${i.name}</a>`;let h=u.querySelector("a");h.onclick=()=>{setTimeout(()=>{URL.revokeObjectURL(d),this.hideTransferModal(),u.textContent="Pr\xEAt"},1e3)}}}}}async sendFile(e,t){if(this.peers.has(e))this.dataChannels.get(e).readyState==="open"?this._performSend(e,t):this._performSend(e,t);else{this.createPeerConnection(e,!0);let s=setInterval(()=>{let i=this.dataChannels.get(e);i&&i.readyState==="open"&&(clearInterval(s),this._performSend(e,t))},100)}}_performSend(e,t){let s=this.dataChannels.get(e);if(!s)return;this.showTransferModal(t.name,`Envoi vers ${e}...`),s.send(JSON.stringify({type:"metadata",data:{name:t.name,size:t.size,type:t.type}}));let i=16384,n=new FileReader,a=0;n.onload=r=>{s.send(r.target.result),a+=r.target.result.byteLength;let d=Math.round(a/t.size*100);this.updateProgress(d),a<t.size?o():setTimeout(()=>this.hideTransferModal(),1e3)};let o=()=>{let r=t.slice(a,a+i);n.readAsArrayBuffer(r)};o()}showTransferModal(e,t){this.modal.classList.remove("hidden"),document.getElementById("transferFileName").textContent=e,document.getElementById("transferStatus").textContent=t,this.updateProgress(0)}updateProgress(e){e=Math.min(e,100),document.getElementById("transferPercent").textContent=`${e}%`,document.getElementById("transferProgressFill").style.width=`${e}%`}hideTransferModal(){this.modal.classList.add("hidden")}}});var se,xe=S(()=>{M();se=class{constructor(){this.widgets=[],this.locked=!1,this.initialized=!1,this.init()}async init(){if(this.initialized)return;let e=[{id:"clock",type:"clock",title:"Heure & Date",w:6},{id:"weather",type:"weather",title:"M\xE9t\xE9o",w:3},{id:"quick-actions",type:"quick-actions",title:"Actions Rapides",w:3}];this.widgets=await m.get("ultra-home-widgets",e),this.locked=await m.get("ultra-home-locked",!1),this.renderWidgets(),this.startClock(),this.bindEvents(),this.updateAllWeather(),this.initialized=!0,console.log("\u{1F3E0} Home Module Initialized (SQLite)")}bindEvents(){let e=document.getElementById("addWidgetBtn"),t=document.getElementById("lockWidgetsBtn"),s=document.getElementById("closeWidgetStore"),i=document.getElementById("widgetStoreOverlay");e&&e.addEventListener("click",()=>this.openWidgetStore()),t&&(t.addEventListener("click",()=>this.toggleLock()),this.updateLockUI()),s&&s.addEventListener("click",()=>this.closeWidgetStore()),i&&i.addEventListener("click",u=>{u.target===i&&this.closeWidgetStore()}),document.querySelectorAll(".store-item").forEach(u=>{u.addEventListener("click",()=>{let h=u.dataset.widgetType;this.addWidget(h),this.closeWidgetStore()})});let a=document.getElementById("closeWidgetSettings");a&&a.addEventListener("click",()=>this.closeWidgetSettings());let o=document.getElementById("saveWidgetSettings");o&&o.addEventListener("click",()=>this.saveCurrentWidgetSettings());let r=document.getElementById("widgetSettingsOverlay");r&&r.addEventListener("click",u=>{u.target===r&&this.closeWidgetSettings()}),document.querySelectorAll(".store-nav-item").forEach(u=>{u.addEventListener("click",()=>{this.filterStoreByCategory(u.dataset.category)})})}openWidgetStore(){let e=document.getElementById("widgetStoreOverlay");e&&e.classList.add("active")}closeWidgetStore(){let e=document.getElementById("widgetStoreOverlay");e&&e.classList.remove("active")}openWidgetSettings(e){let t=this.widgets.find(n=>n.id===e);if(!t)return;this.currentConfiguringWidgetId=e;let s=document.getElementById("widgetSettingsOverlay"),i=document.getElementById("widgetSettingsContent");s&&i&&(i.innerHTML=this.getWidgetSettingsHTML(t),s.classList.add("active"),this.bindSettingsEvents())}closeWidgetSettings(){let e=document.getElementById("widgetSettingsOverlay");e&&e.classList.remove("active"),this.currentConfiguringWidgetId=null}filterStoreByCategory(e){document.querySelectorAll(".store-nav-item").forEach(s=>{s.classList.toggle("active",s.dataset.category===e)}),document.querySelectorAll(".store-item").forEach(s=>{let i=s.dataset.categories||"";e==="all"?s.style.display="flex":s.style.display=i.includes(e)?"flex":"none"})}async toggleLock(){this.locked=!this.locked,await m.set("ultra-home-locked",this.locked),this.updateLockUI(),this.renderWidgets()}updateLockUI(){let e=document.getElementById("lockWidgetsBtn"),t=document.getElementById("addWidgetBtn");e&&(this.locked?(e.innerHTML='<i data-lucide="lock"></i>',e.classList.add("locked"),e.title="D\xE9verrouiller le dashboard",t&&(t.style.display="none")):(e.innerHTML='<i data-lucide="unlock"></i>',e.classList.remove("locked"),e.title="Verrouiller le dashboard",t&&(t.style.display="flex")),window.lucide&&window.lucide.createIcons())}async addWidget(e){if(this.widgets.find(s=>s.type===e)){console.warn("Widget already exists");return}let t={id:e+"-"+Date.now(),type:e,title:this.getWidgetTitle(e),w:this.getWidgetWidth(e),config:this.getDefaultConfig(e)};this.widgets.push(t),await this.saveWidgets(),this.renderWidgets()}async saveWidgets(){await m.set("ultra-home-widgets",this.widgets)}getWidgetWidth(e){switch(e){case"clock":return 6;case"weather":return 3;case"quick-actions":return 3;case"system":return 3;case"note":return 4;case"news":return 4;case"downloads":return 4;case"notifications":return 4;default:return 3}}getWidgetTitle(e){switch(e){case"clock":return"Heure & Date";case"weather":return"M\xE9t\xE9o";case"quick-actions":return"Actions Rapides";case"system":return"Syst\xE8me";case"note":return"Notes";case"news":return"Actualit\xE9s";case"downloads":return"T\xE9l\xE9chargements";case"notifications":return"Notifications";default:return"Widget"}}getDefaultConfig(e){switch(e){case"news":return{rssUrl:"https://www.franceinfo.fr/titres.rss",limit:4};case"quick-actions":return{actions:["convert","youtube"]};default:return{}}}isConfigurable(e){return["news","quick-actions"].includes(e)}renderWidgets(){let e=document.getElementById("homeWidgetGrid");e&&(e.innerHTML="",this.widgets.forEach(t=>{let s=document.createElement("div");s.id=`widget-instance-${t.id}`,s.className=`widget-card widget-${t.type}`,s.style.gridColumn=`span ${t.w}`,s.innerHTML=this.getWidgetHTML(t);let i=s.querySelector(".btn-remove-widget");i&&i.addEventListener("click",async a=>{a.stopPropagation(),this.widgets=this.widgets.filter(o=>o.id!==t.id),await this.saveWidgets(),this.renderWidgets()});let n=s.querySelector(".btn-widget-settings");n&&n.addEventListener("click",a=>{a.stopPropagation(),this.openWidgetSettings(t.id)}),e.appendChild(s),t.type==="weather"?this.fetchWeatherForWidget(t.id):t.type==="note"?this.initNoteWidget(t.id):t.type==="news"?this.fetchNewsForWidget(t.id):t.type==="downloads"?this.updateDownloadsForWidget(t.id):t.type==="notifications"&&this.updateNotificationsForWidget(t.id)}),window.lucide&&window.lucide.createIcons())}getWidgetHTML(e){let t=`
            <div class="widget-header">
                <span class="widget-title">
                    <i data-lucide="${this.getWidgetIcon(e.type)}"></i> ${e.title}
                </span>
                <div class="widget-controls">
                    ${this.locked?"":`
                        ${this.isConfigurable(e.type)?'<button class="btn-widget-control btn-widget-settings"><i data-lucide="settings"></i></button>':""}
                        <button class="btn-widget-control btn-remove-widget"><i data-lucide="x"></i></button>
                    `}
                </div>
            </div>
        `,s="";switch(e.type){case"clock":s=`
                    <div class="clock-display">
                        <div class="time" id="widgetTime">00:00</div>
                        <div class="date" id="widgetDate">Lundi 1 Janvier</div>
                    </div>
                `;break;case"weather":s=`
                    <div class="weather-content" id="weather-content-${e.id}">
                        <div class="weather-info">
                            <span class="weather-temp">--\xB0C</span>
                            <span class="weather-desc">Chargement...</span>
                        </div>
                        <div class="weather-icon-large">\u23F3</div>
                    </div>
                    <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 8px;" id="weather-location-${e.id}">
                        <i data-lucide="map-pin" style="width: 12px"></i> Localisation...
                    </div>
                `;break;case"quick-actions":let i=e.config?.actions||["convert","youtube"];s=`
                    <div class="quick-actions-grid">
                        ${i.includes("convert")?`
                        <button class="quick-action-btn" onclick="document.querySelector('[data-tab=\\'convert\\']').click()">
                            <i data-lucide="refresh-cw"></i> <span>Convertir</span>
                        </button>`:""}
                        ${i.includes("youtube")?`
                        <button class="quick-action-btn" onclick="document.querySelector('[data-tab=\\'youtube\\']').click()">
                            <i data-lucide="youtube"></i> <span>YouTube</span>
                        </button>`:""}
                        ${i.includes("torrent")?`
                        <button class="quick-action-btn" onclick="document.querySelector('[data-tab=\\'torrent\\']').click()">
                            <i data-lucide="download"></i> <span>Torrents</span>
                        </button>`:""}
                        ${i.includes("databank")?`
                        <button class="quick-action-btn" onclick="document.querySelector('[data-tab=\\'databank\\']').click()">
                            <i data-lucide="database"></i> <span>Databank</span>
                        </button>`:""}
                        ${i.includes("chat")?`
                        <button class="quick-action-btn" onclick="document.querySelector('[data-tab=\\'chat\\']').click()">
                            <i data-lucide="message-square"></i> <span>AI Chat</span>
                        </button>`:""}
                    </div>
                `;break;case"note":s=`
                    <textarea id="note-${e.id}" placeholder="\xC9crire une note..."></textarea>
                `;break;case"news":s=`
                    <div class="news-list" id="news-list-${e.id}">
                        <div style="color: var(--text-muted); padding: 20px; text-align: center;">Chargement des actus...</div>
                    </div>
                `;break;case"downloads":s=`
                    <div class="download-status-list" id="download-list-${e.id}">
                        <div style="color: var(--text-muted); padding: 20px; text-align: center;">Aucun t\xE9l\xE9chargement actif</div>
                    </div>
                `;break;case"notifications":s=`
                    <div class="notifications-list" id="notifications-list-${e.id}">
                        <div style="color: var(--text-muted); padding: 20px; text-align: center;">Aucune notification</div>
                    </div>
                `;break;default:s='<div style="padding: 20px; text-align: center; color: var(--text-muted)">Contenu du widget...</div>'}return t+s}async initNoteWidget(e){let t=document.getElementById(`note-${e}`);t&&(t.value=await m.get(`ultra-note-${e}`,""),t.addEventListener("input",async s=>{await m.set(`ultra-note-${e}`,s.target.value)}))}async fetchNewsForWidget(e){let t=document.getElementById(`news-list-${e}`);if(!t)return;let s=this.widgets.find(a=>a.id===e),i=s?.config?.rssUrl||"https://www.franceinfo.fr/titres.rss",n=s?.config?.limit||4;try{let a=`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(i)}`,r=await(await fetch(a)).json();if(r.status==="ok"){let d=r.items.slice(0,n);t.innerHTML=d.map(u=>`
                    <a href="${u.link}" target="_blank" class="news-item">
                        <span class="news-title">${u.title}</span>
                        <span class="news-meta">${r.feed.title||"RSS"} \u2022 ${new Date(u.pubDate).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}</span>
                    </a>
                `).join("")}else throw new Error("RSS conversion failed")}catch(a){console.error("News fetch error:",a),t.innerHTML='<div style="color: var(--error); font-size: 0.82rem; text-align: center; padding: 15px;">Impossible de charger les actualit\xE9s.</div>'}}async updateDownloadsForWidget(e){let t=document.getElementById(`download-list-${e}`);if(t)try{let s=await fetch("/api/torrent/list");if(s.ok){let i=await s.json(),n=(Array.isArray(i)?i:[]).filter(a=>a.progress<1).slice(0,2);n.length>0?t.innerHTML=n.map(a=>`
                        <div class="download-item">
                            <div class="download-info">
                                <span class="download-name">${a.name}</span>
                                <span class="download-percent">${Math.round(a.progress*100)}%</span>
                            </div>
                            <div class="progress-bar-bg">
                                <div class="progress-bar-fill" style="width: ${a.progress*100}%"></div>
                            </div>
                        </div>
                    `).join(""):t.innerHTML='<div style="color: var(--text-muted); font-size: 0.85rem; text-align: center; padding: 10px;">Aucun t\xE9l\xE9chargement en cours</div>'}}catch{t.innerHTML='<div style="color: var(--text-muted); font-size: 0.85rem; text-align: center; padding: 10px;">Service indisponible</div>'}}async updateNotificationsForWidget(e){let t=document.getElementById(`notifications-list-${e}`);if(!t)return;let i=(await m.get("ultra-notifications",[])).slice(0,3);i.length>0?(t.innerHTML=i.map(n=>`
                <div class="notification-item ${n.type} ${n.read?"read":"unread"}">
                    <div class="notification-icon">
                        <i data-lucide="${n.icon||"bell"}"></i>
                    </div>
                    <div class="notification-body">
                        <div class="notification-header-row">
                            <span class="notification-title">${n.title}</span>
                            <span class="notification-time">${this.formatRelativeTime(n.time)}</span>
                        </div>
                        <div class="notification-message">${n.message||""}</div>
                    </div>
                </div>
            `).join(""),window.lucide&&window.lucide.createIcons()):t.innerHTML='<div style="color: var(--text-muted); font-size: 0.85rem; text-align: center; padding: 20px;">Tout est en ordre !</div>'}formatRelativeTime(e){let t=new Date(e),i=new Date-t;if(isNaN(i))return"R\xE9cemment";if(i<6e4)return"\xC0 l'instant";let n=Math.floor(i/6e4);if(n<60)return`Il y a ${n}m`;let a=Math.floor(n/60);return a<24?`Il y a ${a}h`:t.toLocaleDateString("fr-FR",{day:"numeric",month:"short"})}updateAllWeather(){this.widgets.filter(e=>e.type==="weather").forEach(e=>this.fetchWeatherForWidget(e.id))}async fetchWeatherForWidget(e){let t={latitude:48.8566,longitude:2.3522,name:"Paris, France"};if(!navigator.geolocation){this.fetchWeatherFromAPI(e,t.latitude,t.longitude,t.name);return}navigator.geolocation.getCurrentPosition(async s=>{let{latitude:i,longitude:n}=s.coords;this.fetchWeatherFromAPI(e,i,n,"Position actuelle")},s=>{this.fetchWeatherFromAPI(e,t.latitude,t.longitude,t.name)},{timeout:5e3})}async fetchWeatherFromAPI(e,t,s,i){try{let n=`https://api.open-meteo.com/v1/forecast?latitude=${t}&longitude=${s}&current_weather=true&timezone=auto`,o=await(await fetch(n)).json();if(o.current_weather){let r={temp:Math.round(o.current_weather.temperature),code:o.current_weather.weathercode,lat:t,lon:s,locationName:i};this.updateWeatherUI(e,r)}}catch(n){console.error("Weather fetch error:",n),this.updateWeatherUI(e,{error:"Erreur API"})}}updateWeatherUI(e,t){let s=document.getElementById(`weather-content-${e}`),i=document.getElementById(`weather-location-${e}`);if(!s)return;if(t.error){s.innerHTML=`<div style="color: var(--error); font-size: 0.9rem; padding: 10px;">${t.error}</div>`;return}let n=this.getWeatherIconByCode(t.code),a=this.getWeatherDescByCode(t.code);s.innerHTML=`
            <div class="weather-info">
                <span class="weather-temp">${t.temp}\xB0C</span>
                <span class="weather-desc">${a}</span>
            </div>
            <div class="weather-icon-large">${n}</div>
        `,i&&(i.innerHTML=`<i data-lucide="map-pin" style="width: 12px"></i> ${t.locationName||"Position actuelle"}`,window.lucide&&window.lucide.createIcons())}getWeatherIconByCode(e){return e===0?"\u2600\uFE0F":e<=3?"\u{1F324}\uFE0F":e<=48?"\u2601\uFE0F":e<=67?"\u{1F327}\uFE0F":e<=77?"\u2744\uFE0F":e<=82?"\u{1F327}\uFE0F":e<=99?"\u26A1":"\u2600\uFE0F"}getWeatherDescByCode(e){return{0:"Ciel d\xE9gag\xE9",1:"Principalement d\xE9gag\xE9",2:"Partiellement nuageux",3:"Couvert",45:"Brouillard",48:"Brouillard givrant",51:"Bruine l\xE9g\xE8re",53:"Bruine mod\xE9r\xE9e",55:"Bruine dense",61:"Pluie l\xE9g\xE8re",63:"Pluie mod\xE9r\xE9e",65:"Pluie forte",71:"Neige l\xE9g\xE8re",73:"Neige mod\xE9r\xE9e",75:"Neige forte",80:"Averses de pluie l\xE9g\xE8res",81:"Averses de pluie mod\xE9r\xE9es",82:"Averses de pluie violentes",95:"Orage",96:"Orage avec gr\xEAle l\xE9g\xE8re",99:"Orage avec gr\xEAle forte"}[e]||"Ensoleill\xE9"}getWidgetIcon(e){switch(e){case"clock":return"clock";case"weather":return"cloud-sun";case"quick-actions":return"zap";case"system":return"cpu";case"note":return"sticky-note";case"news":return"newspaper";case"downloads":return"download";case"notifications":return"bell";default:return"layout"}}startClock(){let e=()=>{let t=document.getElementById("widgetTime"),s=document.getElementById("widgetDate");if(t&&s){let i=new Date;t.textContent=i.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),s.textContent=i.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"})}};e(),setInterval(e,1e3)}getWidgetSettingsHTML(e){switch(e.type){case"news":return`
                    <div class="widget-config-form">
                        <div class="config-group">
                            <label>URL du flux RSS</label>
                            <input type="url" id="config-rss-url" value="${e.config?.rssUrl||""}" placeholder="https://example.com/rss">
                        </div>
                        <div class="config-group">
                            <label>Nombre d'actualit\xE9s</label>
                            <input type="number" id="config-rss-limit" value="${e.config?.limit||4}" min="1" max="10">
                        </div>
                    </div>
                `;case"quick-actions":let t=e.config?.actions||[];return`
                    <div class="widget-config-form">
                        <label>Actions \xE0 afficher</label>
                        <div class="actions-selector">
                            ${[{id:"convert",label:"Convertir",icon:"refresh-cw"},{id:"youtube",label:"YouTube",icon:"youtube"},{id:"torrent",label:"Torrents",icon:"download"},{id:"databank",label:"Databank",icon:"database"},{id:"chat",label:"AI Chat",icon:"message-square"}].map(i=>`
                                <div class="action-checkbox" data-action-id="${i.id}">
                                    <input type="checkbox" value="${i.id}" ${t.includes(i.id)?"checked":""}>
                                    <i data-lucide="${i.icon}"></i>
                                    <span>${i.label}</span>
                                </div>
                            `).join("")}
                        </div>
                    </div>
                `;default:return`<p style="text-align: center; color: var(--text-muted); padding: 20px;">Ce widget n'a pas de param\xE8tres configurables.</p>`}}bindSettingsEvents(){document.querySelectorAll(".action-checkbox").forEach(t=>{t.addEventListener("click",()=>{let i=t.querySelector("input");i.checked=!i.checked,t.classList.toggle("selected",i.checked)}),t.querySelector("input").checked&&t.classList.add("selected")}),window.lucide&&window.lucide.createIcons()}async saveCurrentWidgetSettings(){let e=this.widgets.find(t=>t.id===this.currentConfiguringWidgetId);if(e){if(e.type==="news"){let t=document.getElementById("config-rss-url").value,s=parseInt(document.getElementById("config-rss-limit").value);e.config={rssUrl:t,limit:s}}else if(e.type==="quick-actions"){let t=Array.from(document.querySelectorAll(".action-checkbox input:checked")).map(s=>s.value);e.config={actions:t}}await this.saveWidgets(),this.closeWidgetSettings(),this.renderWidgets()}}}});var ie,Be=S(()=>{ie=class{constructor(){this.items=[],this.folders=[],this.currentFolderId="root",this.breadcrumbs=[{id:"root",name:"Racine"}],this.currentPage=1,this.limit=20,this.isLoading=!1,this.refreshInterval=null,this.elements={grid:document.getElementById("databankGrid"),refreshBtn:document.getElementById("databankRefreshBtn"),clearBtn:document.getElementById("databankClearBtn"),search:document.getElementById("databankSearch"),filterType:document.getElementById("databankFilterType"),prevBtn:document.getElementById("databankPrevBtn"),nextBtn:document.getElementById("databankNextBtn"),pageInfo:document.getElementById("databankPageInfo"),pagination:document.getElementById("databankPagination"),previewModal:document.getElementById("databankPreviewModal"),closePreviewBtn:document.getElementById("closePreviewModal"),previewBody:document.getElementById("previewBody"),previewTitle:document.getElementById("previewTitle"),previewDownloadBtn:document.getElementById("previewDownloadBtn"),previewMeta:document.getElementById("previewMeta"),newFolderBtn:document.getElementById("databankNewFolderBtn"),breadcrumbs:document.getElementById("databankBreadcrumbs"),folderModal:document.getElementById("databankFolderModal"),closeFolderModal:document.getElementById("closeFolderModal"),confirmFolderBtn:document.getElementById("confirmFolderBtn"),cancelFolderBtn:document.getElementById("cancelFolderBtn"),folderNameInput:document.getElementById("folderName"),moveModal:document.getElementById("databankMoveModal"),closeMoveModal:document.getElementById("closeMoveModal"),folderList:document.getElementById("folderList")},this.init()}init(){this.setupEventListeners(),document.addEventListener("tab-changed",t=>{t.detail.tabId==="databank"?this.onTabActivate():this.onTabDeactivate()});let e=document.querySelector(".tab-content.active");e&&e.id==="tab-databank"&&this.onTabActivate(),window.databankModule=this}onTabActivate(){console.log("\u{1F4CA} Databank Activated"),this.loadItems(),this.startAutoRefresh()}onTabDeactivate(){this.stopAutoRefresh()}startAutoRefresh(){this.stopAutoRefresh(),this.refreshInterval=setInterval(()=>{this.loadItems(null,!0)},3e4)}stopAutoRefresh(){this.refreshInterval&&(clearInterval(this.refreshInterval),this.refreshInterval=null)}setupEventListeners(){this.elements.refreshBtn.addEventListener("click",()=>this.loadItems()),this.elements.clearBtn.addEventListener("click",()=>this.clearAll()),this.elements.search.addEventListener("input",this.debounce(()=>this.loadItems(1),500)),this.elements.filterType.addEventListener("change",()=>this.loadItems(1)),this.elements.prevBtn.addEventListener("click",()=>{this.currentPage>1&&this.loadItems(this.currentPage-1)}),this.elements.nextBtn.addEventListener("click",()=>{this.loadItems(this.currentPage+1)}),this.elements.newFolderBtn.addEventListener("click",()=>{this.elements.folderNameInput.value="",this.elements.folderModal.classList.add("active"),this.elements.folderNameInput.focus()}),this.elements.closeFolderModal.addEventListener("click",()=>this.elements.folderModal.classList.remove("active")),this.elements.cancelFolderBtn.addEventListener("click",()=>this.elements.folderModal.classList.remove("active")),this.elements.confirmFolderBtn.addEventListener("click",()=>this.createFolder()),this.elements.closePreviewBtn.addEventListener("click",()=>{this.elements.previewModal.classList.remove("active")}),this.elements.closeMoveModal.addEventListener("click",()=>this.elements.moveModal.classList.remove("active")),[this.elements.previewModal,this.elements.folderModal,this.elements.moveModal].forEach(e=>{e.addEventListener("click",t=>{t.target===e&&e.classList.remove("active")})})}async loadItems(e=null,t=!1){if(this.isLoading)return;this.isLoading=!0,e&&(this.currentPage=e);let s=(this.currentPage-1)*this.limit,i=this.elements.filterType.value!=="all"?this.elements.filterType.value:"",n=this.elements.search.value.trim();t||(this.elements.grid.innerHTML=`
                <div class="loading-spinner">
                    <div class="spinner"></div>
                    <p>Chargement...</p>
                </div>
            `);try{let a=new URL("/api/databank",window.location.origin);a.searchParams.append("limit",this.limit),a.searchParams.append("offset",s),i&&a.searchParams.append("type",i),n&&a.searchParams.append("search",n),this.currentFolderId!=="all"&&a.searchParams.append("folderId",this.currentFolderId==="root"?"root":this.currentFolderId);let o=[];if(this.currentFolderId!=="all"){let u=new URL("/api/databank/folders",window.location.origin);n&&u.searchParams.append("search",n),this.currentFolderId!=="root"&&!n&&u.searchParams.append("parentId",this.currentFolderId);let h=await fetch(u);h.ok&&(o=(await h.json()).folders||[])}let r=await fetch(a);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);let d=await r.json();this.items=d.items||[],this.folders=o,this.renderItems(),this.renderBreadcrumbs(),this.updatePagination(this.items.length)}catch(a){console.error("Error loading databank:",a),this.elements.grid.innerHTML='<div class="error-message"><p>Erreur lors du chargement des donn\xE9es</p></div>'}finally{this.isLoading=!1}}renderItems(){if(this.elements.grid.innerHTML="",this.items.length===0&&this.folders.length===0){this.elements.grid.innerHTML=`
                <div class="empty-state" style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--text-secondary);">
                    <i data-lucide="database" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                    <p>Aucune donn\xE9e trouv\xE9e</p>
                </div>
            `,window.lucide&&window.lucide.createIcons();return}this.folders.forEach(e=>{let t=document.createElement("div");t.className="databank-item folder-item",t.innerHTML=`
                <div class="databank-preview">
                    <i data-lucide="folder"></i>
                    <div class="databank-actions">
                        <button class="action-btn" title="Supprimer" onclick="event.stopPropagation(); window.databankModule.deleteFolder(${e.id})">
                            <i data-lucide="trash-2"></i>
                        </button>
                    </div>
                </div>
                <div class="databank-info">
                    <h4>${e.name}</h4>
                    <p>Dossier</p>
                </div>
            `,t.addEventListener("click",()=>this.navigateToFolder(e.id,e.name)),this.elements.grid.appendChild(t)}),this.items.forEach(e=>{let t=document.createElement("div");t.className="databank-item",e.metadata.tool==="plexus"&&t.classList.add("item-plexus");let s="";e.type==="image"?s=`<img src="${e.content}" alt="Image" loading="lazy">`:e.type==="audio"?s=e.metadata.thumbnail?`<img src="${e.metadata.thumbnail}" alt="Thumb">`:'<i data-lucide="music"></i>':e.type==="video"?s=e.metadata.thumbnail?`<img src="${e.metadata.thumbnail}" alt="Thumb">`:'<i data-lucide="video"></i>':e.type==="text"?s=`<div class="text-preview-snippet">${e.content.length>200?e.content.substring(0,200)+"...":e.content}</div>`:s='<i data-lucide="file-text"></i>';let i=new Date(e.created_at).toLocaleString(),n=e.metadata.originalName||e.metadata.title;!n&&e.type==="text"&&(n=e.content.split(`
`)[0].substring(0,50)),n||(n=`Item #${e.id}`);let a=e.metadata.tool||"Unknown",o=a==="plexus"?"sparkles":"cpu";t.innerHTML=`
                <div class="databank-preview">
                    ${s}
                    <span class="databank-type-badge">${e.type}</span>
                    <div class="databank-actions">
                        <button class="action-btn" title="T\xE9l\xE9charger" onclick="event.stopPropagation(); window.databankModule.downloadItem(${e.id})">
                            <i data-lucide="download"></i>
                        </button>
                        <button class="move-action" title="D\xE9placer" onclick="event.stopPropagation(); window.databankModule.openMoveModal(${e.id})">
                            <i data-lucide="folder-output"></i>
                        </button>
                        <button class="action-btn" title="Supprimer" onclick="event.stopPropagation(); window.databankModule.deleteItem(${e.id})">
                            <i data-lucide="trash-2"></i>
                        </button>
                    </div>
                </div>
                <div class="databank-info">
                    <h4>${n}</h4>
                    <p><i data-lucide="${o}" style="width:12px; height:12px;"></i> ${a} \u2022 ${i}</p>
                </div>
            `,t.addEventListener("click",()=>this.openPreview(e)),this.elements.grid.appendChild(t)}),window.lucide&&window.lucide.createIcons()}renderBreadcrumbs(){this.elements.breadcrumbs.innerHTML="",this.breadcrumbs.forEach((e,t)=>{let s=document.createElement("span");s.className=`breadcrumb-item ${t===this.breadcrumbs.length-1?"active":""}`,s.innerHTML=e.id==="root"?'<i data-lucide="home"></i> Racine':e.name,s.addEventListener("click",()=>this.navigateToBreadcrumb(t)),this.elements.breadcrumbs.appendChild(s)}),window.lucide&&window.lucide.createIcons()}navigateToFolder(e,t){this.currentFolderId=e,this.breadcrumbs.push({id:e,name:t}),this.currentPage=1,this.loadItems()}navigateToBreadcrumb(e){e!==this.breadcrumbs.length-1&&(this.breadcrumbs=this.breadcrumbs.slice(0,e+1),this.currentFolderId=this.breadcrumbs[e].id,this.currentPage=1,this.loadItems())}async createFolder(){let e=this.elements.folderNameInput.value.trim();if(e)try{(await fetch("/api/databank/folders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,parentId:this.currentFolderId==="root"?null:this.currentFolderId})})).ok&&(this.elements.folderModal.classList.remove("active"),this.loadItems())}catch(t){console.error("Error creating folder:",t)}}async deleteFolder(e){if(confirm("Voulez-vous supprimer ce dossier ? Les \xE9l\xE9ments qu'il contient seront d\xE9plac\xE9s vers le parent."))try{await fetch(`/api/databank/folders/${e}`,{method:"DELETE"}),this.loadItems()}catch(t){console.error("Error deleting folder:",t)}}async openMoveModal(e){this.elements.folderList.innerHTML='<div class="loading-spinner"><div class="spinner"></div></div>',this.elements.moveModal.classList.add("active");try{let i=(await(await fetch("/api/databank/folders")).json()).folders||[];this.elements.folderList.innerHTML="";let n=document.createElement("div");n.className="folder-select-item",n.innerHTML='<i data-lucide="home"></i><span>Racine</span>',n.onclick=()=>this.moveItemToFolder(e,null),this.elements.folderList.appendChild(n),i.forEach(a=>{let o=document.createElement("div");o.className="folder-select-item",o.innerHTML=`<i data-lucide="folder"></i><span>${a.name}</span>`,o.onclick=()=>this.moveItemToFolder(e,a.id),this.elements.folderList.appendChild(o)}),window.lucide&&window.lucide.createIcons()}catch(t){console.error("Error loading move folders:",t)}}async moveItemToFolder(e,t){try{await fetch(`/api/databank/${e}/folder`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({folderId:t})}),this.elements.moveModal.classList.remove("active"),this.loadItems()}catch(s){console.error("Error moving item:",s)}}updatePagination(e){this.elements.pagination.classList.toggle("hidden",e<this.limit&&this.currentPage===1),this.elements.pageInfo.textContent=`Page ${this.currentPage}`,this.elements.prevBtn.disabled=this.currentPage===1,this.elements.nextBtn.disabled=e<this.limit}openPreview(e){if(this.elements.previewTitle.textContent=e.metadata.originalName||`Item #${e.id}`,e.type==="image")this.elements.previewBody.innerHTML=`<img src="${e.content}" class="preview-image-full" alt="Preview">`;else if(e.type==="text")this.elements.previewBody.innerHTML=`<div class="preview-text-full">${e.content}</div>`;else if(e.type==="audio"){let s=e.metadata.thumbnail?`<img src="${e.metadata.thumbnail}" class="preview-image-full" style="max-height: 300px;">`:"";s+=`<div style="padding: 20px;"><audio controls style="width: 100%;"><source src="${e.content}"></audio></div>`,this.elements.previewBody.innerHTML=s}else e.type==="video"?this.elements.previewBody.innerHTML=`<div style="padding: 20px;"><video controls style="width: 100%; max-height: 70vh;"><source src="${e.content}"></video></div>`:this.elements.previewBody.innerHTML='<div style="text-align: center; padding: 40px;"><i data-lucide="file" style="font-size: 64px;"></i><p>Aper\xE7u non disponible</p></div>';let t=Object.entries(e.metadata).map(([s,i])=>`
            <div class="preview-meta-item">
                <strong>${s}</strong>
                <span>${i||"N/A"}</span>
            </div>
        `).join("");this.elements.previewMeta.innerHTML=`
            <div class="preview-meta-grid">
                <div class="preview-meta-item"><strong>ID</strong><span>#${e.id}</span></div>
                <div class="preview-meta-item"><strong>Type</strong><span>${e.type}</span></div>
                <div class="preview-meta-item"><strong>Date</strong><span>${new Date(e.created_at).toLocaleString()}</span></div>
                ${t}
            </div>
        `,this.elements.previewDownloadBtn.onclick=()=>this.downloadItem(e.id),this.elements.previewModal.classList.add("active"),window.lucide&&window.lucide.createIcons()}async downloadItem(e){let t=this.items.find(i=>i.id===e);if(!t)return;let s=document.createElement("a");s.href=t.content,s.download=t.metadata.originalName||`item-${e}`,s.click()}async deleteItem(e){if(confirm("Supprimer cet \xE9l\xE9ment ?"))try{await fetch(`/api/databank/${e}`,{method:"DELETE"}),this.loadItems()}catch(t){console.error("Error deleting item:",t)}}async clearAll(){if(confirm("TOUT effacer ? Cette action est irr\xE9versible."))try{await fetch("/api/databank/clear",{method:"POST"}),this.loadItems()}catch(e){console.error("Error clearing all:",e)}}debounce(e,t){let s;return function(...n){let a=()=>{clearTimeout(s),e(...n)};clearTimeout(s),s=setTimeout(a,t)}}}});var ne,Ae=S(()=>{M();P();ne=class{constructor(){this.notifications=[],this.initialized=!1,this.init()}async init(){this.initialized||(this.notifications=await m.get("ultra-notifications",[]),this.render(),this.updateBadge(),this.bindEvents(),this.initialized=!0,window.pushNotification=e=>this.push(e),document.addEventListener("app-notification",e=>{this.push(e.detail)}),console.log("\u{1F514} Notification Module Initialized"))}bindEvents(){let e=document.getElementById("clearAllNotifications");e&&e.addEventListener("click",()=>this.clearAll()),document.addEventListener("tab-changed",t=>{t.detail.tabId==="notifications"&&this.markAllAsRead()})}async push({title:e,message:t,type:s="info",icon:i=null}){let n={id:Date.now(),title:e,message:t,type:s,icon:i||this.getDefaultIcon(s),time:new Date().toISOString(),read:!1};this.notifications.unshift(n),this.notifications.length>50&&this.notifications.pop(),await m.set("ultra-notifications",this.notifications),this.render(),this.updateBadge(),Notification.permission==="granted"&&new Notification(e,{body:t})}async markAllAsRead(){let e=!1;this.notifications.forEach(t=>{t.read||(t.read=!0,e=!0)}),e&&(await m.set("ultra-notifications",this.notifications),this.updateBadge(),this.render())}async clearAll(){this.notifications=[],await m.set("ultra-notifications",this.notifications),this.render(),this.updateBadge()}updateBadge(){let e=document.getElementById("notifBadge");if(!e)return;let t=this.notifications.filter(s=>!s.read).length;t>0?(e.hidden=!1,e.textContent=t>9?"9+":t):e.hidden=!0}render(){let e=document.getElementById("notificationsList");e&&(this.notifications.length===0?e.innerHTML=`
                <div class="empty-notifications">
                    <div class="empty-icon">
                        <i data-lucide="bell-off"></i>
                    </div>
                    <h3>${c.t("Aucune notification")}</h3>
                    <p>${c.t("Vos nouvelles notifications appara\xEEtront ici.")}</p>
                </div>
            `:e.innerHTML=this.notifications.map(t=>`
                <div class="notification-item ${t.read?"":"unread"}" data-id="${t.id}">
                    <div class="notification-icon type-${t.type}">
                        <i data-lucide="${t.icon}"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-header">
                            <span class="notification-title">${t.title}</span>
                            <span class="notification-time">${this.formatTime(t.time)}</span>
                        </div>
                        <div class="notification-message">${t.message}</div>
                    </div>
                </div>
            `).join(""),window.lucide&&window.lucide.createIcons())}getDefaultIcon(e){switch(e){case"success":return"check-circle";case"error":return"alert-circle";case"warning":return"alert-triangle";default:return"info"}}formatTime(e){let t=new Date(e),i=new Date-t,n=document.documentElement.getAttribute("lang")||"en";if(i<6e4)return c.t("\xC0 l'instant");let a=new Intl.RelativeTimeFormat(n,{numeric:"auto"});return i<36e5?a.format(-Math.floor(i/6e4),"minute"):i<864e5?a.format(-Math.floor(i/36e5),"hour"):t.toLocaleDateString(n,{day:"numeric",month:"short"})}}});var ke,Me=S(()=>{M();P();ke=()=>{let l=document.getElementById("plexusForm"),e=document.getElementById("plexusInput"),t=document.getElementById("plexusSendBtn"),s=document.getElementById("plexusSearchWrapper"),i=document.getElementById("plexusLogoContainer"),n=document.getElementById("plexusSuggestions"),a=document.getElementById("plexusResultsArea"),o=document.getElementById("plexusCurrentQuery"),r=document.getElementById("plexusBackBtn"),d=document.getElementById("plexusThinking"),u=document.getElementById("plexusThinkingSteps"),h=document.getElementById("plexusAnswer"),f=document.getElementById("plexusSourcesList"),E=document.getElementById("plexusFollowup"),y=document.getElementById("plexusFollowupList"),b=!1,w=[];window.lucide&&window.lucide.createIcons(),g();async function g(){try{let v=await(await fetch("/api/plexus/health",{credentials:"same-origin"})).json();v.searxng!=="connected"&&console.warn("[Plexus] SearXNG not connected:",v)}catch(p){console.error("[Plexus] Health check failed:",p)}}function L(){d.classList.remove("hidden"),h.innerHTML="",h.classList.remove("typing");let p=document.getElementById("plexusDeepResearch"),v=p?p.checked:!1;u.innerHTML=`
            <div class="thinking-step active">
                <i data-lucide="${v?"microscope":"search"}"></i>
                <span>${v?c.t("Deep Research: Exploration approfondie..."):c.t("Recherche sur le web...")}</span>
            </div>
        `,window.lucide&&window.lucide.createIcons()}function I(p){let v={searching:{done:[`
                    <div class="thinking-step done">
                        <i data-lucide="check"></i>
                        <span>${c.t("Sources trouv\xE9es")}</span>
                    </div>
                `],active:`
                    <div class="thinking-step active">
                        <i data-lucide="brain"></i>
                        <span>${c.t("Analyse et synth\xE8se...")}</span>
                    </div>
                `},generating:{done:[`
                    <div class="thinking-step done">
                        <i data-lucide="check"></i>
                        <span>${c.t("Sources trouv\xE9es")}</span>
                    </div>`,`<div class="thinking-step done">
                        <i data-lucide="check"></i>
                        <span>${c.t("Analyse termin\xE9e")}</span>
                    </div>
                `],active:`
                    <div class="thinking-step active">
                        <i data-lucide="sparkles"></i>
                        <span>${c.t("R\xE9daction de la r\xE9ponse...")}</span>
                    </div>
                `}};v[p]&&(u.innerHTML=v[p].done.join("")+v[p].active,window.lucide&&window.lucide.createIcons())}function T(){d.classList.add("hidden")}function D(p){if(!p||p.length===0){f.innerHTML=`
                <div style="color: var(--text-muted); font-size: 13px; text-align: center; padding: 20px;">
                    ${c.t("Aucune source trouv\xE9e")}
                </div>
            `;return}f.innerHTML=p.map(v=>{let C=new URL(v.url).hostname,x=`https://www.google.com/s2/favicons?domain=${C}&sz=32`;return`
                <a href="${v.url}" target="_blank" rel="noopener noreferrer" class="plexus-source-card">
                    <div class="plexus-source-header">
                        <img src="${x}" alt="" class="source-favicon">
                        <div class="plexus-source-index">${v.index}</div>
                    </div>
                    <div class="plexus-source-info">
                        <div class="plexus-source-title">${W(v.title)}</div>
                        <div class="plexus-source-url">${C}</div>
                    </div>
                </a>
            `}).join("")}function $e(){f.innerHTML=`
            <div class="plexus-sources-loading">
                <div class="plexus-source-skeleton"></div>
                <div class="plexus-source-skeleton"></div>
                <div class="plexus-source-skeleton"></div>
                <div class="plexus-source-skeleton"></div>
            </div>
        `}function ce(p){T();let v="";window.marked?v=marked.parse(p):v=p.replace(/\n/g,"<br>"),w&&w.length>0&&(v=v.replace(/(\[\d+\])+/g,C=>{let x=C.match(/\d+/g);if(!x)return C;let U=parseInt(x[0])-1,B=w[U];if(B){let F=new URL(B.url).hostname,$=F.replace("www.","").split(".")[0],O=`https://www.google.com/s2/favicons?domain=${F}&sz=32`,N=x.length-1,ae=N>0?`<span class="citation-plus">+${N}</span>`:"";return`<span class="plexus-citation" data-indices="${x.map(oe=>parseInt(oe)-1).join(",")}">
                        <img src="${O}" alt="" class="citation-favicon">
                        <span class="citation-domain">${$}</span>
                        ${ae}
                    </span>`}return C})),h.innerHTML=v,h.querySelectorAll(".plexus-citation").forEach(C=>{C.addEventListener("click",()=>{let x=C.dataset.indices.split(","),U=parseInt(x[0]),B=f.querySelectorAll(".plexus-source-card");B[U]&&(B[U].scrollIntoView({behavior:"smooth",block:"center"}),x.forEach(F=>{let $=B[parseInt(F)];$&&($.classList.add("highlight"),setTimeout(()=>$.classList.remove("highlight"),3e3))}))})})}function Re(p){if(!p||p.length===0){E.classList.add("hidden");return}E.classList.remove("hidden"),y.innerHTML=p.map(v=>`
            <button class="plexus-followup-item" data-query="${W(v)}">
                <i data-lucide="corner-down-right"></i>
                <span>${W(v)}</span>
            </button>
        `).join(""),window.lucide&&window.lucide.createIcons(),y.querySelectorAll(".plexus-followup-item").forEach(v=>{v.addEventListener("click",()=>{let C=v.dataset.query;j(C)})})}function De(p){s.classList.add("hidden"),a.classList.remove("hidden"),o.textContent=p}function Ue(){a.classList.add("hidden"),s.classList.remove("hidden"),e.value="",e.focus()}async function j(p){if(!b&&(p=p.trim(),!!p)){b=!0,t.disabled=!0,De(p),L(),$e(),E.classList.add("hidden");try{let v=await m.get("ultra-plexus-source-count",3),C=await m.get("ultra-plexus-extra-info",""),x=document.getElementById("plexusDeepResearch"),U=x?x.checked:!1,B=await fetch("/api/plexus/search",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify({query:p,settings:{sourceCount:v,extraInfo:C,deepResearch:U}})});if(!B.ok)throw new Error(`Erreur serveur: ${B.status}`);let F=B.body.getReader(),$=new TextDecoder,O="",N="";for(;;){let{done:ae,value:oe}=await F.read();if(ae)break;let Fe=$.decode(oe,{stream:!0});N+=Fe;let de=N.split(`
`);N=de.pop();for(let ue of de)if(ue.trim())try{let A=JSON.parse(ue);if(A.type==="sources")w=A.data||[],I("searching"),D(w),await new Promise(V=>setTimeout(V,200)),I("generating");else if(A.type==="chunk")O+=A.content,ce(O);else if(A.type==="done"){T();let V=O.replace(/(?:\*\*|#)?\s*QUESTIONS_SUIVI\s*(?:\*\*|#)?\s*:?\s*([\s\S]+)$/i,"").trim();V&&ce(V),Re(A.followUpQuestions)}else if(A.type==="error")throw new Error(A.message)}catch(A){console.warn("Error parsing stream line:",A)}}b=!1,t.disabled=!1}catch(v){console.error("[Plexus] Search error:",v),T(),h.innerHTML=`
                <div style="color: var(--error); padding: 20px; text-align: center;">
                    <p><strong>${c.t("Erreur lors de la recherche")}</strong></p>
                    <p style="font-size: 13px; margin-top: 8px;">${W(v.message)}</p>
                </div>
            `}finally{b=!1,t.disabled=!1}}}function W(p){let v=document.createElement("div");return v.textContent=p,v.innerHTML}l.addEventListener("submit",p=>{p.preventDefault(),j(e.value)}),e.addEventListener("keydown",p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),j(e.value))}),e.addEventListener("input",function(){this.style.height="auto",this.style.height=Math.min(this.scrollHeight,120)+"px"}),r.addEventListener("click",Ue),n.querySelectorAll(".plexus-suggestion").forEach(p=>{p.addEventListener("click",()=>{let v=p.dataset.query;j(v)})})}});var z,Pe=S(()=>{P();z=class{static async check(){try{return(await(await fetch("/api/auth/status")).json()).authenticated?(this.hideOverlay(),!0):(this.showOverlay(),!1)}catch(e){return console.error("Auth check failed:",e),this.showOverlay(),!1}}static showOverlay(){let e=document.getElementById("authOverlay"),t=document.querySelector(".app");e&&e.classList.remove("hidden"),t&&(t.style.display="none"),window.lucide&&window.lucide.createIcons()}static hideOverlay(){let e=document.getElementById("authOverlay"),t=document.querySelector(".app");e&&e.classList.add("hidden"),t&&(t.style.display="flex")}static async init(){let e=document.getElementById("authForm");if(!e)return;let t=document.getElementById("setupNotice"),s=document.getElementById("authTitle"),i=document.getElementById("authSubtitle"),n=document.getElementById("authSubmit"),a=n.querySelector(".btn-text"),o=document.getElementById("authToggleBtn"),r=document.getElementById("authToggleText"),d=!1,u=!1;try{(await(await fetch("/api/auth/status")).json()).needsSetup&&(d=!0,t.classList.remove("hidden"),i.textContent=c.t("Configuration initiale"),a.textContent=c.t("Cr\xE9er le compte"),o&&(o.parentElement.style.display="none"))}catch{}o&&o.addEventListener("click",h=>{h.preventDefault(),u=!u,u?(i.textContent=c.t("Cr\xE9ation de compte"),a.textContent=c.t("S'inscrire"),r.textContent=c.t("D\xE9j\xE0 un compte ?"),o.textContent=c.t("Se connecter")):(i.textContent=c.t("Authentification requise"),a.textContent=c.t("Se connecter"),r.textContent=c.t("Pas de compte ?"),o.textContent=c.t("Cr\xE9er un compte"))}),e.addEventListener("submit",async h=>{h.preventDefault();let f=document.getElementById("authUsername").value,E=document.getElementById("authPassword").value,y=document.getElementById("authError");y.classList.add("hidden"),n.disabled=!0,a.textContent=c.t("Traitement...");try{let b="/api/auth/login";d?b="/api/auth/setup":u&&(b="/api/auth/register");let w=await fetch(b,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:f,password:E})}),g=await w.json();w.ok?window.location.reload():(y.textContent=g.error||c.t("Erreur de connexion"),y.classList.remove("hidden"),n.disabled=!1,d?a.textContent=c.t("Cr\xE9er le compte"):u?a.textContent=c.t("S'inscrire"):a.textContent=c.t("Se connecter"))}catch{y.textContent=c.t("Erreur serveur"),y.classList.remove("hidden"),n.disabled=!1,d?a.textContent=c.t("Cr\xE9er le compte"):u?a.textContent=c.t("S'inscrire"):a.textContent=c.t("Se connecter")}}),this.check()}static async logout(){try{await fetch("/api/auth/logout",{method:"POST"}),window.location.reload()}catch(e){console.error("Logout failed:",e)}}}});var Qe=qe(()=>{me();ge();fe();ve();ye();we();Ie();Le();Se();Te();Ce();xe();Be();Ae();Me();Pe();P();document.addEventListener("DOMContentLoaded",async()=>{await c.init(),await z.init(),new G,new ne,new _,new Z,new J,new Y,new K,new X,new ee,new te,new ie,new se,be(),Ee(),ke(),document.querySelectorAll(".nav-section-header").forEach(s=>{s.addEventListener("click",()=>{s.parentElement.classList.toggle("collapsed")})});let e=document.querySelector(".nav-item.active");if(e){let s=e.closest(".nav-section");s&&s.classList.remove("collapsed")}window.lucide&&window.lucide.createIcons();let t=document.getElementById("logoutBtn");t&&t.addEventListener("click",()=>z.logout()),console.log("\u{1F680} Ultra Dashboard Loaded (Modular)")})});export default Qe();
