var Fe=Object.defineProperty;var L=(c,e)=>()=>(c&&(e=c(c=0)),e);var qe=(c,e)=>()=>(e||c((e={exports:{}}).exports,e),e.exports),He=(c,e)=>{for(var t in e)Fe(c,t,{get:e[t],enumerable:!0})};var V,me=L(()=>{V=class{constructor(){this.navItems=document.querySelectorAll(".nav-item"),this.tabContents=document.querySelectorAll(".tab-content"),this.currentTab="convert",this.init()}init(){this.navItems.forEach(e=>{e.addEventListener("click",()=>{if(e.disabled)return;let t=e.dataset.tab;this.switchTab(t)})}),document.addEventListener("switch-tab",e=>{e.detail&&e.detail.tab&&this.switchTab(e.detail.tab)})}switchTab(e){document.querySelectorAll(".nav-item").forEach(s=>{let n=s.dataset.tab===e;if(s.classList.toggle("active",n),n){let i=s.closest(".nav-section");i&&i.classList.remove("collapsed")}}),this.tabContents.forEach(s=>{s.classList.toggle("active",s.id===`tab-${e}`)}),this.currentTab=e,console.log(`Tab switched to: ${e}`),document.dispatchEvent(new CustomEvent("tab-changed",{detail:{tabId:e}}))}}});var q,D,re,le,A,_=L(()=>{q=c=>{if(c===0)return"0 B";let e=1024,t=["B","KB","MB","GB","TB"],s=Math.floor(Math.log(c)/Math.log(e));return parseFloat((c/Math.pow(e,s)).toFixed(2))+" "+t[s]},D=c=>q(c)+"/s",re=c=>{if(!c||c<=0)return"0:00";let e=Math.floor(c/3600),t=Math.floor(c%3600/60),s=Math.floor(c%60);return e>0?`${e}:${t.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`:`${t}:${s.toString().padStart(2,"0")}`},le=c=>{if(c>=864e4)return"\u221E";if(c<=0)return"Termin\xE9";let t=Math.floor(c/3600),s=Math.floor(c%3600/60);return t>0?`${t}h ${s}m`:s>0?`${s}m`:`${c}s`},A=()=>{window.lucide&&window.lucide.createIcons()}});var O,he=L(()=>{O={en:{Accueil:"Home",MULTIM\u00C9DIA:"MULTIMEDIA",Convertisseur:"Converter",Downloader:"Downloader","INTELLIGENCE ARTIFICIELLE":"ARTIFICIAL INTELLIGENCE","Image AI":"Image AI","Speech-to-Text":"Speech-to-Text","AI Chat":"AI Chat",Plexus:"Plexus",UTILITAIRES:"UTILITIES",Torrents:"Torrents",LocalDrop:"LocalDrop",Toolbox:"Toolbox",Notifications:"Notifications",Databank:"Databank",R\u00E9glages:"Settings",D\u00E9connexion:"Logout",G\u00E9n\u00E9ral:"General",Navigation:"Navigation","Outils & IA":"Tools & AI",Serveurs:"Servers",S\u00E9curit\u00E9:"Security","Variables d'env":"Env Variables","\xC0 propos":"About","Personnalisez votre exp\xE9rience Ultra Dashboard":"Customize your Ultra Dashboard experience",Apparence:"Appearance","Th\xE8me Sombre":"Dark Theme","Basculez entre le mode sombre et le mode clair":"Switch between dark and light mode","Couleur d'accentuation":"Accent Color","Choisissez la couleur principale de l'interface":"Choose the primary interface color",Interface:"Interface","Animations r\xE9duites":"Reduced Motion","D\xE9sactive les animations pour plus de fluidit\xE9 sur les vieux PC":"Disables animations for better performance on old PCs","Barre lat\xE9rale r\xE9duite":"Compact Sidebar","Affiche uniquement les ic\xF4nes dans la barre lat\xE9rale":"Only show icons in the sidebar",Langue:"Language","Choisissez la langue de l'interface":"Choose the interface language",Syst\u00E8me:"System","Notification de fin":"Completion Notification","\xC9mettre un son quand une conversion est termin\xE9e":"Play a sound when a conversion is finished","Cache local":"Local Cache","Vider le cache des fichiers temporaires":"Clear temporary files cache","Vider le cache":"Clear Cache","Bienvenue sur Ultra Dashboard":"Welcome to Ultra Dashboard","Votre espace de productivit\xE9 personnel":"Your personal productivity space","Ajouter un widget":"Add widget","Widget Store":"Widget Store",Horloge:"Clock","Affiche l'heure et la date":"Display time and date",M\u00E9t\u00E9o:"Weather","Pr\xE9visions locales":"Local forecasts",Actions:"Actions","Raccourcis rapides":"Quick shortcuts",Syst\u00E8me:"System","Status du PC":"PC Status",Notes:"Notes","Bloc-notes rapide":"Quick notepad","Statut T\xE9l\xE9chargements":"Download Status","Progr\xE8s YouTube/Torrent":"YouTube/Torrent progress",Actualit\u00E9s:"News","France Info en direct":"France Info live","Nouvelle note":"New note","Sans titre":"Untitled","\xCAtes-vous s\xFBr de vouloir supprimer cette note ?":"Are you sure you want to delete this note?","Note supprim\xE9e":"Note deleted","Aucune note":"No notes","Cr\xE9ez votre premi\xE8re note":"Create your first note","Sauvegarde...":"Saving...",Sauvegard\u00E9:"Saved","Sauvegard\xE9 \xE0":"Saved at",Hier:"Yesterday","Il y a":"Ago",mot:"word",mots:"words",caract\u00E8re:"character",caract\u00E8res:"characters","Note synchronis\xE9e avec la Databank":"Note synchronized with Databank","Erreur lors de l'export":"Error during export","Notes synchronis\xE9es avec la Databank (suppressions d\xE9tect\xE9es)":"Notes synchronized with Databank (deletions detected)","Note supprim\xE9e car l'\xE9l\xE9ment Databank correspondant a \xE9t\xE9 effac\xE9.":"Note deleted because the corresponding Databank item was erased.","Impossible de supprimer la note de la Databank:":"Unable to delete note from Databank:","texte en gras":"bold text","texte en italique":"italic text","texte barr\xE9":"strikethrough text",Titre:"Title",Citation:"Quote",code:"code","\xC9l\xE9ment de liste":"List item",T\u00E2che:"Task","texte du lien":"link text",description:"description",Colonnes:"Columns","Veuillez \xE9crire ou s\xE9lectionner du texte d'abord":"Please write or select text first","Tu es un assistant d'\xE9criture expert. R\xE9ponds uniquement avec le contenu demand\xE9, sans bavardage.":"You are an expert writing assistant. Answer only with the requested content, without chatter.","Fais un r\xE9sum\xE9 concis du texte suivant :":"Make a concise summary of the following text:","Corrige les fautes d'orthographe et de grammaire du texte suivant. Conserve le formatage Markdown. Renvoie uniquement le texte corrig\xE9 :":"Correct spelling and grammar mistakes in the following text. Keep Markdown formatting. Return only the corrected text:","Continue la r\xE9daction du texte suivant de mani\xE8re coh\xE9rente et cr\xE9ative :":"Continue writing the following text in a coherent and creative way:","Donne-moi 5 id\xE9es ou points cl\xE9s pertinents bas\xE9s sur le texte suivant :":"Give me 5 relevant ideas or key points based on the following text:","Erreur lors de la communication avec l'IA":"Error communicating with AI","Erreur lors de la g\xE9n\xE9ration IA":"Error during AI generation","Contenu ins\xE9r\xE9 avec succ\xE8s":"Content inserted successfully","Ultra Dashboard - Productivit\xE9":"Ultra Dashboard - Productivity","Dashboard de productivit\xE9 tout-en-un : conversion de fichiers, t\xE9l\xE9chargement YouTube, suppression d'arri\xE8re-plan, transcription audio.":"All-in-one productivity dashboard: file conversion, YouTube download, background removal, audio transcription.","Recherche intelligente avec sources v\xE9rifi\xE9es en temps r\xE9el":"Intelligent search with real-time verified sources","Explorez le web avec l'intelligence artificielle":"Explore the web with artificial intelligence","Deep Research":"Deep Research","Posez votre question...":"Ask your question...","Actualit\xE9s tech":"Tech news","Quelles sont les derni\xE8res actualit\xE9s tech ?":"What are the latest tech news?","Explique-moi la cryptographie quantique":"Explain quantum cryptography to me","Science & Tech":"Science & Tech","R\xE9sume les derni\xE8res d\xE9couvertes en IA":"Summarize the latest discoveries in AI","Intelligence Artificielle":"Artificial Intelligence","Quel est le cours du Bitcoin aujourd'hui ?":"What is the price of Bitcoin today?","Finance & Crypto":"Finance & Crypto","Analyse en cours":"Analysis in progress","Recherche sur le web...":"Searching the web...","Questions li\xE9es":"Related questions",Sources:"Sources","Convertisseur de fichiers":"File Converter","Convertissez vos images, audio et vid\xE9os en un clic":"Convert your images, audio and videos in one click","Glissez votre fichier ici":"Drop your file here","ou cliquez pour s\xE9lectionner":"or click to select",Retirer:"Remove","Convertir en :":"Convert to:","Compresser le fichier":"Compress file","R\xE9duit la taille du fichier (qualit\xE9 optimis\xE9e)":"Reduces file size (optimized quality)",Convertir:"Convert",Sauvegarder:"Save","Conversion en cours...":"Conversion in progress...",Mod\u00E8le:"Model",Type:"Type",Taille:"Size",Date:"Date",Service:"Service",Status:"Status",Inconnu:"Unknown",Uptime:"Uptime","M\xE9moire (RSS)":"Memory (RSS)",Platform:"Platform","Node JS":"Node JS",Compte:"Account",Intelligence:"Intelligence",Maintenance:"Maintenance","Style & Th\xE8me":"Style & Theme","Navigation lat\xE9rale":"Sidebar Navigation","Utiliser les regroupements":"Use groupings","Affiche les \xE9l\xE9ments par cat\xE9gories (sections) ou tout en vrac.":"Displays items by categories (sections) or all mixed.","\xC9pingler sous Accueil":"Pin under Home","Databank (Fichiers)":"Databank (Files)","Fournisseur d'IA Principal":"Main AI Provider","Source de l'IA":"AI Source","Choisissez entre OpenRouter (Cloud) ou Ollama (Local)":"Choose between OpenRouter (Cloud) or Ollama (Local)","API Key":"API Key","Mod\xE8le par d\xE9faut":"Default Model","URL du serveur":"Server URL","Nom du mod\xE8le":"Model Name","Configuration Plexus & Recherche":"Plexus & Search Configuration","URL SearXNG":"SearXNG URL","Nombre de sources":"Number of sources","Nombre maximum de sources \xE0 utiliser pour les recherches":"Maximum number of sources to use for searches","Instructions personnalis\xE9es (System Prompt)":"Custom Instructions (System Prompt)","Context ou instructions sp\xE9cifiques pour l'IA":"Context or specific instructions for AI","Outils d'Image":"Image Tools","Mod\xE8le de d\xE9tourage":"Background Removal Model","Transcription (STT)":"Transcription (STT)","Taille du mod\xE8le Whisper":"Whisper Modele Size","Plus le mod\xE8le est grand, plus il est pr\xE9cis mais lent":"The larger the model, the more accurate but slower it is","\xC9tat des Services AI":"AI Services Status","Chargement des serveurs...":"Loading servers...","M\xE9triques Syst\xE8me":"System Metrics","Mod\xE8les IA T\xE9l\xE9charg\xE9s":"Downloaded AI Models","Recherche des mod\xE8les...":"Searching models...","Logs d'activit\xE9 serveur":"Server Activity Logs","Chargement des logs...":"Loading logs...","S\xE9curit\xE9 du Compte":"Account Security","Nom d'utilisateur":"Username","Votre nom d'utilisateur":"Your username","Mot de passe actuel":"Current password","Nouveau mot de passe":"New password","Mettre \xE0 jour le mot de passe":"Update password",Documentation:"Documentation",Support:"Support",GitHub:"GitHub","Un outil tout-en-un con\xE7u pour la performance et le style.":"An all-in-one tool designed for performance and style.","Historique et stockage centralis\xE9 de toutes vos g\xE9n\xE9rations":"History and centralized storage of all your generations","Rechercher...":"Search...","Tous les types":"All types",Images:"Images",Audio:"Audio",Texte:"Text",Vid\u00E9o:"Video","Nouveau dossier":"New Folder","Tout effacer":"Clear All",Racine:"Root","Chargement des donn\xE9es...":"Loading data...",Pr\u00E9c\u00E9dent:"Previous",Suivant:"Next",Page:"Page",Aper\u00E7u:"Preview",T\u00E9l\u00E9charger:"Download","Nom du dossier":"Folder Name","Nommez votre dossier...":"Name your folder...","D\xE9placer vers":"Move to","Bloc-Notes":"Notepad","Cr\xE9ez et organisez vos notes avec un \xE9diteur Markdown complet":"Create and organize your notes with a complete Markdown editor","Bienvenue dans votre bloc-notes":"Welcome to your notepad","Cr\xE9ez une nouvelle note ou s\xE9lectionnez-en une dans la liste":"Create a new note or select one from the list","Cr\xE9er une note":"Create a note","Titre de la note...":"Note title...","Aper\xE7u Markdown":"Markdown Preview","Exporter vers Databank":"Export to Databank",Supprimer:"Delete","Gras (Ctrl+B)":"Bold (Ctrl+B)","Italique (Ctrl+I)":"Italic (Ctrl+I)",Barr\u00E9:"Strikethrough","Liste \xE0 puces":"Bulleted list","Liste num\xE9rot\xE9e":"Numbered list","Case \xE0 cocher":"Checkbox",Lien:"Link",Image:"Image",Tableau:"Table","Assistant IA":"AI Assistant","Tags (s\xE9par\xE9s par des virgules)":"Tags (comma separated)","\xC9crivez votre note en Markdown...":"Write your note in Markdown...","Non sauvegard\xE9":"Not saved","L'IA r\xE9fl\xE9chit...":"AI is thinking...",R\u00E9essayer:"Retry",Ins\u00E9rer:"Insert",R\u00E9sumer:"Summarize","G\xE9n\xE9rer un r\xE9sum\xE9 concis de la note":"Generate a concise summary of the note",Corriger:"Fix","Correction orthographe et grammaire":"Spelling and grammar correction",Continuer:"Continue","Compl\xE9ter la r\xE9daction du texte":"Complete text writing",Id\u00E9es:"Ideas","G\xE9n\xE9rer des id\xE9es li\xE9es au contenu":"Generate content-related ideas","Conversion r\xE9ussie !":"Conversion successful!","Media Downloader":"Media Downloader","T\xE9l\xE9chargez des vid\xE9os et musiques de YouTube, TikTok, Instagram, Twitter et plus":"Download videos and music from YouTube, TikTok, Instagram, Twitter and more","Collez le lien (YouTube, TikTok, Instagram...) ici...":"Paste link (YouTube, TikTok, Instagram...) here...","Multi-Plateforme":"Multi-Platform","Supporte plus de 1000 sites web.":"Supports over 1000 websites.","Audio HQ":"HQ Audio","Extraction MP3 haute fid\xE9lit\xE9 (320kbps).":"High fidelity MP3 extraction (320kbps).","Trim & Crop":"Trim & Crop","D\xE9coupez vos s\xE9quences facilement.":"Trim your footage easily.","T\xE9l\xE9chargements R\xE9cents":"Recent Downloads",Effacer:"Clear","Aucun t\xE9l\xE9chargement r\xE9cent":"No recent downloads","Titre du m\xE9dia":"Media Title",Plateforme:"Platform",Mode:"Mode",Vid\u00E9o:"Video",Audio:"Audio",Qualit\u00E9:"Quality","Auto (Max)":"Auto (Max)",Format:"Format","Options avanc\xE9es":"Advanced Options",M\u00E9tadonn\u00E9es:"Metadata",Miniature:"Thumbnail","Sous-titres":"Subtitles",D\u00E9coupage:"Trimming","(Optionnel)":"(Optional)",T\u00E9l\u00E9charger:"Download","Initialisation...":"Initializing...","D\xE9marrage...":"Starting...","Pr\xEAt !":"Ready!","T\xE9l\xE9chargement...":"Downloading...","T\xE9l\xE9chargement termin\xE9":"Download complete","Le m\xE9dia":"The media","est pr\xEAt.":"is ready.","Enregistr\xE9 dans la Databank !":"Saved to Databank!","Erreur inconnue":"Unknown error","Image AI Tools":"Image AI Tools","Supprimez l'arri\xE8re-plan ou agrandissez vos images avec l'IA":"Remove background or upscale your images with AI","Remove Background":"Remove Background","Upscale Image":"Upscale Image","Serveur REMBG non connect\xE9":"REMBG Server not connected","Le serveur Python doit \xEAtre d\xE9marr\xE9 pour utiliser cette fonctionnalit\xE9.":"Python server must be started to use this feature.",R\u00E9essayer:"Retry","Serveur Upscale non connect\xE9":"Upscale Server not connected","Mod\xE8le IA":"AI Model","Choisissez le mod\xE8le optimal pour vos images":"Choose the optimal model for your images","Mod\xE8le d'IA":"AI Model","Facteur d'agrandissement":"Upscale Factor",D\u00E9bruitage:"Denoising","Glissez vos images ici":"Drop your images here","Traiter les images":"Process Images","Traitement en cours...":"Processing...","V\xE9rification...":"Checking...","Transcrivez vos fichiers audio et vid\xE9o en texte avec Whisper IA":"Transcribe your audio and video files to text with Whisper AI","Serveur Whisper non connect\xE9":"Whisper Server not connected","Mod\xE8le AI Whisper":"Whisper AI Model","Lancer la transcription":"Start Transcription","Transcription en cours...":"Transcription in progress...","R\xE9sultat de la transcription":"Transcription Result","Copier le texte":"Copy text","T\xE9l\xE9charger .txt":"Download .txt","Nouveau fichier":"New File","AI Chat / PDF Expert":"AI Chat / PDF Expert","Discutez avec l'IA ou posez des questions sur vos documents":"Chat with AI or ask questions about your documents","Document Context":"Document Context","Ajouter un PDF":"Add PDF","Retirer le document":"Remove document","Effacer l'historique":"Clear History","Bonjour ! Je suis Ultra AI. Comment puis-je vous aider aujourd'hui ?":"Hello! I am Ultra AI. How can I help you today?","Vous pouvez m'envoyer un PDF via la barre lat\xE9rale pour que j'y r\xE9ponde pr\xE9cis\xE9ment.":"You can send me a PDF via the sidebar so I can answer precisely.","Posez votre question ici...":"Ask your question here...","Posez votre question":"Ask your question","Torrent Manager":"Torrent Manager","G\xE9rez vos t\xE9l\xE9chargements qBittorrent":"Manage your qBittorrent downloads","Connexion qBittorrent":"qBittorrent Connection","Veuillez vous connecter \xE0 votre interface WebUI":"Please log in to your WebUI interface","Nom d'utilisateur":"Username","Mot de passe":"Password","Se connecter":"Login",Ajouter:"Add","Tout pauser":"Pause All","Tout reprendre":"Resume All","Vitesse de t\xE9l\xE9chargement":"Download Speed","Vitesse d'envoi":"Upload Speed",\u00C9tat:"State",Nom:"Name",Taille:"Size",Progression:"Progress",Vitesse:"Speed","Ajouter un Torrent":"Add Torrent","Coller du presse-papier":"Paste from clipboard","Collez vos liens Magnet ou Hash ici...":"Paste your Magnet links or Hash here...","Partagez des fichiers en P2P avec les appareils sur votre r\xE9seau":"Share P2P files with devices on your network","Mon appareil":"My Device","Scanner pour partager":"Scan to share","Copier l'URL":"Copy URL","Recherche d'autres appareils sur le r\xE9seau...":"Searching for other devices on the network...","Ouvrez Ultra Dashboard sur un autre appareil pour le voir ici.":"Open Ultra Dashboard on another device to see it here.","Transfert en cours":"Transfer in progress","Envoi vers...":"Sending to...","Mega Toolbox":"Mega Toolbox","Une collection d'outils essentiels regroup\xE9s dans une interface \xE9pur\xE9e":"A collection of essential tools grouped in a clean interface","G\xE9n\xE9rateur QR Code":"QR Code Generator","Lien ou texte...":"Link or text...","Votre QR code appara\xEEtra ici":"Your QR code will appear here","T\xE9l\xE9charger l'image":"Download image","G\xE9n\xE9rer le mot de passe":"Generate Password",Longueur:"Length","Outils Texte":"Text Tools","Collez votre texte ici...":"Paste your text here...",Nettoyer:"Clean","0 caract\xE8res":"0 characters","0 mots":"0 words","Devises (Live)":"Currencies (Live)","Taux de change en direct":"Live exchange rates","Miroir Webcam":"Webcam Mirror","Cam\xE9ra d\xE9sactiv\xE9e":"Camera disabled",Activer:"Enable",Capturer:"Capture","S\xE9lectionner une cam\xE9ra...":"Select a camera...","Historique et stockage centralis\xE9 de toutes vos g\xE9n\xE9rations":"History and centralized storage of all your generations","Rechercher...":"Search...","Tous les types":"All types",Images:"Images",Texte:"Text",Actualiser:"Refresh","Tout effacer":"Clear All","Chargement des donn\xE9es...":"Loading data...",Pr\u00E9c\u00E9dent:"Previous","Page 1":"Page 1",Suivant:"Next",Aper\u00E7u:"Preview","Centre de Notifications":"Notification Center","Historique de vos activit\xE9s et t\xE2ches termin\xE9es":"History of your activities and completed tasks","Effacer tout":"Clear All","Aucune notification":"No notifications","Vos nouvelles notifications appara\xEEtront ici.":"Your new notifications will appear here.","\xC0 l'instant":"Just now","Configuration initiale":"Initial Setup","Configuration initiale : cr\xE9ez votre compte.":"Initial setup: create your account.","Votre pseudonyme":"Your username","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022":"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022","Cr\xE9er le compte":"Create Account","Cr\xE9ation de compte":"Account Creation","S'inscrire":"Sign Up","D\xE9j\xE0 un compte ?":"Already have an account?","Se connecter":"Login","Authentification requise":"Authentication Required","Pas de compte ?":"No account?","Cr\xE9er un compte":"Create an account","Traitement...":"Processing...","Erreur de connexion":"Connection Error","Erreur serveur":"Server Error","\xC9l\xE9ments de la barre lat\xE9rale":"Sidebar Items","Choisissez les outils \xE0 afficher dans la barre lat\xE9rale":"Choose which tools to display in the sidebar","Utiliser les regroupements":"Use grouping","Affiche les \xE9l\xE9ments par cat\xE9gories (sections) ou tout en vrac.":"Display items by categories (sections) or all together.","\xC9pingler sous Accueil":"Pin under Home","Databank (Fichiers)":"Databank (Files)","Configuration Plexus AI":"Plexus AI Configuration","Nombre de sources":"Number of sources","Nombre maximum de sources \xE0 utiliser pour les recherches":"Maximum number of sources to use for searches","Informations compl\xE9mentaires":"Additional information","Context ou instructions sp\xE9cifiques pour l'IA":"Context or specific instructions for AI","Ex: Toujours r\xE9pondre en fran\xE7ais, \xEAtre concis...":"Ex: Always answer in English, be concise...","Configuration Remove BG":"Remove BG Configuration","Mod\xE8le par d\xE9faut":"Default model","Choisissez le mod\xE8le de d\xE9tourage utilis\xE9 par d\xE9faut":"Choose the default background removal model","Configuration AI Upscaler":"AI Upscaler Configuration","Mod\xE8le pr\xE9f\xE9r\xE9":"Preferred model","Mod\xE8le utilis\xE9 par d\xE9faut pour l'agrandissement":"Default model used for upscaling","Facteur par d\xE9faut":"Default factor","Facteur d'agrandissement initial":"Initial upscale factor","Speech-to-Text (STT)":"Speech-to-Text (STT)","Mod\xE8le Whisper":"Whisper Model","Taille du mod\xE8le pour la transcription (tiny \xE0 large)":"Model size for transcription (tiny to large)","\xC9tat des Services AI":"AI Services Status","Chargement des serveurs...":"Loading servers...","M\xE9triques Syst\xE8me":"System Metrics",Maintenance:"Maintenance","Logs Serveur":"Server Logs","Voir les journaux d'activit\xE9 en temps r\xE9el":"View real-time activity logs","Mod\xE8les IA T\xE9l\xE9charg\xE9s":"Downloaded AI Models","Recherche des mod\xE8les...":"Searching for models...","Changement de mot de passe":"Password Change","Confirmez votre nom d'utilisateur":"Confirm your username","Votre nom d'utilisateur":"Your username","Mot de passe actuel":"Current password","Saisissez votre mot de passe actuel pour v\xE9rification":"Enter your current password for verification","Nouveau mot de passe":"New password","Choisissez un nouveau mot de passe fort":"Choose a strong new password","Mettre \xE0 jour le mot de passe":"Update password","Configuration des API & Services":"API & Services Configuration","Ces r\xE9glages surchargent les valeurs par d\xE9faut du fichier .env pour votre compte.":"These settings override the default .env file values for your account.","OpenRouter API Key":"OpenRouter API Key","Cl\xE9 API utilis\xE9e pour AI Chat et Plexus":"API key used for AI Chat and Plexus","Mod\xE8le OpenRouter":"OpenRouter Model","Mod\xE8le par d\xE9faut (ex: google/gemini-2.0-pro-exp-02-05:free)":"Default model (ex: google/gemini-2.0-pro-exp-02-05:free)","URL SearXNG":"SearXNG URL","URL de votre instance SearXNG (utilis\xE9e par Plexus)":"URL of your SearXNG instance (used by Plexus)","URL REMBG":"REMBG URL","URL du service Python RemoveBG":"Python RemoveBG service URL","URL Whisper":"Whisper URL","URL du service Python Speech-to-Text":"Python Speech-to-Text service URL","URL Upscale":"Upscale URL","URL du service Python AI Upscaler":"Python AI Upscaler service URL","Fournisseur d'IA":"AI Provider","Choisissez entre OpenRouter (Cloud) ou Ollama (Local)":"Choose between OpenRouter (Cloud) or Ollama (Local)","URL Ollama":"Ollama URL","URL de votre instance locale Ollama":"URL of your local Ollama instance","Mod\xE8le Ollama":"Ollama Model","Nom du mod\xE8le Local (ex: llama3, mistral, deepseek-r1)":"Name of the local model (ex: llama3, mistral, deepseek-r1)","Enregistrer les variables d'environnement":"Save environment variables","Un outil tout-en-un con\xE7u pour la performance et le style.":"An all-in-one tool designed for performance and style.",Documentation:"Documentation",Support:"Support",GitHub:"GitHub","Logs d'activit\xE9 serveur":"Server Activity Logs","Mise \xE0 jour...":"Updating...","Tous les champs sont requis":"All fields are required","Erreur lors de la mise \xE0 jour":"Error during update","Erreur de connexion au serveur":"Server connection error","Aucun mod\xE8le t\xE9l\xE9charg\xE9 trouv\xE9.":"No downloaded models found.","Metrics non disponibles":"Metrics not available","Aucun log disponible.":"No logs available.","Voulez-vous vraiment effacer les logs du serveur ?":"Are you sure you want to clear server logs?","Voulez-vous vraiment vider le cache local ? Cela r\xE9initialisera \xE9galement vos r\xE9glages.":"Are you sure you want to clear local cache? This will also reset your settings.","Chargement...":"Loading...",Enregistrer:"Save",Annuler:"Cancel",Succ\u00E8s:"Success",Erreur:"Error"},fr:{Accueil:"Accueil",MULTIM\u00C9DIA:"MULTIM\xC9DIA",Convertisseur:"Convertisseur",Downloader:"Downloader","INTELLIGENCE ARTIFICIELLE":"INTELLIGENCE ARTIFICIELLE","Image AI":"Image AI","Speech-to-Text":"Speech-to-Text","AI Chat":"AI Chat",Plexus:"Plexus",UTILITAIRES:"UTILITAIRES",Torrents:"Torrents",LocalDrop:"LocalDrop",Toolbox:"Toolbox",Notifications:"Notifications",Databank:"Databank",R\u00E9glages:"R\xE9glages",D\u00E9connexion:"D\xE9connexion",G\u00E9n\u00E9ral:"G\xE9n\xE9ral",Navigation:"Navigation","Outils & IA":"Outils & IA",Serveurs:"Serveurs",S\u00E9curit\u00E9:"S\xE9curit\xE9","Variables d'env":"Variables d'env","\xC0 propos":"\xC0 propos","Personnalisez votre exp\xE9rience Ultra Dashboard":"Personnalisez votre exp\xE9rience Ultra Dashboard",Apparence:"Apparence","Th\xE8me Sombre":"Th\xE8me Sombre","Basculez entre le mode sombre et le mode clair":"Basculez entre le mode sombre et le mode clair","Couleur d'accentuation":"Couleur d'accentuation","Choisissez la couleur principale de l'interface":"Choisissez la couleur principale de l'interface",Interface:"Interface","Animations r\xE9duites":"Animations r\xE9duites","D\xE9sactive les animations pour plus de fluidit\xE9 sur les vieux PC":"D\xE9sactive les animations pour plus de fluidit\xE9 sur les vieux PC","Barre lat\xE9rale r\xE9duite":"Barre lat\xE9rale r\xE9duite","Affiche uniquement les ic\xF4nes dans la barre lat\xE9rale":"Affiche uniquement les ic\xF4nes dans la barre lat\xE9rale",Langue:"Langue","Choisissez la langue de l'interface":"Choisissez la langue de l'interface",Syst\u00E8me:"Syst\xE8me","Notification de fin":"Notification de fin","\xC9mettre un son quand une conversion est termin\xE9e":"\xC9mettre un son quand une conversion est termin\xE9e","Cache local":"Cache local","Vider le cache des fichiers temporaires":"Vider le cache des fichiers temporaires","Vider le cache":"Vider le cache","Bienvenue sur Ultra Dashboard":"Bienvenue sur Ultra Dashboard","Votre espace de productivit\xE9 personnel":"Votre espace de productivit\xE9 personnel","Ajouter un widget":"Ajouter un widget","Widget Store":"Widget Store",Horloge:"Horloge","Affiche l'heure et la date":"Affiche l'heure et la date",M\u00E9t\u00E9o:"M\xE9t\xE9o","Pr\xE9visions locales":"Pr\xE9visions locales",Actions:"Actions","Raccourcis rapides":"Raccourcis rapides",Syst\u00E8me:"Syst\xE8me","Status du PC":"Status du PC",Notes:"Notes","Bloc-notes rapide":"Bloc-notes rapide","Statut T\xE9l\xE9chargements":"Statut T\xE9l\xE9chargements","Progr\xE8s YouTube/Torrent":"Progr\xE8s YouTube/Torrent",Actualit\u00E9s:"Actualit\xE9s","France Info en direct":"France Info en direct","Nouvelle note":"Nouvelle note","Sans titre":"Sans titre","\xCAtes-vous s\xFBr de vouloir supprimer cette note ?":"\xCAtes-vous s\xFBr de vouloir supprimer cette note ?","Note supprim\xE9e":"Note supprim\xE9e","Aucune note":"Aucune note","Cr\xE9ez votre premi\xE8re note":"Cr\xE9ez votre premi\xE8re note","Sauvegarde...":"Sauvegarde...",Sauvegard\u00E9:"Sauvegard\xE9","Sauvegard\xE9 \xE0":"Sauvegard\xE9 \xE0",Hier:"Hier","Il y a":"Il y a",mot:"mot",mots:"mots",caract\u00E8re:"caract\xE8re",caract\u00E8res:"caract\xE8res","Note synchronis\xE9e avec la Databank":"Note synchronis\xE9e avec la Databank","Erreur lors de l'export":"Erreur lors de l'export","Notes synchronis\xE9es avec la Databank (suppressions d\xE9tect\xE9es)":"Notes synchronis\xE9es avec la Databank (suppressions d\xE9tect\xE9es)","Note supprim\xE9e car l'\xE9l\xE9ment Databank correspondant a \xE9t\xE9 effac\xE9.":"Note supprim\xE9e car l'\xE9l\xE9ment Databank correspondant a \xE9t\xE9 effac\xE9.","Impossible de supprimer la note de la Databank:":"Impossible de supprimer la note de la Databank:","texte en gras":"texte en gras","texte en italique":"texte en italique","texte barr\xE9":"texte barr\xE9",Titre:"Titre",Citation:"Citation",code:"code","\xC9l\xE9ment de liste":"\xC9l\xE9ment de liste",T\u00E2che:"T\xE2che","texte du lien":"texte du lien",description:"description",Colonnes:"Colonnes","Veuillez \xE9crire ou s\xE9lectionner du texte d'abord":"Veuillez \xE9crire ou s\xE9lectionner du texte d'abord","Tu es un assistant d'\xE9criture expert. R\xE9ponds uniquement avec le contenu demand\xE9, sans bavardage.":"Tu es un assistant d'\xE9criture expert. R\xE9ponds uniquement avec le contenu demand\xE9, sans bavardage.","Fais un r\xE9sum\xE9 concis du texte suivant :":"Fais un r\xE9sum\xE9 concis du texte suivant :","Corrige les fautes d'orthographe et de grammaire du texte suivant. Conserve le formatage Markdown. Renvoie uniquement le texte corrig\xE9 :":"Corrige les fautes d'orthographe et de grammaire du texte suivant. Conserve le formatage Markdown. Renvoie uniquement le texte corrig\xE9 :","Continue la r\xE9daction du texte suivant de mani\xE8re coh\xE9rente et cr\xE9ative :":"Continue la r\xE9daction du texte suivant de mani\xE8re coh\xE9rente et cr\xE9ative :","Donne-moi 5 id\xE9es ou points cl\xE9s pertinents bas\xE9s sur le texte suivant :":"Donne-moi 5 id\xE9es ou points cl\xE9s pertinents bas\xE9s sur le texte suivant :","Erreur lors de la communication avec l'IA":"Erreur lors de la communication avec l'IA","Erreur lors de la g\xE9n\xE9ration IA":"Erreur lors de la g\xE9n\xE9ration IA","Contenu ins\xE9r\xE9 avec succ\xE8s":"Contenu ins\xE9r\xE9 avec succ\xE8s","Recherche intelligente avec sources v\xE9rifi\xE9es en temps r\xE9el":"Recherche intelligente avec sources v\xE9rifi\xE9es en temps r\xE9el","Explorez le web avec l'intelligence artificielle":"Explorez le web avec l'intelligence artificielle","Deep Research":"Deep Research","Posez votre question...":"Posez votre question...","Actualit\xE9s tech":"Actualit\xE9s tech","Quelles sont les derni\xE8res actualit\xE9s tech ?":"Quelles sont les derni\xE8res actualit\xE9s tech ?","Explique-moi la cryptographie quantique":"Explique-moi la cryptographie quantique","Science & Tech":"Science & Tech","R\xE9sume les derni\xE8res d\xE9couvertes en IA":"R\xE9sume les derni\xE8res d\xE9couvertes en IA","Intelligence Artificielle":"Intelligence Artificielle","Quel est le cours du Bitcoin aujourd'hui ?":"Quel est le cours du Bitcoin aujourd'hui ?","Finance & Crypto":"Finance & Crypto","Analyse en cours":"Analyse en cours","Recherche sur le web...":"Recherche sur le web...","Questions li\xE9es":"Questions li\xE9es",Sources:"Sources","Convertisseur de fichiers":"Convertisseur de fichiers","Convertissez vos images, audio et vid\xE9os en un clic":"Convertissez vos images, audio et vid\xE9os en un clic","Glissez votre fichier ici":"Glissez votre fichier ici","ou cliquez pour s\xE9lectionner":"ou cliquez pour s\xE9lectionner",Retirer:"Retirer","Convertir en :":"Convertir en :","Compresser le fichier":"Compresser le fichier","R\xE9duit la taille du fichier (qualit\xE9 optimis\xE9e)":"R\xE9duit la taille du fichier (qualit\xE9 optimis\xE9e)",Convertir:"Convertir",Sauvegarder:"Sauvegarder","Conversion en cours...":"Conversion en cours...","Conversion r\xE9ussie !":"Conversion r\xE9ussie !",Mod\u00E8le:"Mod\xE8le",Type:"Type",Taille:"Taille",Date:"Date",Service:"Service",Status:"Statut",Inconnu:"Inconnu",Uptime:"Uptime","M\xE9moire (RSS)":"M\xE9moire (RSS)",Platform:"Plateforme","Node JS":"Node JS","Style & Th\xE8me":"Style & Th\xE8me","Navigation lat\xE9rale":"Navigation lat\xE9rale","Utiliser les regroupements":"Utiliser les regroupements","Affiche les \xE9l\xE9ments par cat\xE9gories (sections) ou tout en vrac.":"Affiche les \xE9l\xE9ments par cat\xE9gories (sections) ou tout en vrac.","\xC9pingler sous Accueil":"\xC9pingler sous Accueil","Databank (Fichiers)":"Databank (Fichiers)","Fournisseur d'IA Principal":"Fournisseur d'IA Principal","Source de l'IA":"Source de l'IA","Choisissez entre OpenRouter (Cloud) ou Ollama (Local)":"Choisissez entre OpenRouter (Cloud) ou Ollama (Local)","API Key":"API Key","Mod\xE8le par d\xE9faut":"Mod\xE8le par d\xE9faut","URL du serveur":"URL du serveur","Nom du mod\xE8le":"Nom du mod\xE8le","Configuration Plexus & Recherche":"Configuration Plexus & Recherche","URL SearXNG":"URL SearXNG","Nombre de sources":"Nombre de sources","Nombre maximum de sources \xE0 utiliser pour les recherches":"Nombre maximum de sources \xE0 utiliser pour les recherches","Instructions personnalis\xE9es (System Prompt)":"Instructions personnalis\xE9es (System Prompt)","Context ou instructions sp\xE9cifiques pour l'IA":"Context ou instructions sp\xE9cifiques pour l'IA","Outils d'Image":"Outils d'Image","Mod\xE8le de d\xE9tourage":"Mod\xE8le de d\xE9tourage","Transcription (STT)":"Transcription (STT)","Taille du mod\xE8le Whisper":"Taille du mod\xE8le Whisper","Plus le mod\xE8le est grand, plus il est pr\xE9cis mais lent":"Plus le mod\xE8le est grand, plus il est pr\xE9cis mais lent","\xC9tat des Services AI":"\xC9tat des Services AI","Chargement des serveurs...":"Chargement des serveurs...","M\xE9triques Syst\xE8me":"M\xE9triques Syst\xE8me","Mod\xE8les IA T\xE9l\xE9charg\xE9s":"Mod\xE8les IA T\xE9l\xE9charg\xE9s","Recherche des mod\xE8les...":"Recherche des mod\xE8les...","Logs d'activit\xE9 serveur":"Logs d'activit\xE9 serveur","Chargement des logs...":"Chargement des logs...","S\xE9curit\xE9 du Compte":"S\xE9curit\xE9 du Compte","Nom d'utilisateur":"Nom d'utilisateur","Votre nom d'utilisateur":"Votre nom d'utilisateur","Mot de passe actuel":"Mot de passe actuel","Nouveau mot de passe":"Nouveau mot de passe","Mettre \xE0 jour le mot de passe":"Mettre \xE0 jour le mot de passe",Documentation:"Documentation",Support:"Support",GitHub:"GitHub","Un outil tout-en-un con\xE7u pour la performance et le style.":"Un outil tout-en-un con\xE7u pour la performance et le style.","Historique et stockage centralis\xE9 de toutes vos g\xE9n\xE9rations":"Historique et stockage centralis\xE9 de toutes vos g\xE9n\xE9rations","Rechercher...":"Rechercher...","Tous les types":"Tous les types",Images:"Images",Audio:"Audio",Texte:"Texte",Vid\u00E9o:"Vid\xE9o","Nouveau dossier":"Nouveau dossier","Tout effacer":"Tout effacer",Racine:"Racine","Chargement des donn\xE9es...":"Chargement des donn\xE9es...",Pr\u00E9c\u00E9dent:"Pr\xE9c\xE9dent",Suivant:"Suivant",Page:"Page",Aper\u00E7u:"Aper\xE7u",T\u00E9l\u00E9charger:"T\xE9l\xE9charger","Nom du dossier":"Nom du dossier","Nommez votre dossier...":"Nommez votre dossier...","D\xE9placer vers":"D\xE9placer vers","Bloc-Notes":"Bloc-Notes","Cr\xE9ez et organisez vos notes avec un \xE9diteur Markdown complet":"Cr\xE9ez et organisez vos notes avec un \xE9diteur Markdown complet","Bienvenue dans votre bloc-notes":"Bienvenue dans votre bloc-notes","Cr\xE9ez une nouvelle note ou s\xE9lectionnez-en une dans la liste":"Cr\xE9ez une nouvelle note ou s\xE9lectionnez-en une dans la liste","Cr\xE9er une note":"Cr\xE9er une note","Titre de la note...":"Titre de la note...","Aper\xE7u Markdown":"Aper\xE7u Markdown","Exporter vers Databank":"Exporter vers Databank",Supprimer:"Supprimer","Gras (Ctrl+B)":"Gras (Ctrl+B)","Italique (Ctrl+I)":"Italique (Ctrl+I)",Barr\u00E9:"Barr\xE9","Liste \xE0 puces":"Liste \xE0 puces","Liste num\xE9rot\xE9e":"Liste num\xE9rot\xE9e","Case \xE0 cocher":"Case \xE0 cocher",Lien:"Lien",Image:"Image",Tableau:"Tableau","Assistant IA":"Assistant IA","Tags (s\xE9par\xE9s par des virgules)":"Tags (s\xE9par\xE9s par des virgules)","\xC9crivez votre note en Markdown...":"\xC9crivez votre note en Markdown...","Non sauvegard\xE9":"Non sauvegard\xE9","L'IA r\xE9fl\xE9chit...":"L'IA r\xE9fl\xE9chit...",R\u00E9essayer:"R\xE9essayer",Ins\u00E9rer:"Ins\xE9rer",R\u00E9sumer:"R\xE9sumer","G\xE9n\xE9rer un r\xE9sum\xE9 concis de la note":"G\xE9n\xE9rer un r\xE9sum\xE9 concis de la note",Corriger:"Corriger","Correction orthographe et grammaire":"Correction orthographe et grammaire",Continuer:"Continuer","Compl\xE9ter la r\xE9daction du texte":"Compl\xE9ter la r\xE9daction du texte",Id\u00E9es:"Id\xE9es","G\xE9n\xE9rer des id\xE9es li\xE9es au contenu":"G\xE9n\xE9rer des id\xE9es li\xE9es au contenu","Media Downloader":"Media Downloader","T\xE9l\xE9chargez des vid\xE9os et musiques de YouTube, TikTok, Instagram, Twitter et plus":"T\xE9l\xE9chargez des vid\xE9os et musiques de YouTube, TikTok, Instagram, Twitter et plus","Collez le lien (YouTube, TikTok, Instagram...) ici...":"Collez le lien (YouTube, TikTok, Instagram...) ici...","Multi-Plateforme":"Multi-Plateforme","Supporte plus de 1000 sites web.":"Supporte plus de 1000 sites web.","Audio HQ":"Audio HQ","Extraction MP3 haute fid\xE9lit\xE9 (320kbps).":"Extraction MP3 haute fid\xE9lit\xE9 (320kbps).","Trim & Crop":"Trim & Crop","D\xE9coupez vos s\xE9quences facilement.":"D\xE9coupez vos s\xE9quences facilement.","T\xE9l\xE9chargements R\xE9cents":"T\xE9l\xE9chargements R\xE9cents",Effacer:"Effacer","Aucun t\xE9l\xE9chargement r\xE9cent":"Aucun t\xE9l\xE9chargement r\xE9cent","Titre du m\xE9dia":"Titre du m\xE9dia",Plateforme:"Plateforme",Mode:"Mode",Vid\u00E9o:"Vid\xE9o",Audio:"Audio",Qualit\u00E9:"Qualit\xE9","Auto (Max)":"Auto (Max)",Format:"Format","Options avanc\xE9es":"Options avanc\xE9es",M\u00E9tadonn\u00E9es:"M\xE9tadonn\xE9es",Miniature:"Miniature","Sous-titres":"Sous-titres",D\u00E9coupage:"D\xE9coupage","(Optionnel)":"(Optionnel)",T\u00E9l\u00E9charger:"T\xE9l\xE9charger","Initialisation...":"Initialisation...","D\xE9marrage...":"D\xE9marrage...","Pr\xEAt !":"Pr\xEAt !","T\xE9l\xE9chargement...":"T\xE9l\xE9chargement...","T\xE9l\xE9chargement termin\xE9":"T\xE9l\xE9chargement termin\xE9","Le m\xE9dia":"Le m\xE9dia","est pr\xEAt.":"est pr\xEAt.","Enregistr\xE9 dans la Databank !":"Enregistr\xE9 dans la Databank !","Erreur inconnue":"Erreur inconnue","Image AI Tools":"Image AI Tools","Supprimez l'arri\xE8re-plan ou agrandissez vos images avec l'IA":"Supprimez l'arri\xE8re-plan ou agrandissez vos images avec l'IA","Remove Background":"Remove Background","Upscale Image":"Upscale Image","Serveur REMBG non connect\xE9":"Serveur REMBG non connect\xE9","Le serveur Python doit \xEAtre d\xE9marr\xE9 pour utiliser cette fonctionnalit\xE9.":"Le serveur Python doit \xEAtre d\xE9marr\xE9 pour utiliser cette fonctionnalit\xE9.",R\u00E9essayer:"R\xE9essayer","Serveur Upscale non connect\xE9":"Serveur Upscale non connect\xE9","Mod\xE8le IA":"Mod\xE8le IA","Choisissez le mod\xE8le optimal pour vos images":"Choisissez le mod\xE8le optimal pour vos images","Mod\xE8le d'IA":"Mod\xE8le d'IA","Facteur d'agrandissement":"Facteur d'agrandissement",D\u00E9bruitage:"D\xE9bruitage","Glissez vos images ici":"Glissez vos images ici","Traiter les images":"Traiter les images","Traitement en cours...":"Traitement en cours...","V\xE9rification...":"V\xE9rification...","Transcrivez vos fichiers audio et vid\xE9o en texte avec Whisper IA":"Transcrivez vos fichiers audio et vid\xE9o en texte avec Whisper IA","Serveur Whisper non connect\xE9":"Serveur Whisper non connect\xE9","Mod\xE8le AI Whisper":"Mod\xE8le AI Whisper","Lancer la transcription":"Lancer la transcription","Transcription en cours...":"Transcription en cours...","R\xE9sultat de la transcription":"R\xE9sultat de la transcription","Copier le texte":"Copier le texte","T\xE9l\xE9charger .txt":"T\xE9l\xE9charger .txt","Nouveau fichier":"Nouveau fichier","AI Chat / PDF Expert":"AI Chat / PDF Expert","Discutez avec l'IA ou posez des questions sur vos documents":"Discutez avec l'IA ou posez des questions sur vos documents","Document Context":"Document Context","Ajouter un PDF":"Ajouter un PDF","Retirer le document":"Retirer le document","Effacer l'historique":"Effacer l'historique","Bonjour ! Je suis Ultra AI. Comment puis-je vous aider aujourd'hui ?":"Bonjour ! Je suis Ultra AI. Comment puis-je vous aider aujourd'hui ?","Vous pouvez m'envoyer un PDF via la barre lat\xE9rale pour que j'y r\xE9ponde pr\xE9cis\xE9ment.":"Vous pouvez m'envoyer un PDF via la barre lat\xE9rale pour que j'y r\xE9ponde pr\xE9cis\xE9ment.","Posez votre question ici...":"Posez votre question ici...","Posez votre question":"Posez votre question","Torrent Manager":"Torrent Manager","G\xE9rez vos t\xE9l\xE9chargements qBittorrent":"G\xE9rez vos t\xE9l\xE9chargements qBittorrent","Connexion qBittorrent":"Connexion qBittorrent","Veuillez vous connecter \xE0 votre interface WebUI":"Veuillez vous connecter \xE0 votre interface WebUI","Nom d'utilisateur":"Nom d'utilisateur","Mot de passe":"Mot de passe","Se connecter":"Se connecter",Ajouter:"Ajouter","Tout pauser":"Tout pauser","Tout reprendre":"Tout reprendre","Vitesse de t\xE9l\xE9chargement":"Vitesse de t\xE9l\xE9chargement","Vitesse d'envoi":"Vitesse d'envoi",\u00C9tat:"\xC9tat",Nom:"Nom",Taille:"Taille",Progression:"Progression",Vitesse:"Vitesse","Ajouter un Torrent":"Ajouter un Torrent","Coller du presse-papier":"Coller du presse-papier","Collez vos liens Magnet ou Hash ici...":"Collez vos liens Magnet ou Hash ici...","Partagez des fichiers en P2P avec les appareils sur votre r\xE9seau":"Partagez des fichiers en P2P avec les appareils sur votre r\xE9seau","Mon appareil":"Mon appareil","Scanner pour partager":"Scanner pour partager","Copier l'URL":"Copier l'URL","Recherche d'autres appareils sur le r\xE9seau...":"Recherche d'autres appareils sur le r\xE9seau...","Ouvrez Ultra Dashboard sur un autre appareil pour le voir ici.":"Ouvrez Ultra Dashboard sur un autre appareil pour le voir ici.","Transfert en cours":"Transfert en cours","Envoi vers...":"Envoi vers...","Mega Toolbox":"Mega Toolbox","Une collection d'outils essentiels regroup\xE9s dans une interface \xE9pur\xE9e":"Une collection d'outils essentiels regroup\xE9s dans une interface \xE9pur\xE9e","G\xE9n\xE9rateur QR Code":"G\xE9n\xE9rateur QR Code","Lien ou texte...":"Lien ou texte...","Votre QR code appara\xEEtra ici":"Votre QR code appara\xEEtra ici","T\xE9l\xE9charger l'image":"T\xE9l\xE9charger l'image","G\xE9n\xE9rer le mot de passe":"G\xE9n\xE9rer le mot de passe",Longueur:"Longueur","Outils Texte":"Outils Texte","Collez votre texte ici...":"Collez votre texte ici...",Nettoyer:"Nettoyer","0 caract\xE8res":"0 caract\xE8res","0 mots":"0 mots","Devises (Live)":"Devises (Live)","Taux de change en direct":"Taux de change en direct","Miroir Webcam":"Miroir Webcam","Cam\xE9ra d\xE9sactiv\xE9e":"Cam\xE9ra d\xE9sactiv\xE9e",Activer:"Activer",Capturer:"Capturer","S\xE9lectionner une cam\xE9ra...":"S\xE9lectionner une cam\xE9ra...","Historique et stockage centralis\xE9 de toutes vos g\xE9n\xE9rations":"Historique et stockage centralis\xE9 de toutes vos g\xE9n\xE9rations","Rechercher...":"Rechercher...","Tous les types":"Tous les types",Images:"Images",Texte:"Texte",Actualiser:"Actualiser","Tout effacer":"Tout effacer","Chargement des donn\xE9es...":"Chargement des donn\xE9es...",Pr\u00E9c\u00E9dent:"Pr\xE9c\xE9dent","Page 1":"Page 1",Suivant:"Suivant",Aper\u00E7u:"Aper\xE7u","Centre de Notifications":"Centre de Notifications","Historique de vos activit\xE9s et t\xE2ches termin\xE9es":"Historique de vos activit\xE9s et t\xE2ches termin\xE9es","Effacer tout":"Effacer tout","Aucune notification":"Aucune notification","Vos nouvelles notifications appara\xEEtront ici.":"Vos nouvelles notifications appara\xEEtront ici.","\xC0 l'instant":"\xC0 l'instant","Configuration initiale":"Configuration initiale","Cr\xE9er le compte":"Cr\xE9er le compte","Cr\xE9ation de compte":"Cr\xE9ation de compte","S'inscrire":"S'inscrire","D\xE9j\xE0 un compte ?":"D\xE9j\xE0 un compte ?","Se connecter":"Se connecter","Authentification requise":"Authentification requise","Pas de compte ?":"Pas de compte ?","Cr\xE9er un compte":"Cr\xE9er un compte","Traitement...":"Traitement...","Erreur de connexion":"Erreur de connexion","Erreur serveur":"Erreur serveur","Mod\xE8les IA T\xE9l\xE9charg\xE9s":"Mod\xE8les IA T\xE9l\xE9charg\xE9s","Recherche des mod\xE8les...":"Recherche des mod\xE8les...","Logs d'activit\xE9 serveur":"Logs d'activit\xE9 serveur","Mise \xE0 jour...":"Mise \xE0 jour...","Tous les champs sont requis":"Tous les champs sont requis","Erreur lors de la mise \xE0 jour":"Erreur lors de la mise \xE0 jour","Erreur de connexion au serveur":"Erreur de connexion au serveur","Aucun mod\xE8le t\xE9l\xE9charg\xE9 trouv\xE9.":"Aucun mod\xE8le t\xE9l\xE9charg\xE9 trouv\xE9.","Metrics non disponibles":"Metrics non disponibles","Aucun log disponible.":"Aucun log disponible.","Voulez-vous vraiment effacer les logs du serveur ?":"Voulez-vous vraiment effacer les logs du serveur ?","Voulez-vous vraiment vider le cache local ? Cela r\xE9initialisera \xE9galement vos r\xE9glages.":"Voulez-vous vraiment vider le cache local ? Cela r\xE9initialisera \xE9galement vos r\xE9glages.","Chargement...":"Chargement...",Enregistrer:"Enregistrer",Annuler:"Annuler",Succ\u00E8s:"Succ\xE8s",Erreur:"Erreur"}}});var pe={};He(pe,{Storage:()=>m});var m,M=L(()=>{m=class{static async get(e,t=null){try{let i=await(await fetch(`/api/settings/${e}`)).json();if(i.value!==null&&i.value!==void 0&&i.value!==""||i.effectiveValue)return i.value}catch(n){console.warn(`Error fetching setting ${e}:`,n)}let s=localStorage.getItem(e);if(s!==null)try{return JSON.parse(s)}catch{return s}return t}static async getFull(e){try{return await(await fetch(`/api/settings/${e}`)).json()}catch{return{key:e,value:null,source:"error"}}}static async set(e,t){localStorage.setItem(e,typeof t=="object"?JSON.stringify(t):t);try{await fetch("/api/settings",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({key:e,value:t})})}catch(s){console.error(`Error saving setting ${e}:`,s)}}static async migrate(){let e={};for(let t=0;t<localStorage.length;t++){let s=localStorage.key(t);if(s.startsWith("ultra-")){let n=localStorage.getItem(s);try{n=JSON.parse(n)}catch{}e[s]=n}}if(Object.keys(e).length!==0)try{(await fetch("/api/settings/batch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({settings:e})})).ok&&console.log("\u2705 Migration to SQLite successful")}catch(t){console.error("Migration failed:",t)}}static async getAll(){try{return await(await fetch("/api/settings")).json()}catch(e){return console.error("Error fetching all settings:",e),{}}}}});var r,P=L(()=>{he();M();r=class{static async init(){let e=await m.get("ultra-language","en");await this.applyLanguage(e)}static async applyLanguage(e){document.documentElement.setAttribute("lang",e);let t=O[e]||O.en,s=document.querySelector("title");s&&t[s.textContent.trim()]&&(s.textContent=t[s.textContent.trim()]);let n=document.querySelector('meta[name="description"]');n&&t[n.content.trim()]&&(n.content=t[n.content.trim()]),document.querySelectorAll("[data-i18n]").forEach(o=>{let d=o.dataset.i18n||o.textContent.trim();t[d]&&(o.tagName==="INPUT"||o.tagName==="TEXTAREA"?o.placeholder&&t[o.placeholder]&&(o.placeholder=t[o.placeholder]):o.textContent=t[d])}),document.querySelectorAll("[data-i18n-placeholder]").forEach(o=>{let d=o.dataset.i18nPlaceholder;t[d]&&(o.placeholder=t[d])}),document.querySelectorAll("[data-i18n-title]").forEach(o=>{let d=o.dataset.i18nTitle;t[d]&&(o.title=t[d])}),this.translateBySelectors(t)}static translateBySelectors(e){[".nav-label",".nav-section-title",".content-header h1",".content-header .subtitle",".settings-group-title",".setting-title",".setting-description",".welcome-text h1",".welcome-text p","#addWidgetBtn",".store-header h2",".store-item h4",".store-item p",".btn-primary",".btn-secondary",".btn-add-widget span",".version",".plexus-tagline",".plexus-suggestion span",".plexus-followup h4",".plexus-sources-title",".plexus-thinking-header span",".thinking-step span",".plexus-logo-text",".tool-title",".drop-text",".drop-subtext",".btn-text",".option-title",".option-desc",".progress-text",".success-message p",".empty-history-text",".history-header h3",".feature-text h4",".feature-text p",".platform-card span",".yt-channel",".yt-info label",".yt-select option",".custom-checkbox",".trim-group label",".checkbox-group label",".header-with-status h1",".server-error h3",".server-error p",".model-label",".model-name",".model-desc",".badge-perf",".result-label",".chat-sidebar .section-title",".pdf-upload-label .text",".message-content",".metadata-table th",".empty-state h3",".empty-state p",".status-info",".login-overlay h3",".login-overlay p",".stat-item",".torrent-header-row div",".modal-title",".device-label",".share-label",".no-devices p",".tool-button",".stat-label-row span",".tool-checkbox",".text-stats span",".mirror-placeholder p",".header-title p","#authSubtitle","#authToggleText","#authToggleBtn","#setupNotice span","#authForm .btn-text"].forEach(s=>{document.querySelectorAll(s).forEach(n=>{let i=Array.from(n.childNodes).filter(a=>a.nodeType===Node.TEXT_NODE);if(i.length>0)i.forEach(a=>{let l=a.textContent.trim();if(l&&e[l]){let o=a.textContent.match(/^\s*/)[0],d=a.textContent.match(/\s*$/)[0];a.textContent=o+e[l]+d}});else{let a=n.textContent.trim();a&&e[a]&&(n.textContent=e[a])}})}),document.querySelectorAll("input, textarea").forEach(s=>{s.placeholder&&e[s.placeholder]&&(s.placeholder=e[s.placeholder])}),document.querySelectorAll(".settings-tab-link").forEach(s=>{Array.from(s.childNodes).filter(i=>i.nodeType===Node.TEXT_NODE).forEach(i=>{let a=i.textContent.trim();if(a&&e[a]){let l=i.textContent.match(/^\s*/)[0];i.textContent=l+e[a]}})})}static t(e){if(!e)return"";let t=document.documentElement.getAttribute("lang")||"en";return(O[t]||O.en)[e]||e}static async setLanguage(e){await m.set("ultra-language",e),window.location.reload()}}});var Q,ge=L(()=>{_();P();Q=class{constructor(){this.selectedFile=null,this.selectedFormat=null,this.supportedFormats=null,this.compressEnabled=!1,this.compressQuality=75,this.elements={dropZone:document.getElementById("dropZone"),fileInput:document.getElementById("fileInput"),fileInfo:document.getElementById("fileInfo"),formatSection:document.getElementById("formatSection"),formatGrid:document.getElementById("formatGrid"),convertBtn:document.getElementById("convertBtn"),progressContainer:document.getElementById("progressContainer"),successMessage:document.getElementById("successMessage"),fileName:document.getElementById("fileName"),fileSize:document.getElementById("fileSize"),convertOptions:document.getElementById("convertOptions"),compressToggle:document.getElementById("compressToggle"),saveBtn:document.getElementById("convertSaveBtn")},this.init()}init(){this.loadFormats(),this.elements.dropZone.addEventListener("click",()=>{this.elements.fileInput.click()}),this.elements.dropZone.addEventListener("dragover",t=>{t.preventDefault(),this.elements.dropZone.classList.add("drag-over")}),this.elements.dropZone.addEventListener("dragleave",()=>{this.elements.dropZone.classList.remove("drag-over")}),this.elements.dropZone.addEventListener("drop",t=>{t.preventDefault(),this.elements.dropZone.classList.remove("drag-over");let s=t.dataTransfer.files[0];s&&this.handleFile(s)}),this.elements.fileInput.addEventListener("change",t=>{let s=t.target.files[0];s&&this.handleFile(s)});let e=document.getElementById("removeFile");e&&e.addEventListener("click",()=>this.reset()),this.elements.compressToggle&&this.elements.compressToggle.addEventListener("change",t=>{this.compressEnabled=t.target.checked,this.updateButtonState()}),this.elements.convertBtn&&this.elements.convertBtn.addEventListener("click",()=>this.processFile())}handleFile(e){this.selectedFile=e,this.selectedFormat=null,this.elements.dropZone.classList.add("hidden"),this.elements.fileInfo.classList.remove("hidden"),this.elements.formatSection.classList.remove("hidden"),this.elements.convertOptions.classList.remove("hidden"),this.elements.successMessage.classList.add("hidden"),this.elements.saveBtn.classList.add("hidden"),this.elements.fileName.textContent=e.name,this.elements.fileSize.textContent=q(e.size);let t=document.getElementById("imagePreview"),s=document.getElementById("fileIconLarge");if(e.type.startsWith("image/")){let n=new FileReader;n.onload=i=>{t.src=i.target.result,t.classList.remove("hidden"),s.classList.add("hidden")},n.readAsDataURL(e)}else t.classList.add("hidden"),s.classList.remove("hidden");this.generateFormatButtons(e)}generateFormatButtons(e){let t=this.elements.formatGrid;if(t.innerHTML="",!this.supportedFormats)return;let s=e.type.split("/")[0];(this.supportedFormats[s]||[]).forEach(i=>{let a=document.createElement("button");a.className="format-btn",a.textContent=i.toUpperCase(),a.addEventListener("click",()=>{t.querySelectorAll(".format-btn").forEach(l=>l.classList.remove("active")),a.classList.add("active"),this.selectedFormat=i,this.updateButtonState()}),t.appendChild(a)}),A()}async loadFormats(){try{let e=await fetch("/api/convert/formats");this.supportedFormats=await e.json()}catch(e){console.error("Erreur chargement formats",e)}}updateButtonState(){let e=this.selectedFormat||this.compressEnabled;this.elements.convertBtn.classList.toggle("hidden",!e);let t=this.elements.convertBtn.querySelector(".btn-text");this.selectedFormat&&this.compressEnabled?t.innerHTML=`<i data-lucide="refresh-cw" class="inline-icon"></i> ${r.t("Convertir")} & ${r.t("Compresser")}`:this.compressEnabled?t.innerHTML=`<i data-lucide="package" class="inline-icon"></i> ${r.t("Compresser")}`:t.innerHTML=`<i data-lucide="refresh-cw" class="inline-icon"></i> ${r.t("Convertir")}`,A()}async processFile(){this.elements.convertBtn.disabled=!0,this.elements.progressContainer.classList.remove("hidden");let e=this.elements.convertBtn.querySelector(".btn-text"),t=e.textContent;e.textContent=r.t("Traitement en cours...");let s=new FormData;s.append("file",this.selectedFile),this.selectedFormat&&s.append("targetFormat",this.selectedFormat),s.append("compress",this.compressEnabled.toString()),s.append("quality",this.compressQuality.toString());try{let n=await fetch("/api/convert",{method:"POST",body:s});if(!n.ok){let a=await n.json();throw new Error(a.error||r.t("Erreur lors du traitement"))}let i=await n.json();this.elements.successMessage.classList.remove("hidden"),document.dispatchEvent(new CustomEvent("app-notification",{detail:{title:r.t("Conversion termin\xE9e"),message:`${r.t("Le fichier")} ${this.selectedFile.name} ${r.t("a \xE9t\xE9 trait\xE9 avec succ\xE8s.")}`,type:"success",icon:"refresh-cw"}})),i.databankUrl&&this.elements.saveBtn&&(this.elements.saveBtn.href=i.databankUrl,this.elements.saveBtn.setAttribute("download",i.fileName||"converted-file"),this.elements.saveBtn.classList.remove("hidden"),this.elements.convertBtn.classList.add("hidden"))}catch(n){alert("\u{1F6A8} "+n.message)}finally{this.elements.convertBtn.disabled=!1,e.textContent=t,this.elements.progressContainer.classList.add("hidden")}}reset(){this.selectedFile=null,this.selectedFormat=null,this.compressEnabled=!1,this.compressQuality=75,this.elements.dropZone.classList.remove("hidden"),this.elements.fileInfo.classList.add("hidden"),this.elements.formatSection.classList.add("hidden"),this.elements.convertOptions.classList.add("hidden"),this.elements.convertBtn.classList.add("hidden"),this.elements.successMessage.classList.add("hidden"),this.elements.fileInput.value="",this.elements.compressToggle.checked=!1}}});var J,ve=L(()=>{_();P();J=class{constructor(){this.elements={urlInput:document.getElementById("dlUrl"),searchBtn:document.getElementById("dlSearchBtn"),preview:document.getElementById("dlPreview"),loading:document.getElementById("dlLoading"),thumbnail:document.getElementById("dlThumbnail"),title:document.getElementById("dlTitle"),channel:document.getElementById("dlChannel"),duration:document.getElementById("dlDuration"),downloadBtn:document.getElementById("dlDownloadBtn"),saveBtn:document.getElementById("dlSaveBtn"),modeToggles:document.querySelectorAll(".dl-mode-toggle .toggle-btn"),qualitySelect:document.getElementById("dlQuality"),formatSelect:document.getElementById("dlFormat"),advancedBtn:document.getElementById("dlAdvancedBtn"),advancedPanel:document.getElementById("dlAdvancedOptions"),chkMetadata:document.getElementById("chkDlMetadata"),chkThumbnail:document.getElementById("chkDlThumbnail"),chkSubs:document.getElementById("chkDlSubs"),trimStart:document.getElementById("trimDlStart"),trimEnd:document.getElementById("trimDlEnd"),containerSubtitles:document.getElementById("containerDlSubtitles"),progressContainer:document.getElementById("dlProgressContainer"),progressFill:document.getElementById("dlProgressFill"),progressStatus:document.getElementById("dlProgressStatus"),progressPercent:document.getElementById("dlProgressPercent"),emptyState:document.getElementById("dlEmptyState"),historyList:document.getElementById("dlHistoryList"),clearHistoryBtn:document.getElementById("btnClearDlHistory"),playlistContainer:document.getElementById("dlPlaylistContainer"),playlistList:document.getElementById("dlPlaylistList"),playlistCount:document.getElementById("playlistCount"),btnPlaylistSelectAll:document.getElementById("btnPlaylistSelectAll")},this.currentMode="video",this.currentUrl="",this.mediaInfo=null,this.elements.urlInput&&this.init()}init(){this.elements.searchBtn.onclick=()=>this.fetchInfo(),this.elements.urlInput.onkeypress=e=>{e.key==="Enter"&&this.fetchInfo()},this.elements.modeToggles.forEach(e=>{e.onclick=()=>{this.elements.modeToggles.forEach(t=>t.classList.remove("active")),e.classList.add("active"),this.setMode(e.dataset.mode)}}),this.elements.advancedBtn&&(this.elements.advancedBtn.onclick=()=>{this.elements.advancedPanel.classList.toggle("hidden")}),this.elements.downloadBtn.onclick=()=>this.download(),this.elements.clearHistoryBtn.onclick=()=>this.clearHistory(),this.loadHistory(),this.elements.btnPlaylistSelectAll&&(this.elements.btnPlaylistSelectAll.onclick=()=>this.toggleAllPlaylistEntries()),this.setMode("video")}isYoutube(e){return e.includes("youtube.com")||e.includes("youtu.be")}setMode(e){this.currentMode=e;let t=this.elements.formatSelect;t.innerHTML="",e==="video"?(["mp4","mkv","webm"].forEach(s=>{t.add(new Option(s.toUpperCase(),s))}),this.elements.qualitySelect.disabled=!1,this.elements.chkSubs&&(this.elements.chkSubs.disabled=!1),this.elements.containerSubtitles&&(this.elements.containerSubtitles.style.opacity="1")):(["mp3","m4a","wav","flac","opus"].forEach(s=>{t.add(new Option(s.toUpperCase(),s))}),this.elements.qualitySelect.disabled=!0,this.elements.chkSubs&&(this.elements.chkSubs.disabled=!0,this.elements.chkSubs.checked=!1),this.elements.containerSubtitles&&(this.elements.containerSubtitles.style.opacity="0.5")),this.mediaInfo&&e==="video"&&this.populateQualities(this.mediaInfo.resolutions)}async fetchInfo(){let e=this.elements.urlInput.value.trim();if(!e)return;this.currentUrl=e,this.showLoading(!0),this.elements.preview.classList.add("hidden"),this.elements.emptyState.classList.add("hidden"),this.elements.saveBtn.classList.add("hidden"),this.elements.downloadBtn.classList.remove("hidden");let s=this.isYoutube(e)?"/api/youtube/info":"/api/social/info";try{let i=await(await fetch(`${s}?url=${encodeURIComponent(e)}`)).json();if(i.error)throw new Error(i.error);this.mediaInfo=i,this.updatePreview(i)}catch(n){alert(r.t("Erreur")+": "+n.message)}finally{this.showLoading(!1)}}updatePreview(e){this.elements.thumbnail.src=e.thumbnail||"/img/social-placeholder.png",this.elements.title.textContent=e.title;let t=e.platform?e.platform.toUpperCase():"YOUTUBE";this.elements.channel.textContent=t+(e.channel?` \u2022 ${e.channel}`:""),e.isPlaylist?(this.elements.duration.textContent=`${e.entriesCount} vid\xE9os`,this.renderPlaylist(e.entries),this.elements.playlistContainer.classList.remove("hidden")):(this.elements.duration.textContent=re(e.duration),this.elements.playlistContainer.classList.add("hidden"),this.populateQualities(e.resolutions),this.setMode(this.currentMode)),this.elements.preview.classList.remove("hidden"),this.elements.emptyState.classList.add("hidden")}renderPlaylist(e){this.elements.playlistCount.textContent=`${e.length} vid\xE9os`,this.elements.playlistList.innerHTML=e.map((t,s)=>`
            <div class="playlist-entry" data-index="${s}" data-url="${t.url}">
                <input type="checkbox" class="playlist-entry-checkbox" checked>
                <img src="${t.thumbnail||"/img/social-placeholder.png"}" class="playlist-entry-thumb">
                <div class="playlist-entry-info">
                    <div class="playlist-entry-title">${t.title}</div>
                    <div class="playlist-entry-duration">${re(t.duration)}</div>
                </div>
            </div>
        `).join(""),this.elements.playlistList.querySelectorAll(".playlist-entry").forEach(t=>{t.onclick=s=>{if(s.target.type==="checkbox")return;let n=t.querySelector(".playlist-entry-checkbox");n.checked=!n.checked}})}toggleAllPlaylistEntries(){let e=this.elements.playlistList.querySelectorAll(".playlist-entry-checkbox"),t=Array.from(e).some(s=>!s.checked);e.forEach(s=>s.checked=t)}async addToHistory(e){let t=await this.getHistory(),s={id:Date.now(),title:e.title,thumbnail:e.thumbnail,platform:e.platform||"YouTube",timestamp:new Date().toISOString()};t=t.filter(n=>n.title!==e.title),t.unshift(s),t=t.slice(0,10),localStorage.setItem("ultra-dl-history",JSON.stringify(t)),this.renderHistory(t)}async getHistory(){let e=localStorage.getItem("ultra-dl-history");if(!e){let t=localStorage.getItem("ultra-yt-history"),s=localStorage.getItem("ultra-social-history");if(t||s){let n=[];return t&&(n=n.concat(JSON.parse(t))),s&&(n=n.concat(JSON.parse(s))),n.sort((i,a)=>new Date(a.timestamp)-new Date(i.timestamp)),n=n.slice(0,10),localStorage.setItem("ultra-dl-history",JSON.stringify(n)),n}return[]}return JSON.parse(e)}async loadHistory(){let e=await this.getHistory();this.renderHistory(e)}renderHistory(e){let t=this.elements.historyList;if(!e||e.length===0){t.innerHTML=`<p class="empty-history-text">${r.t("Aucun t\xE9l\xE9chargement r\xE9cent")}</p>`;return}t.innerHTML=e.map(s=>`
            <div class="history-item">
                <img src="${s.thumbnail||"/img/social-placeholder.png"}" class="history-item-thumb">
                <div class="history-item-info">
                    <div class="history-item-title">${s.title}</div>
                    <div class="history-item-meta">${s.platform.toUpperCase()} \u2022 ${new Date(s.timestamp).toLocaleDateString()}</div>
                </div>
            </div>
        `).join(""),A()}clearHistory(){localStorage.removeItem("ultra-dl-history"),localStorage.removeItem("ultra-yt-history"),localStorage.removeItem("ultra-social-history"),this.renderHistory([])}populateQualities(e){let t=this.elements.qualitySelect;t.innerHTML='<option value="best">Auto (Max)</option>',e&&e.length&&e.forEach(s=>{let n=s>=2160?"4K/2160p":s>=1440?"2K/1440p":s>=1080?"1080p":`${s}p`;t.add(new Option(n,s))})}async download(){let e=Array.from(this.elements.playlistList.querySelectorAll(".playlist-entry")).filter(t=>t.querySelector(".playlist-entry-checkbox").checked);if(this.mediaInfo.isPlaylist&&e.length>0){let t=e.length,s=0;for(let n of e){s++;let i=n.dataset.url,a=n.querySelector(".playlist-entry-title").textContent;try{await this.downloadItem(i,a,`${s}/${t}`,t)}catch(l){console.error(`Failed to download ${a}:`,l)}}}else await this.downloadItem(this.currentUrl,this.mediaInfo.title)}async downloadItem(e,t,s="",n=1){let i=this.elements.downloadBtn,a=i.querySelector(".btn-text"),l=i.querySelector(".btn-loader"),o=Date.now().toString()+Math.floor(Math.random()*1e3);i.disabled=!0;let d=s?`[${s}] `:"";a.textContent=d+r.t("Initialisation..."),l.classList.remove("hidden"),this.elements.progressContainer&&(this.elements.progressContainer.classList.remove("hidden"),this.elements.progressFill.style.width="0%",this.elements.progressStatus.textContent=d+r.t("D\xE9marrage..."),this.elements.progressPercent.textContent="0%");let u=this.isYoutube(e),h=u?`/api/youtube/progress/${o}`:`/api/social/progress/${o}`,g=u?"/api/youtube/download":"/api/social/download",E=new EventSource(h);E.onmessage=y=>{let b=JSON.parse(y.data);b.type==="progress"?(this.elements.progressFill&&(this.elements.progressFill.style.width=`${b.percent}%`),this.elements.progressPercent&&(this.elements.progressPercent.textContent=`${Math.round(b.percent)}%`),this.elements.progressStatus&&(this.elements.progressStatus.textContent=d+b.status),a.textContent=`${d}${b.status} (${Math.round(b.percent)}%)`):b.type==="complete"&&(this.elements.progressFill&&(this.elements.progressFill.style.width="100%"),this.elements.progressPercent&&(this.elements.progressPercent.textContent="100%"),this.elements.progressStatus&&(this.elements.progressStatus.textContent=d+r.t("Pr\xEAt !")))};try{let y={url:e,mode:this.currentMode,quality:this.elements.qualitySelect.value,format:this.elements.formatSelect.value};u?(y.videoId=o,y.embedMetadata=this.elements.chkMetadata.checked,y.embedThumbnail=this.elements.chkThumbnail.checked,y.embedSubs=this.elements.chkSubs.checked):y.downloadId=o;let b=await fetch(g,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)});if(!b.ok){let v=await b.json();throw new Error(v.error||r.t("Erreur inconnue"))}E.close();let w=await b.json();document.dispatchEvent(new CustomEvent("app-notification",{detail:{title:r.t("T\xE9l\xE9chargement termin\xE9"),message:`${r.t("Le m\xE9dia")} "${t}" ${r.t("est pr\xEAt.")}`,type:"success",icon:"download"}})),w.fileName&&!s&&(this.elements.saveBtn.href=`/databank/${w.fileName}`,this.elements.saveBtn.download=w.prettyName||w.fileName,this.elements.saveBtn.classList.remove("hidden"),this.elements.downloadBtn.classList.add("hidden"))}catch(y){E.close(),alert(r.t("Erreur")+": "+y.message)}finally{(!s||s.endsWith(`${n}/${n}`))&&(i.disabled=!1,a.textContent=r.t("T\xE9l\xE9charger"),l.classList.add("hidden"),setTimeout(()=>{this.elements.progressContainer&&this.elements.progressContainer.classList.add("hidden")},5e3))}}showLoading(e){e?this.elements.loading.classList.remove("hidden"):(this.elements.loading.classList.add("hidden"),this.elements.preview.classList.contains("hidden")&&this.elements.emptyState.classList.remove("hidden"))}}});var Z,fe=L(()=>{M();Z=class{constructor(){this.currentTool="removebg",this.selectedFiles=[],this.results=[],this.selectedModel="u2net",this.selectedUpscaleModel="edsr",this.selectedScale=4,this.denoise=!1,this.isRembgAvailable=!1,this.isUpscaleAvailable=!1,this.reconnectIntervals={rembg:null,upscale:null},this.isProcessing=!1,this.elements={toolBtns:document.querySelectorAll(".tool-btn"),rembgStatus:document.getElementById("imageAiRembgStatus"),upscaleStatus:document.getElementById("imageAiUpscaleStatus"),rembgError:document.getElementById("imageAiRembgError"),upscaleError:document.getElementById("imageAiUpscaleError"),rembgOptions:document.getElementById("imageAiRembgOptions"),upscaleOptions:document.getElementById("imageAiUpscaleOptions"),dropZone:document.getElementById("imageAiDropZone"),fileInput:document.getElementById("imageAiFileInput"),fileList:document.getElementById("imageAiFileList"),modelOptions:document.querySelectorAll(".model-option"),upscaleModelToggles:document.querySelectorAll("#imageAiUpscaleOptions .model-toggle .toggle-btn"),scaleToggles:document.querySelectorAll(".scale-toggle .toggle-btn"),denoiseToggles:document.querySelectorAll(".denoise-toggle .toggle-btn"),processBtn:document.getElementById("imageAiProcessBtn"),processText:document.getElementById("imageAiProcessText"),progressContainer:document.getElementById("imageAiProgressContainer"),progressFill:document.getElementById("imageAiProgressFill"),progressText:document.getElementById("imageAiProgressText"),resultContainer:document.getElementById("imageAiResultContainer")},this.init()}async init(){await this.loadDefaultSettings(),await this.checkServers(),this.setupEventListeners(),this.updateToolUI(),document.addEventListener("tab-changed",e=>{e.detail.tabId==="image-ai"&&this.loadDefaultSettings()})}async loadDefaultSettings(){if(this.isProcessing)return;let e=await m.get("ultra-rembg-default-model","u2net");this.selectedModel=e,this.elements.modelOptions.forEach(n=>{n.classList.toggle("active",n.dataset.model===e)});let t=await m.get("ultra-upscale-default-model","edsr"),s=await m.get("ultra-upscale-default-scale","4");this.selectedUpscaleModel=t,this.selectedScale=parseInt(s),this.elements.upscaleModelToggles.forEach(n=>{n.classList.toggle("active",n.dataset.model===this.selectedUpscaleModel)}),this.elements.scaleToggles.forEach(n=>{n.classList.toggle("active",n.dataset.scale===this.selectedScale.toString())})}async checkServers(){try{let t=await(await fetch("/api/rembg/health")).json();this.isRembgAvailable=t.available===!0}catch{this.isRembgAvailable=!1}try{let t=await(await fetch("/api/upscale/health")).json();this.isUpscaleAvailable=t.available===!0}catch{this.isUpscaleAvailable=!1}this.updateServerStatus()}updateServerStatus(){this.isRembgAvailable?(this.elements.rembgStatus.textContent="\u25CF REMBG",this.elements.rembgStatus.classList.add("connected"),this.elements.rembgStatus.classList.remove("disconnected"),this.elements.rembgError.classList.add("hidden")):(this.elements.rembgStatus.textContent="\u25CB REMBG",this.elements.rembgStatus.classList.add("disconnected"),this.elements.rembgStatus.classList.remove("connected"),this.currentTool==="removebg"&&(this.elements.rembgError.classList.remove("hidden"),this.startAutoReconnect("rembg"))),this.isUpscaleAvailable?(this.elements.upscaleStatus.textContent="\u25CF Upscale",this.elements.upscaleStatus.classList.add("connected"),this.elements.upscaleStatus.classList.remove("disconnected"),this.elements.upscaleError.classList.add("hidden")):(this.elements.upscaleStatus.textContent="\u25CB Upscale",this.elements.upscaleStatus.classList.add("disconnected"),this.elements.upscaleStatus.classList.remove("connected"),this.currentTool==="upscale"&&(this.elements.upscaleError.classList.remove("hidden"),this.startAutoReconnect("upscale")))}startAutoReconnect(e){this.reconnectIntervals[e]||(this.reconnectIntervals[e]=setInterval(async()=>{await this.checkServers(),(e==="rembg"?this.isRembgAvailable:this.isUpscaleAvailable)&&(clearInterval(this.reconnectIntervals[e]),this.reconnectIntervals[e]=null)},3e3))}setupEventListeners(){this.elements.toolBtns.forEach(e=>{e.onclick=()=>{this.isProcessing||(this.elements.toolBtns.forEach(t=>t.classList.remove("active")),e.classList.add("active"),this.currentTool=e.getAttribute("data-tool"),this.updateToolUI(),this.reset())}}),this.elements.dropZone.onclick=()=>{this.canProcess()&&!this.isProcessing&&this.elements.fileInput.click()},this.elements.fileInput.onchange=e=>{e.target.files.length>0&&(this.handleFiles(Array.from(e.target.files)),this.elements.fileInput.value="")},this.elements.dropZone.ondragover=e=>{e.preventDefault(),this.canProcess()&&!this.isProcessing&&this.elements.dropZone.classList.add("drag-over")},this.elements.dropZone.ondragleave=()=>{this.elements.dropZone.classList.remove("drag-over")},this.elements.dropZone.ondrop=e=>{e.preventDefault(),this.elements.dropZone.classList.remove("drag-over"),this.canProcess()&&!this.isProcessing&&e.dataTransfer.files.length&&this.handleFiles(Array.from(e.dataTransfer.files))},this.elements.processBtn.onclick=()=>this.processImages(),this.elements.modelOptions.forEach(e=>{e.onclick=()=>{this.isProcessing||(this.elements.modelOptions.forEach(t=>t.classList.remove("active")),e.classList.add("active"),this.selectedModel=e.getAttribute("data-model"))}}),this.elements.scaleToggles.forEach(e=>{e.onclick=()=>{this.isProcessing||(this.elements.scaleToggles.forEach(t=>t.classList.remove("active")),e.classList.add("active"),this.selectedScale=parseInt(e.getAttribute("data-scale")))}}),this.elements.upscaleModelToggles.forEach(e=>{e.onclick=()=>{this.isProcessing||(this.elements.upscaleModelToggles.forEach(t=>t.classList.remove("active")),e.classList.add("active"),this.selectedUpscaleModel=e.getAttribute("data-model"))}}),this.elements.denoiseToggles.forEach(e=>{e.onclick=()=>{this.isProcessing||(this.elements.denoiseToggles.forEach(t=>t.classList.remove("active")),e.classList.add("active"),this.denoise=e.getAttribute("data-denoise")==="true")}}),document.getElementById("imageAiRembgRetryBtn")?.addEventListener("click",()=>{this.checkServers()}),document.getElementById("imageAiUpscaleRetryBtn")?.addEventListener("click",()=>{this.checkServers()})}updateToolUI(){this.currentTool==="removebg"?(this.elements.rembgOptions.classList.remove("hidden"),this.elements.upscaleOptions.classList.add("hidden"),this.elements.rembgError.classList.toggle("hidden",this.isRembgAvailable),this.elements.upscaleError.classList.add("hidden"),this.elements.processText.textContent="Supprimer l'arri\xE8re-plan",this.elements.dropZone.classList.toggle("disabled",!this.isRembgAvailable)):(this.elements.rembgOptions.classList.add("hidden"),this.elements.upscaleOptions.classList.remove("hidden"),this.elements.upscaleError.classList.toggle("hidden",this.isUpscaleAvailable),this.elements.rembgError.classList.add("hidden"),this.elements.processText.textContent="Agrandir les images",this.elements.dropZone.classList.toggle("disabled",!this.isUpscaleAvailable))}canProcess(){return this.currentTool==="removebg"?this.isRembgAvailable:this.isUpscaleAvailable}handleFiles(e){let t=["image/png","image/jpeg","image/jpg","image/webp","image/gif","image/bmp"];e.forEach(s=>{if(!t.includes(s.type)){console.warn(`Type de fichier non support\xE9: ${s.name}`);return}if(s.size>30*1024*1024){console.warn(`Fichier trop volumineux: ${s.name}`);return}this.selectedFiles.some(i=>i.name===s.name&&i.size===s.size)||this.selectedFiles.push({file:s,name:s.name,size:s.size,status:"pending",preview:URL.createObjectURL(s)})}),this.updateUI()}updateUI(){this.selectedFiles.length>0?(this.elements.dropZone.classList.add("hidden"),this.elements.fileList.classList.remove("hidden"),this.elements.processBtn.classList.remove("hidden"),this.renderFileList()):(this.elements.dropZone.classList.remove("hidden"),this.elements.fileList.classList.add("hidden"),this.elements.processBtn.classList.add("hidden"))}renderFileList(){this.elements.fileList.innerHTML="",this.selectedFiles.forEach((e,t)=>{let s=document.createElement("div");s.className=`rembg-file-item ${e.status}`,s.innerHTML=`
                <div class="rembg-preview">
                    <img src="${e.preview}" alt="Aper\xE7u">
                </div>
                <div class="file-details">
                    <h3>${e.name}</h3>
                    <p>${this.formatSize(e.size)}</p>
                    <div class="item-status">${this.getStatusText(e.status)}</div>
                </div>
                ${this.isProcessing?"":`
                    <button class="btn-remove-item" data-index="${t}">
                        <i data-lucide="trash-2"></i>
                    </button>
                `}
            `,this.elements.fileList.appendChild(s)}),window.lucide&&window.lucide.createIcons(),this.elements.fileList.querySelectorAll(".btn-remove-item").forEach(e=>{e.onclick=()=>{let t=parseInt(e.getAttribute("data-index"));this.removeFile(t)}})}getStatusText(e){switch(e){case"pending":return"En attente";case"processing":return"Traitement...";case"completed":return"Termin\xE9";case"error":return"Erreur";default:return""}}removeFile(e){let t=this.selectedFiles[e];t.preview&&URL.revokeObjectURL(t.preview),this.selectedFiles.splice(e,1),this.updateUI()}async processImages(){if(this.selectedFiles.length===0||this.isProcessing||!this.canProcess())return;this.isProcessing=!0,this.results=[],this.elements.processBtn.disabled=!0,this.elements.processBtn.classList.add("hidden"),this.elements.progressContainer.classList.remove("hidden");let e=this.selectedFiles.length,t=this.currentTool==="removebg"?"/api/rembg/remove":"/api/upscale/process";for(let s=0;s<this.selectedFiles.length;s++){let n=this.selectedFiles[s];n.status="processing",this.renderFileList(),this.elements.progressText.textContent=`Traitement de ${s+1}/${e} : ${n.name}`,this.updateProgress(s/e*100);try{let i=new FormData;i.append("file",n.file),this.currentTool==="removebg"?i.append("model",this.selectedModel):(i.append("model",this.selectedUpscaleModel),i.append("scale",this.selectedScale),i.append("denoise",this.denoise));let a=await fetch(t,{method:"POST",body:i});if(!a.ok){let d=await a.json();throw new Error(d.error||"Erreur lors du traitement")}let l=await a.json(),o=`/databank/${l.fileName}`;n.status="completed",n.resultUrl=o,this.results.push({name:n.name,url:o,fileName:l.fileName})}catch(i){console.error(`Error processing ${n.name}:`,i),n.status="error",n.error=i.message}}this.updateProgress(100),this.elements.progressText.textContent="Traitement termin\xE9 !",this.isProcessing=!1,setTimeout(()=>{this.showResults();let s=this.currentTool==="removebg"?"Remove Background":"Upscale";document.dispatchEvent(new CustomEvent("app-notification",{detail:{title:`${s} termin\xE9`,message:`${this.results.length} image(s) trait\xE9e(s) avec succ\xE8s.`,type:"success",icon:"sparkles"}}))},800)}updateProgress(e){this.elements.progressFill.style.width=`${e}%`}showResults(){this.elements.fileList.classList.add("hidden"),this.elements.progressContainer.classList.add("hidden"),this.elements.resultContainer.classList.remove("hidden");let e=document.createElement("div");e.className="results-grid",this.results.forEach((a,l)=>{let o=document.createElement("div");o.className="result-card",o.innerHTML=`
                <img src="${a.url}" alt="${a.name}">
                <h4>${a.name}</h4>
                <button class="btn-secondary btn-sm" onclick="window.downloadImageAIResult(${l})">
                    <i data-lucide="download"></i> T\xE9l\xE9charger
                </button>
            `,e.appendChild(o)}),window.downloadImageAIResult=a=>{let l=this.results[a],o=document.createElement("a");o.href=l.url;let d=this.currentTool==="removebg"?"nobg":`upscaled-x${this.selectedScale}`;o.download=`${d}-${l.name.replace(/\.[^.]+$/,"")}.png`,o.click()};let t=this.elements.resultContainer;t.innerHTML="";let s=document.createElement("h3");s.textContent=`${this.results.length} image(s) trait\xE9e(s)`,s.style.marginBottom="24px",t.appendChild(s),t.appendChild(e);let n=document.createElement("div");if(n.className="result-actions",this.results.length>1){let a=document.createElement("button");a.className="btn-convert",a.innerHTML='<span class="btn-text"><i data-lucide="package"></i> Tout t\xE9l\xE9charger (ZIP)</span>',a.onclick=()=>this.downloadAllAsZip(),n.appendChild(a)}else if(this.results.length===1){let a=document.createElement("button");a.className="btn-convert",a.innerHTML='<span class="btn-text"><i data-lucide="download"></i> T\xE9l\xE9charger</span>',a.onclick=()=>window.downloadImageAIResult(0),n.appendChild(a)}let i=document.createElement("button");i.className="btn-secondary",i.textContent="Nouvelles images",i.onclick=()=>this.reset(),n.appendChild(i),t.appendChild(n),window.lucide&&window.lucide.createIcons()}async downloadAllAsZip(){if(window.JSZip||typeof JSZip<"u"){let e=new JSZip,t=this.currentTool==="removebg"?"nobg":`upscaled-x${this.selectedScale}`;for(let i of this.results){let l=await(await fetch(i.url)).blob();e.file(`${t}-${i.name.replace(/\.[^.]+$/,"")}.png`,l)}let s=await e.generateAsync({type:"blob"}),n=document.createElement("a");n.href=URL.createObjectURL(s),n.download=`${t}-images.zip`,n.click()}else for(let e=0;e<this.results.length;e++)window.downloadImageAIResult(e),await new Promise(t=>setTimeout(t,300))}reset(){this.selectedFiles.forEach(e=>{e.preview&&URL.revokeObjectURL(e.preview)}),this.results.forEach(e=>{e.url&&URL.revokeObjectURL(e.url)}),this.selectedFiles=[],this.results=[],this.isProcessing=!1,this.elements.dropZone.classList.remove("hidden"),this.elements.fileList.classList.add("hidden"),this.elements.resultContainer.classList.add("hidden"),this.elements.progressContainer.classList.add("hidden"),this.elements.processBtn.classList.add("hidden"),this.elements.processBtn.disabled=!1,this.elements.fileInput.value="",this.elements.progressFill.style.width="0%"}formatSize(e){if(e===0)return"0 B";let t=1024,s=["B","KB","MB","GB"],n=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,n)).toFixed(2))+" "+s[n]}}});var Y,ye=L(()=>{M();Y=class{constructor(){this.selectedFile=null,this.isServerAvailable=!1,this.reconnectInterval=null,this.availableModels=[],this.elements={dropZone:document.getElementById("sttDropZone"),fileInput:document.getElementById("sttFileInput"),fileInfo:document.getElementById("sttFileInfo"),fileName:document.getElementById("sttFileName"),fileSize:document.getElementById("sttFileSize"),fileDuration:document.getElementById("sttFileDuration"),removeBtn:document.getElementById("sttRemoveFile"),modelSelect:document.getElementById("sttModelSelect"),transcribeBtn:document.getElementById("sttTranscribeBtn"),progressContainer:document.getElementById("sttProgressContainer"),progressFill:document.getElementById("sttProgressFill"),progressText:document.getElementById("sttProgressText"),resultContainer:document.getElementById("sttResultContainer"),resultText:document.getElementById("sttResultText"),copyBtn:document.getElementById("sttCopyBtn"),downloadBtn:document.getElementById("sttDownloadBtn"),newBtn:document.getElementById("sttNewBtn"),statusBadge:document.getElementById("sttStatusBadge"),serverError:document.getElementById("sttServerError")},this.init()}async init(){await this.checkServer(),await this.loadModels(),this.setupEventListeners(),document.addEventListener("tab-changed",e=>{e.detail.tabId==="stt"&&this.loadModels()})}async checkServer(){try{let t=await(await fetch("/api/stt/health")).json();return this.isServerAvailable=t.available===!0,this.updateServerStatus(),this.isServerAvailable}catch{return this.isServerAvailable=!1,this.updateServerStatus(),!1}}startAutoReconnect(){this.reconnectInterval||(this.reconnectInterval=setInterval(async()=>{this.isServerAvailable?(clearInterval(this.reconnectInterval),this.reconnectInterval=null):await this.checkServer()&&(await this.loadModels(),clearInterval(this.reconnectInterval),this.reconnectInterval=null)},3e3))}async loadModels(){if(this.isServerAvailable)try{let t=await(await fetch("/api/stt/models")).json();this.availableModels=t.models||[];let{Storage:s}=await Promise.resolve().then(()=>(M(),pe)),n=await s.get("ultra-whisper-default-model","");this.populateModelSelect(n||t.default||"base")}catch(e){console.error("Failed to load models:",e)}}populateModelSelect(e){let t=this.elements.modelSelect;t&&(t.innerHTML="",this.availableModels.forEach(s=>{let n=document.createElement("option");n.value=s.id,n.textContent=`${s.name} - ${s.description}`,n.selected=s.id===e,t.appendChild(n)}))}updateServerStatus(){let e=this.elements.statusBadge,t=this.elements.serverError;this.isServerAvailable?(e.textContent="\u25CF Connect\xE9",e.classList.add("connected"),e.classList.remove("disconnected"),t.classList.add("hidden"),this.elements.dropZone.classList.remove("disabled")):(e.textContent="\u25CB D\xE9connect\xE9",e.classList.add("disconnected"),e.classList.remove("connected"),t.classList.remove("hidden"),this.elements.dropZone.classList.add("disabled"),this.startAutoReconnect())}setupEventListeners(){this.elements.dropZone.onclick=()=>{this.isServerAvailable&&this.elements.fileInput.click()},this.elements.fileInput.onchange=e=>{e.target.files[0]&&this.handleFile(e.target.files[0])},this.elements.dropZone.ondragover=e=>{e.preventDefault(),this.isServerAvailable&&this.elements.dropZone.classList.add("drag-over")},this.elements.dropZone.ondragleave=()=>{this.elements.dropZone.classList.remove("drag-over")},this.elements.dropZone.ondrop=e=>{e.preventDefault(),this.elements.dropZone.classList.remove("drag-over"),this.isServerAvailable&&e.dataTransfer.files.length&&this.handleFile(e.dataTransfer.files[0])},this.elements.removeBtn.onclick=()=>this.reset(),this.elements.transcribeBtn.onclick=()=>this.transcribe(),this.elements.newBtn.onclick=()=>this.reset(),this.elements.copyBtn.onclick=()=>this.copyResult(),this.elements.downloadBtn.onclick=()=>this.downloadResult(),document.getElementById("sttRetryBtn")?.addEventListener("click",()=>{this.checkServer().then(()=>this.loadModels())})}handleFile(e){let t=["audio/mpeg","audio/mp3","audio/wav","audio/x-wav","audio/m4a","audio/x-m4a","audio/mp4","audio/ogg","audio/flac","audio/webm","video/webm","video/mp4"],s=["mp3","wav","m4a","ogg","flac","webm","mp4"],n=e.name.split(".").pop().toLowerCase();if(!t.includes(e.type)&&!s.includes(n)){alert("\u274C Type de fichier non support\xE9. Utilisez MP3, WAV, M4A, OGG, FLAC ou WebM.");return}if(e.size>500*1024*1024){alert("\u274C Fichier trop volumineux. Maximum: 500MB");return}this.selectedFile=e,this.elements.dropZone.classList.add("hidden"),this.elements.fileInfo.classList.remove("hidden"),this.elements.resultContainer.classList.add("hidden"),this.elements.transcribeBtn.classList.remove("hidden"),this.elements.fileName.textContent=e.name,this.elements.fileSize.textContent=this.formatSize(e.size),this.getAudioDuration(e)}getAudioDuration(e){let t=new Audio;t.src=URL.createObjectURL(e),t.onloadedmetadata=()=>{let s=this.formatDuration(t.duration);this.elements.fileDuration.textContent=s,URL.revokeObjectURL(t.src)},t.onerror=()=>{this.elements.fileDuration.textContent="--:--"}}formatDuration(e){let t=Math.floor(e/60),s=Math.floor(e%60);return`${t}:${s.toString().padStart(2,"0")}`}async transcribe(){if(!this.selectedFile)return;let e=this.elements.modelSelect.value;this.elements.transcribeBtn.disabled=!0,this.elements.progressContainer.classList.remove("hidden"),this.elements.progressText.textContent=`Transcription avec le mod\xE8le ${e}...`,this.animateProgress(0,90,3e4);let t=new FormData;t.append("file",this.selectedFile),t.append("model",e);try{let s=await fetch("/api/stt/transcribe",{method:"POST",body:t});if(!s.ok){let i=await s.json();throw new Error(i.error||"Erreur lors de la transcription")}let n=await s.json();this.animateProgress(90,100,300),setTimeout(()=>{this.showResult(n),document.dispatchEvent(new CustomEvent("app-notification",{detail:{title:"Transcription termin\xE9e",message:`La transcription de ${this.selectedFile.name} est pr\xEAte.`,type:"success",icon:"mic"}}))},400)}catch(s){console.error("STT Error:",s),alert("\u{1F6A8} "+s.message),this.elements.progressContainer.classList.add("hidden"),this.elements.transcribeBtn.disabled=!1}}showResult(e){this.elements.fileInfo.classList.add("hidden"),this.elements.progressContainer.classList.add("hidden"),this.elements.transcribeBtn.classList.add("hidden"),this.elements.resultContainer.classList.remove("hidden"),this.elements.resultText.value=e.text||"",this.transcriptionResult=e}copyResult(){let e=this.elements.resultText.value;navigator.clipboard.writeText(e).then(()=>{let t=this.elements.copyBtn,s=t.innerHTML;t.innerHTML='<span class="btn-text">\u2713 Copi\xE9!</span>',setTimeout(()=>{t.innerHTML=s},2e3)})}downloadResult(){let e=this.elements.resultText.value,t=this.selectedFile?.name.replace(/\.[^.]+$/,"")||"transcription",s=new Blob([e],{type:"text/plain;charset=utf-8"}),n=URL.createObjectURL(s),i=document.createElement("a");i.href=n,i.download=`${t}.txt`,i.click(),URL.revokeObjectURL(n)}animateProgress(e,t,s){let n=Date.now(),i=()=>{let a=Date.now()-n,l=Math.min(a/s,1),o=e+(t-e)*this.easeOutQuad(l);this.elements.progressFill.style.width=`${o}%`,l<1&&requestAnimationFrame(i)};i()}easeOutQuad(e){return e*(2-e)}reset(){this.selectedFile=null,this.transcriptionResult=null,this.elements.dropZone.classList.remove("hidden"),this.elements.fileInfo.classList.add("hidden"),this.elements.resultContainer.classList.add("hidden"),this.elements.progressContainer.classList.add("hidden"),this.elements.transcribeBtn.classList.add("hidden"),this.elements.transcribeBtn.disabled=!1,this.elements.fileInput.value="",this.elements.progressFill.style.width="0%"}formatSize(e){if(e===0)return"0 B";let t=1024,s=["B","KB","MB","GB"],n=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,n)).toFixed(2))+" "+s[n]}}});var K,we=L(()=>{M();P();K=class{constructor(){this.themeToggle=document.getElementById("themeToggle"),this.reduceMotionToggle=document.getElementById("reduceMotionToggle"),this.compactSidebarToggle=document.getElementById("compactSidebarToggle"),this.sidebarSectionsToggle=document.getElementById("sidebarSectionsToggle"),this.soundToggle=document.getElementById("soundToggle"),this.clearCacheBtn=document.getElementById("clearCacheBtn"),this.accentPicker=document.getElementById("accentPicker"),this.accentDots=document.querySelectorAll(".accent-dot"),this.sidebarItemCheckboxes=document.querySelectorAll("[data-sidebar-item]"),this.settingsTabLinks=document.querySelectorAll(".settings-tab-link"),this.settingsTabPanes=document.querySelectorAll(".settings-tab-pane"),this.plexusSourceCount=document.getElementById("plexusSourceCount"),this.plexusExtraInfo=document.getElementById("plexusExtraInfo"),this.rembgModelToggles=document.querySelectorAll("#settingsRembgModelToggle .toggle-btn"),this.upscaleModelToggles=document.querySelectorAll("#settingsUpscaleModelToggle .toggle-btn"),this.upscaleScaleToggles=document.querySelectorAll("#settingsUpscaleScaleToggle .toggle-btn"),this.whisperModelToggles=document.querySelectorAll("#settingsWhisperModelToggle .toggle-btn"),this.languageToggles=document.querySelectorAll("#languageToggle .toggle-btn"),this.pinItemBtns=document.querySelectorAll(".pin-item-btn"),this.pinnedItemsContainer=document.getElementById("pinnedItemsContainer"),this.secUsername=document.getElementById("secUsername"),this.secCurrentPassword=document.getElementById("secCurrentPassword"),this.secNewPassword=document.getElementById("secNewPassword"),this.updatePasswordBtn=document.getElementById("updatePasswordBtn"),this.passwordUpdateMsg=document.getElementById("passwordUpdateMsg"),this.servicesStatusContainer=document.getElementById("servicesStatusContainer"),this.systemMetricsContainer=document.getElementById("systemMetricsContainer"),this.downloadedModelsContainer=document.getElementById("downloadedModelsContainer"),this.statusRefreshInterval=null,this.envOpenRouterKey=document.getElementById("envOpenRouterKey"),this.envOpenRouterModel=document.getElementById("envOpenRouterModel"),this.envSearxngUrl=document.getElementById("envSearxngUrl"),this.envRembgUrl=document.getElementById("envRembgUrl"),this.envWhisperUrl=document.getElementById("envWhisperUrl"),this.envUpscaleUrl=document.getElementById("envUpscaleUrl"),this.envOllamaUrl=document.getElementById("envOllamaUrl"),this.envOllamaModel=document.getElementById("envOllamaModel"),this.aiProviderToggles=document.querySelectorAll("#settingsAiProviderToggle .toggle-btn"),this.openRouterSection=document.getElementById("settingsOpenRouterSection"),this.ollamaSection=document.getElementById("settingsOllamaSection"),this.saveEnvSettingsBtn=document.getElementById("saveEnvSettingsBtn"),this.refreshLogsBtn=document.getElementById("refreshLogsBtn"),this.clearLogsBtn=document.getElementById("clearLogsBtn"),this.settingsLogsContainer=document.getElementById("settingsLogsContainer"),this.logsRefreshInterval=null,this.saveTimeout=null,this.init()}async init(){await m.migrate(),await this.loadSettings(),this.themeToggle&&this.themeToggle.addEventListener("change",()=>this.toggleTheme()),this.reduceMotionToggle&&this.reduceMotionToggle.addEventListener("change",()=>this.toggleReduceMotion()),this.compactSidebarToggle&&this.compactSidebarToggle.addEventListener("change",()=>this.toggleCompactSidebar()),this.sidebarSectionsToggle&&this.sidebarSectionsToggle.addEventListener("change",()=>this.toggleSidebarSections()),this.clearCacheBtn&&this.clearCacheBtn.addEventListener("click",()=>this.clearCache()),this.accentDots&&this.accentDots.forEach(t=>{t.addEventListener("click",()=>this.setAccentColor(t.dataset.color,t))}),this.sidebarItemCheckboxes&&this.sidebarItemCheckboxes.forEach(t=>{t.addEventListener("change",()=>this.toggleSidebarItem(t))}),this.settingsTabLinks&&this.settingsTabLinks.forEach(t=>{t.addEventListener("click",()=>this.switchSettingsTab(t.dataset.settingsTab))}),this.plexusSourceCount&&this.plexusSourceCount.addEventListener("input",()=>this.savePlexusSettings()),this.plexusExtraInfo&&this.plexusExtraInfo.addEventListener("input",()=>this.savePlexusSettings()),this.setupToggleGroupListeners(this.rembgModelToggles,"ultra-rembg-default-model"),this.setupToggleGroupListeners(this.upscaleModelToggles,"ultra-upscale-default-model"),this.setupToggleGroupListeners(this.upscaleScaleToggles,"ultra-upscale-default-scale"),this.setupToggleGroupListeners(this.whisperModelToggles,"ultra-whisper-default-model"),this.languageToggles&&this.languageToggles.forEach(t=>{t.addEventListener("click",()=>r.setLanguage(t.dataset.lang))}),this.pinItemBtns&&this.pinItemBtns.forEach(t=>{t.addEventListener("click",()=>this.togglePinItem(t))}),this.updatePasswordBtn&&this.updatePasswordBtn.addEventListener("click",()=>this.handlePasswordUpdate()),this.setupToggleGroupListeners(this.aiProviderToggles,"AI_PROVIDER","provider",t=>this.updateAiProviderVisibility(t)),[this.envOpenRouterKey,this.envOpenRouterModel,this.envSearxngUrl,this.envRembgUrl,this.envWhisperUrl,this.envUpscaleUrl,this.envOllamaUrl,this.envOllamaModel,this.plexusSourceCount,this.plexusExtraInfo].forEach(t=>{t&&t.addEventListener("input",()=>this.debouncedSaveIntelligence())}),this.refreshLogsBtn&&this.refreshLogsBtn.addEventListener("click",()=>this.refreshServerLogs()),this.clearLogsBtn&&this.clearLogsBtn.addEventListener("click",()=>this.clearServerLogs()),await this.updatePinnedSidebar()}async handlePasswordUpdate(){let e=this.secUsername.value,t=this.secCurrentPassword.value,s=this.secNewPassword.value;if(!e||!t||!s){this.showPasswordMsg(r.t("Tous les champs sont requis"),"error");return}this.updatePasswordBtn.disabled=!0,this.updatePasswordBtn.textContent=r.t("Mise \xE0 jour...");try{let n=await fetch("/api/auth/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,currentPassword:t,newPassword:s})}),i=await n.json();n.ok?(this.showPasswordMsg(i.message,"success"),this.secCurrentPassword.value="",this.secNewPassword.value=""):this.showPasswordMsg(i.error||r.t("Erreur lors de la mise \xE0 jour"),"error")}catch{this.showPasswordMsg(r.t("Erreur de connexion au serveur"),"error")}finally{this.updatePasswordBtn.disabled=!1,this.updatePasswordBtn.textContent="Mettre \xE0 jour le mot de passe"}}showPasswordMsg(e,t){this.passwordUpdateMsg.textContent=e,this.passwordUpdateMsg.style.display="block",this.passwordUpdateMsg.style.color=t==="error"?"var(--error)":"var(--success)",setTimeout(()=>{this.passwordUpdateMsg.style.display="none"},5e3)}async loadSettings(){let e=await m.get("ultra-theme","dark");document.documentElement.setAttribute("data-theme",e),this.themeToggle&&(this.themeToggle.checked=e==="dark");let t=await m.get("ultra-reduce-motion",!1);document.body.classList.toggle("reduce-motion",t),this.reduceMotionToggle&&(this.reduceMotionToggle.checked=t);let s=await m.get("ultra-compact-sidebar",!1);document.body.classList.toggle("compact-sidebar",s),this.compactSidebarToggle&&(this.compactSidebarToggle.checked=s);let n=await m.get("ultra-sidebar-sections",!0);document.body.classList.toggle("no-sidebar-sections",!n),this.sidebarSectionsToggle&&(this.sidebarSectionsToggle.checked=n);let i=await m.get("ultra-sound",!0);this.soundToggle&&(this.soundToggle.checked=i);let a=await m.get("ultra-accent-color","#ffffff");this.applyAccentColor(a);let l=await m.get("AI_PROVIDER","openrouter");this.aiProviderToggles.forEach(h=>{h.classList.toggle("active",h.dataset.provider===l)}),this.updateAiProviderVisibility(l),this.accentDots.forEach(h=>{h.classList.toggle("active",h.dataset.color===a)}),await this.loadSidebarItemsVisibility();let o=await m.get("ultra-plexus-source-count",3),d=await m.get("ultra-plexus-extra-info","");this.plexusSourceCount&&(this.plexusSourceCount.value=o),this.plexusExtraInfo&&(this.plexusExtraInfo.value=d),this.loadToggleGroupState(this.rembgModelToggles,"ultra-rembg-default-model","u2net"),this.loadToggleGroupState(this.upscaleModelToggles,"ultra-upscale-default-model","edsr"),this.loadToggleGroupState(this.upscaleScaleToggles,"ultra-upscale-default-scale","4"),this.loadToggleGroupState(this.whisperModelToggles,"ultra-whisper-default-model","base"),this.loadToggleGroupState(this.languageToggles,"ultra-language","en");let u=[{id:"envOpenRouterKey",key:"OPENROUTER_API_KEY"},{id:"envOpenRouterModel",key:"OPENROUTER_MODEL"},{id:"envSearxngUrl",key:"SEARXNG_URL"},{id:"envRembgUrl",key:"REMBG_URL"},{id:"envWhisperUrl",key:"WHISPER_URL"},{id:"envUpscaleUrl",key:"UPSCALE_URL"},{id:"envOllamaUrl",key:"OLLAMA_URL"},{id:"envOllamaModel",key:"OLLAMA_MODEL"}];for(let h of u){let g=document.getElementById(h.id);if(!g)continue;let E=await m.getFull(h.key);E.source==="env"?(g.value=E.effectiveValue||"",g.classList.add("using-env-fallback")):E.value&&(g.value=E.value,g.classList.remove("using-env-fallback"))}await this.loadToggleGroupState(this.aiProviderToggles,"AI_PROVIDER","openrouter","provider")}setupToggleGroupListeners(e,t,s="model",n=null){e.forEach(i=>{i.addEventListener("click",async()=>{e.forEach(l=>l.classList.remove("active")),i.classList.add("active");let a=i.dataset[s]||i.dataset.scale;await m.set(t,a),n&&n(a)})})}updateAiProviderVisibility(e){!this.openRouterSection||!this.ollamaSection||(e==="openrouter"?(this.openRouterSection.style.display="block",this.ollamaSection.style.display="none"):e==="ollama"&&(this.openRouterSection.style.display="none",this.ollamaSection.style.display="block"))}async loadToggleGroupState(e,t,s,n="model"){let i=await m.get(t,s);e.forEach(a=>{let l=a.dataset[n]||a.dataset.scale;a.classList.toggle("active",l===i.toString())})}switchSettingsTab(e){this.settingsTabLinks.forEach(t=>{t.classList.toggle("active",t.dataset.settingsTab===e)}),this.settingsTabPanes.forEach(t=>{t.classList.toggle("active",t.id===`settings-${e}`)}),e==="system"?(this.refreshServerStatus(),this.refreshServerLogs(),this.statusRefreshInterval||(this.statusRefreshInterval=setInterval(()=>this.refreshServerStatus(),5e3)),this.logsRefreshInterval||(this.logsRefreshInterval=setInterval(()=>this.refreshServerLogs(),3e3))):(this.statusRefreshInterval&&(clearInterval(this.statusRefreshInterval),this.statusRefreshInterval=null),this.logsRefreshInterval&&(clearInterval(this.logsRefreshInterval),this.logsRefreshInterval=null))}async refreshServerStatus(){try{let e=await fetch("/api/status/health");if(e.ok){let s=await e.json();this.renderServerStatus(s)}let t=await fetch("/api/status/models");if(t.ok){let s=await t.json();this.renderDownloadedModels(s.models)}}catch(e){console.error("Error fetching health status:",e)}}renderDownloadedModels(e){if(this.downloadedModelsContainer){if(!e||e.length===0){this.downloadedModelsContainer.innerHTML=`
                <div class="status-loading">
                    <i data-lucide="info" style="width: 24px; height: 24px; color: var(--text-muted);"></i>
                    ${r.t("Aucun mod\xE8le t\xE9l\xE9charg\xE9 trouv\xE9.")}
                </div>
            `,window.lucide&&window.lucide.createIcons();return}this.downloadedModelsContainer.innerHTML=`
            <div class="models-table-wrapper">
                <table class="models-table">
                    <thead>
                        <tr>
                            <th>${r.t("Mod\xE8le")}</th>
                            <th>${r.t("Type")}</th>
                            <th>${r.t("Taille")}</th>
                            <th>${r.t("Date")}</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${e.map(t=>`
                            <tr>
                                <td class="model-name-cell">
                                    <i data-lucide="file-code" class="model-icon"></i>
                                    <span>${t.name}</span>
                                </td>
                                <td><span class="model-tag">${t.type}</span></td>
                                <td class="model-size">${t.size}</td>
                                <td class="model-date">${new Date(t.date).toLocaleDateString()}</td>
                            </tr>
                        `).join("")}
                    </tbody>
                </table>
            </div>
        `,window.lucide&&window.lucide.createIcons()}}renderServerStatus(e){if(!this.servicesStatusContainer||!this.systemMetricsContainer||!e||!e.services)return;if(this.servicesStatusContainer.innerHTML=e.services.map(i=>`
            <div class="status-card">
                <div class="status-header">
                    <span class="service-name">${i.name}</span>
                    <span class="status-indicator ${i.status}">${i.status}</span>
                </div>
                <div class="status-details">
                    ${i.status==="online"?`
                        <div class="detail-row">
                            <span class="detail-label">${r.t("Service")}</span>
                            <span class="detail-value">${i.details?.service||"N/A"}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">${r.t("Status")}</span>
                            <span class="detail-value">${i.details?.status||"OK"}</span>
                        </div>
                    `:`
                        <div class="detail-row">
                            <span class="detail-label">${r.t("Erreur")}</span>
                            <span class="detail-value">${i.error||r.t("Inconnu")}</span>
                        </div>
                    `}
                </div>
            </div>
        `).join(""),!e.system||!e.system.memory){this.systemMetricsContainer.innerHTML=`<div class="status-loading">${r.t("Metrics non disponibles")}</div>`;return}let t=Math.round(e.system.memory.rss/1024/1024),s=Math.floor(e.system.uptime/3600),n=Math.floor(e.system.uptime%3600/60);this.systemMetricsContainer.innerHTML=`
            <div class="metric-box">
                <span class="metric-label">${r.t("Uptime")}</span>
                <span class="metric-value">${s}h ${n}m</span>
            </div>
            <div class="metric-box">
                <span class="metric-label">${r.t("M\xE9moire (RSS)")}</span>
                <span class="metric-value">${t} MB</span>
            </div>
            <div class="metric-box">
                <span class="metric-label">${r.t("Platform")}</span>
                <span class="metric-value">${e.system.platform||"N/A"}</span>
            </div>
            <div class="metric-box">
                <span class="metric-label">${r.t("Node JS")}</span>
                <span class="metric-value">${e.system.nodeVersion||"N/A"}</span>
            </div>
        `}async refreshServerLogs(){try{let e=await fetch("/api/status/logs");if(e.ok){let t=await e.json();this.renderServerLogs(t.logs)}}catch(e){console.error("Error fetching logs:",e)}}renderServerLogs(e){if(!this.settingsLogsContainer)return;if(!e||e.length===0){this.settingsLogsContainer.innerHTML=`<div class="log-placeholder">${r.t("Aucun log disponible.")}</div>`;return}let t=this.settingsLogsContainer.scrollHeight-this.settingsLogsContainer.scrollTop<=this.settingsLogsContainer.clientHeight+50;this.settingsLogsContainer.innerHTML=e.map(s=>`
            <div class="log-entry">
                <span class="log-time">[${s.time}]</span>
                <span class="log-type ${s.type}">${s.type}</span>
                <span class="log-message">${this.escapeHtml(s.message)}</span>
            </div>
        `).join(""),t&&(this.settingsLogsContainer.scrollTop=this.settingsLogsContainer.scrollHeight)}async clearServerLogs(){if(confirm(r.t("Voulez-vous vraiment effacer les logs du serveur ?")))try{(await fetch("/api/status/logs/clear",{method:"POST"})).ok&&this.renderServerLogs([])}catch(e){console.error("Error clearing logs:",e)}}escapeHtml(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}debouncedSaveIntelligence(){this.saveTimeout&&clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(()=>this.saveIntelligenceSettings(),500)}async saveIntelligenceSettings(){console.log("Auto-saving Intelligence settings...");try{let e={OPENROUTER_API_KEY:this.envOpenRouterKey?.value.trim(),OPENROUTER_MODEL:this.envOpenRouterModel?.value.trim(),SEARXNG_URL:this.envSearxngUrl?.value.trim(),REMBG_URL:this.envRembgUrl?.value.trim(),WHISPER_URL:this.envWhisperUrl?.value.trim(),UPSCALE_URL:this.envUpscaleUrl?.value.trim(),OLLAMA_URL:this.envOllamaUrl?.value.trim(),OLLAMA_MODEL:this.envOllamaModel?.value.trim(),"ultra-plexus-source-count":parseInt(this.plexusSourceCount?.value)||3,"ultra-plexus-extra-info":this.plexusExtraInfo?.value};for(let[t,s]of Object.entries(e))s!==void 0&&await m.set(t,s)}catch(e){console.error("Error auto-saving intelligence settings:",e)}}async loadSidebarItemsVisibility(){let e=await m.get("ultra-hidden-sidebar-items",[]);this.sidebarItemCheckboxes.forEach(t=>{let s=t.dataset.sidebarItem,n=e.includes(s);t.checked=!n,this.updateSidebarItemVisibility(s,!n)})}updateSidebarItemVisibility(e,t){let s=document.querySelector(`.nav-item[data-tab="${e}"]`);s&&(t?s.classList.remove("hidden-by-settings"):s.classList.add("hidden-by-settings"))}async toggleSidebarItem(e){let t=e.dataset.sidebarItem,s=e.checked;this.updateSidebarItemVisibility(t,s);let n=await m.get("ultra-hidden-sidebar-items",[]);if(s){let i=n.indexOf(t);i>-1&&n.splice(i,1)}else n.includes(t)||n.push(t);await m.set("ultra-hidden-sidebar-items",n),await this.updatePinnedSidebar()}async togglePinItem(e){let t=e.dataset.pinItem,s=await m.get("ultra-pinned-sidebar-items",[]),n=s.indexOf(t);n>-1?(s.splice(n,1),e.classList.remove("active")):(s.push(t),e.classList.add("active")),await m.set("ultra-pinned-sidebar-items",s),await this.updatePinnedSidebar()}async updatePinnedSidebar(){if(!this.pinnedItemsContainer)return;let e=await m.get("ultra-pinned-sidebar-items",[]),t=await m.get("ultra-hidden-sidebar-items",[]);this.pinItemBtns&&this.pinItemBtns.forEach(n=>{let i=n.dataset.pinItem;n.classList.toggle("active",e.includes(i))}),this.pinnedItemsContainer.innerHTML="";let s=e.filter(n=>!t.includes(n));if(s.length===0){this.pinnedItemsContainer.style.display="none";return}this.pinnedItemsContainer.style.display="flex",s.forEach(n=>{let i=document.querySelector(`.nav-section .nav-item[data-tab="${n}"]`);if(i){let a=i.querySelector(".nav-icon").innerHTML,l=i.querySelector(".nav-label").textContent,o=document.createElement("button");o.className="nav-item pinned-nav-item",o.dataset.tab=n,o.innerHTML=`
                    <span class="nav-icon">${a}</span>
                    <span class="nav-label">${l}</span>
                `,o.addEventListener("click",()=>{let d=new CustomEvent("switch-tab",{detail:{tab:n}});document.dispatchEvent(d)}),this.pinnedItemsContainer.appendChild(o)}}),window.lucide&&window.lucide.createIcons()}async toggleTheme(){let t=this.themeToggle.checked?"dark":"light";document.documentElement.setAttribute("data-theme",t),await m.set("ultra-theme",t)}async toggleReduceMotion(){let e=this.reduceMotionToggle.checked;document.body.classList.toggle("reduce-motion",e),await m.set("ultra-reduce-motion",e)}async toggleCompactSidebar(){let e=this.compactSidebarToggle.checked;document.body.classList.toggle("compact-sidebar",e),await m.set("ultra-compact-sidebar",e)}async toggleSidebarSections(){let e=this.sidebarSectionsToggle.checked;document.body.classList.toggle("no-sidebar-sections",!e),await m.set("ultra-sidebar-sections",e)}async setAccentColor(e,t){this.accentDots.forEach(s=>s.classList.remove("active")),t.classList.add("active"),this.applyAccentColor(e),await m.set("ultra-accent-color",e)}applyAccentColor(e){document.documentElement.style.setProperty("--accent",e),e==="#ffffff"?(document.documentElement.style.setProperty("--accent-hover","#f4f4f5"),document.documentElement.style.setProperty("--accent-dim","#27272a")):(document.documentElement.style.setProperty("--accent-hover",e+"ee"),document.documentElement.style.setProperty("--accent-dim",e+"22"))}async clearCache(){confirm(r.t("Voulez-vous vraiment vider le cache local ? Cela r\xE9initialisera \xE9galement vos r\xE9glages."))&&(localStorage.clear(),window.location.reload())}}});var be,Ie=L(()=>{be=()=>{let c=document.getElementById("chatForm"),e=document.getElementById("chatInput"),t=document.getElementById("chatMessages"),s=document.getElementById("pdfInput"),n=document.getElementById("pdfStatusText"),i=document.getElementById("pdfInfo"),a=document.getElementById("currentPdfName"),l=document.getElementById("currentPdfPages"),o=document.getElementById("removePdf"),d=document.getElementById("chatClearBtn"),u=document.querySelector(".model-badge"),h=[],g=null,E=async()=>{try{let S=await(await fetch("/api/chat/config")).json();if(S.model&&u){let I=S.model.split("/"),T=I[I.length-1].toUpperCase();u.textContent=T,u.title=S.model}}catch(v){console.error("Impossible de charger la config du chat",v)}},y=(v,S)=>{let I=document.createElement("div");I.className=`message ${v}`;let T=document.createElement("div");T.className="message-content",v!=="system"&&window.marked?T.innerHTML=marked.parse(S):T.textContent=S,I.appendChild(T),t.appendChild(I),t.scrollTop=t.scrollHeight},b=v=>{let S=document.querySelector(".typing-indicator");if(v&&!S){let I=document.createElement("div");I.className="typing-indicator",I.innerHTML='Ultra AI r\xE9fl\xE9chit <span class="dot"></span><span class="dot"></span><span class="dot"></span>',t.appendChild(I),t.scrollTop=t.scrollHeight}else!v&&S&&S.remove()};s.addEventListener("change",async v=>{let S=v.target.files[0];if(!S)return;n.textContent="Analyse en cours...";let I=new FormData;I.append("pdf",S);try{let T=await fetch("/api/chat/upload-pdf",{method:"POST",body:I});if(!T.ok)throw new Error("Erreur d'analyse");let R=await T.json();g=R.text,i.classList.remove("hidden"),a.textContent=R.filename,l.textContent=`${R.pages} pages`,n.textContent="PDF charg\xE9",y("system",`Document "${R.filename}" charg\xE9. Je peux maintenant r\xE9pondre \xE0 vos questions sur son contenu.`)}catch(T){console.error(T),n.textContent="Erreur de chargement",alert("Erreur lors de l'upload du PDF. Assurez-vous qu'il est valide.")}}),o.addEventListener("click",()=>{g=null,s.value="",i.classList.add("hidden"),n.textContent="Ajouter un PDF",y("system","Le contexte du document a \xE9t\xE9 retir\xE9.")});let w=async()=>{let v=e.value.trim();if(v){e.value="",e.style.height="auto",y("user",v),b(!0);try{let I=await(await fetch("/api/chat/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:v,history:h,context:g})})).json();b(!1),I.error?y("system",`Erreur: ${I.error}`):(y("ai",I.reply),h=I.history)}catch(S){b(!1),y("system","Erreur de connexion avec le serveur."),console.error(S)}}};c.addEventListener("submit",v=>{v.preventDefault(),w()}),e.addEventListener("keydown",v=>{v.key==="Enter"&&!v.shiftKey&&(v.preventDefault(),w())}),e.addEventListener("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"}),d.addEventListener("click",()=>{confirm("Voulez-vous vraiment effacer l'historique de la conversation ?")&&(h=[],t.innerHTML=`
                <div class="message system">
                    <div class="message-content">
                        Historique effac\xE9. Je suis pr\xEAt pour une nouvelle discussion !
                    </div>
                </div>
            `)}),E()}});function Ee(){ze(),We(),je(),Ge(),Oe(),Ve()}function Oe(){let c=document.getElementById("cur-from-val"),e=document.getElementById("cur-to-val"),t=document.getElementById("cur-from-type"),s=document.getElementById("cur-to-type"),n=document.getElementById("cur-swap"),i=document.getElementById("cur-rate-info");if(!c)return;let a=async()=>{let o=parseFloat(c.value);if(isNaN(o)||o<=0){e.value="";return}let d=t.value,u=s.value;if(d===u){e.value=o.toFixed(2),i.textContent=`1 ${d} = 1.00 ${u}`;return}try{i.textContent="Mise \xE0 jour du taux...";let g=await(await fetch(`https://api.frankfurter.app/latest?amount=${o}&from=${d}&to=${u}`)).json();if(g.rates&&g.rates[u]){let E=g.rates[u];e.value=E.toFixed(2);let y=E/o;i.textContent=`1 ${d} = ${y.toFixed(4)} ${u}`}}catch(h){console.error("Currency API error:",h),i.textContent="Erreur lors de la r\xE9cup\xE9ration du taux"}},l=null;c.addEventListener("input",()=>{clearTimeout(l),l=setTimeout(a,500)}),[t,s].forEach(o=>o.addEventListener("change",a)),n.addEventListener("click",()=>{let o=t.value;t.value=s.value,s.value=o,a()}),a()}function ze(){let c=document.getElementById("qr-input"),e=document.getElementById("qrcode-result"),t=document.getElementById("qr-download");if(!c||!e)return;let s=null;c.addEventListener("input",()=>{clearTimeout(s);let n=c.value.trim();if(!n){e.innerHTML='<p style="color: var(--text-muted); font-size: 12px;">Votre QR code appara\xEEtra ici</p>',t.classList.add("hidden");return}s=setTimeout(()=>{e.innerHTML="",QRCode.toCanvas(n,{width:200,margin:2,color:{dark:"#000000",light:"#ffffff"}},(i,a)=>{if(i){console.error(i),e.innerHTML='<p style="color: #ef4444; font-size: 12px;">Erreur de g\xE9n\xE9ration</p>';return}e.appendChild(a),t.classList.remove("hidden")})},300)}),t.addEventListener("click",()=>{let n=e.querySelector("canvas");if(!n)return;let i=document.createElement("a");i.download="qrcode.png",i.href=n.toDataURL(),i.click()})}function We(){let c=document.getElementById("pass-length"),e=document.getElementById("pass-length-val"),t=document.getElementById("pass-result"),s=document.getElementById("pass-gen"),n=document.getElementById("pass-copy"),i=document.getElementById("pass-upper"),a=document.getElementById("pass-lower"),l=document.getElementById("pass-num"),o=document.getElementById("pass-sym");if(!c||!s)return;c.addEventListener("input",()=>{e.textContent=c.value});let d=()=>{let u=parseInt(c.value),h={upper:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",lower:"abcdefghijklmnopqrstuvwxyz",num:"0123456789",sym:"!@#$%^&*()_+~`|}{[]:;?><,./-="},g="";i.checked&&(g+=h.upper),a.checked&&(g+=h.lower),l.checked&&(g+=h.num),o.checked&&(g+=h.sym),g||(g=h.lower);let E="";for(let y=0;y<u;y++)E+=g.charAt(Math.floor(Math.random()*g.length));t.textContent=E};s.addEventListener("click",d),n.addEventListener("click",()=>{let u=t.textContent;u!=="********"&&navigator.clipboard.writeText(u).then(()=>{let h=n.innerHTML;n.innerHTML='<i data-lucide="check" style="width: 16px; height: 16px; color: var(--success);"></i>',window.lucide&&window.lucide.createIcons(),setTimeout(()=>{n.innerHTML=h,window.lucide&&window.lucide.createIcons()},2e3)})})}function je(){let c=document.getElementById("text-input"),e=document.getElementById("text-count-chars"),t=document.getElementById("text-count-words"),s=document.querySelectorAll("[data-action]");c&&(c.addEventListener("input",()=>{let n=c.value;e.textContent=`${n.length} caract\xE8res`;let i=n.trim()?n.trim().split(/\s+/).length:0;t.textContent=`${i} mots`}),s.forEach(n=>{n.closest(".tool-card").querySelector(".tool-title").textContent==="Outils Texte"&&n.addEventListener("click",()=>{let i=n.dataset.action,a=c.value;switch(i){case"upper":a=a.toUpperCase();break;case"lower":a=a.toLowerCase();break;case"title":a=a.toLowerCase().split(" ").map(l=>l.charAt(0).toUpperCase()+l.substring(1)).join(" ");break;case"clean":a=a.trim().replace(/\s+/g," ");break}c.value=a,c.dispatchEvent(new Event("input"))})}))}function Ge(){let c=document.getElementById("unit-from-val"),e=document.getElementById("unit-to-val"),t=document.getElementById("unit-type"),s=document.getElementById("unit-swap");if(!c||!e)return;let n=()=>{let i=parseFloat(c.value);if(isNaN(i)){e.value="";return}let a=t.value,l;switch(a){case"length":l=i*3.28084;break;case"weight":l=i*2.20462;break;case"temp":l=i*9/5+32;break}e.value=l.toFixed(2)};c.addEventListener("input",n),t.addEventListener("change",n),s.addEventListener("click",()=>{let i=t.value,a=parseFloat(c.value);e.value&&(c.value=e.value,n())})}function Ve(){let c=document.getElementById("mirrorVideo"),e=document.getElementById("mirrorCanvas"),t=document.getElementById("mirrorPlaceholder"),s=document.getElementById("mirrorToggle"),n=document.getElementById("mirrorCapture"),i=document.getElementById("mirrorDownload"),a=document.getElementById("mirrorDeviceSelect");if(!c||!s)return;let l=null,o=!1,d=[];async function u(){try{d=(await navigator.mediaDevices.enumerateDevices()).filter(v=>v.kind==="videoinput"),d.length>1&&(a.innerHTML='<option value="">S\xE9lectionner une cam\xE9ra...</option>',d.forEach((v,S)=>{let I=document.createElement("option");I.value=v.deviceId,I.textContent=v.label||`Cam\xE9ra ${S+1}`,a.appendChild(I)}),a.style.display="block")}catch(w){console.error("Error enumerating devices:",w)}}async function h(w=null){try{let v={video:w?{deviceId:{exact:w}}:!0,audio:!1};l=await navigator.mediaDevices.getUserMedia(v),c.srcObject=l,c.style.display="block",t.style.display="none",n.style.display="block",s.innerHTML='<i data-lucide="video-off" style="width: 14px; height: 14px;"></i> D\xE9sactiver',window.lucide&&window.lucide.createIcons(),o=!0,await u()}catch(v){console.error("Error accessing webcam:",v),alert("Impossible d'acc\xE9der \xE0 la webcam. V\xE9rifiez les permissions.")}}function g(){l&&(l.getTracks().forEach(w=>w.stop()),l=null),c.style.display="none",e.style.display="none",t.style.display="flex",n.style.display="none",i.style.display="none",s.innerHTML='<i data-lucide="video" style="width: 14px; height: 14px;"></i> Activer',window.lucide&&window.lucide.createIcons(),o=!1}function E(){if(!o)return;let w=e.getContext("2d");e.width=c.videoWidth,e.height=c.videoHeight,w.drawImage(c,0,0,e.width,e.height),c.style.display="none",e.style.display="block",i.style.display="block",n.innerHTML='<i data-lucide="rotate-ccw" style="width: 14px; height: 14px;"></i> Retour',window.lucide&&window.lucide.createIcons()}function y(){c.style.display="block",e.style.display="none",i.style.display="none",n.innerHTML='<i data-lucide="camera" style="width: 14px; height: 14px;"></i> Capturer',window.lucide&&window.lucide.createIcons()}function b(){let w=document.createElement("a"),v=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);w.download=`webcam-capture-${v}.png`,w.href=e.toDataURL("image/png"),w.click()}s.addEventListener("click",()=>{o?g():h()}),n.addEventListener("click",()=>{e.style.display==="block"?y():E()}),i.addEventListener("click",b),a.addEventListener("change",w=>{w.target.value&&o&&(g(),h(w.target.value))})}var Se=L(()=>{});var X,Le=L(()=>{P();X=class{constructor(){this.currentNoteId=null,this.notes=[],this.autoSaveTimeout=null,this.isPreviewMode=!1,this.init()}init(){document.getElementById("tab-notes")&&(this.loadNotes(),this.setupEventListeners(),this.setupMarkdownToolbar(),this.setupAutoSave(),this.setupAI(),this.syncWithDatabank(),document.addEventListener("databank-item-deleted",e=>{this.handleExternalDeletion(e.detail.id)}))}setupEventListeners(){document.getElementById("newNoteBtn")?.addEventListener("click",()=>this.createNewNote()),document.getElementById("newNoteWelcomeBtn")?.addEventListener("click",()=>this.createNewNote()),document.getElementById("togglePreviewBtn")?.addEventListener("click",()=>this.togglePreview()),document.getElementById("exportNoteBtn")?.addEventListener("click",()=>this.exportNoteToDatabank()),document.getElementById("deleteNoteBtn")?.addEventListener("click",()=>this.deleteCurrentNote());let e=document.getElementById("noteTitleInput"),t=document.getElementById("noteContentEditor"),s=document.getElementById("noteTagsInput");e?.addEventListener("input",()=>{this.updateStats(),this.scheduleAutoSave()}),t?.addEventListener("input",()=>{this.isPreviewMode&&this.updatePreview(),this.updateStats(),this.scheduleAutoSave()}),s?.addEventListener("input",()=>this.scheduleAutoSave()),document.getElementById("notesSearchInput")?.addEventListener("input",n=>{this.filterNotes(n.target.value)}),t?.addEventListener("keydown",n=>this.handleKeyboardShortcuts(n))}loadNotes(){let e=localStorage.getItem("ultra_notes");this.notes=e?JSON.parse(e):[],this.renderNotesList()}saveNotesToStorage(){localStorage.setItem("ultra_notes",JSON.stringify(this.notes))}createNewNote(){let e={id:Date.now().toString(),title:r.t("Nouvelle note"),content:"",tags:[],createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};this.notes.unshift(e),this.saveNotesToStorage(),this.renderNotesList(),this.openNote(e.id)}openNote(e){let t=this.notes.find(s=>s.id===e);t&&(this.currentNoteId=e,document.getElementById("notesWelcome").style.display="none",document.getElementById("notesEditorContainer").style.display="flex",document.getElementById("noteTitleInput").value=t.title,document.getElementById("noteContentEditor").value=t.content,document.getElementById("noteTagsInput").value=t.tags.join(", "),this.updateStats(),this.updateActiveNoteInList(),this.isPreviewMode&&this.togglePreview())}saveCurrentNote(){if(!this.currentNoteId)return;let e=this.notes.find(t=>t.id===this.currentNoteId);e&&(e.title=document.getElementById("noteTitleInput").value||r.t("Sans titre"),e.content=document.getElementById("noteContentEditor").value,e.tags=document.getElementById("noteTagsInput").value.split(",").map(t=>t.trim()).filter(t=>t),e.updatedAt=new Date().toISOString(),this.saveNotesToStorage(),this.renderNotesList(),this.updateActiveNoteInList(),this.showSaveStatus("saved"),e.databankId&&this.exportNoteToDatabank(!0))}async deleteCurrentNote(){if(!this.currentNoteId||!confirm(r.t("\xCAtes-vous s\xFBr de vouloir supprimer cette note ?")))return;let e=this.notes.find(t=>t.id===this.currentNoteId);if(e&&e.databankId)try{await fetch(`/api/databank/${e.databankId}`,{method:"DELETE"})}catch(t){console.warn("Impossible de supprimer la note de la Databank:",t)}this.notes=this.notes.filter(t=>t.id!==this.currentNoteId),this.saveNotesToStorage(),this.renderNotesList(),this.currentNoteId=null,document.getElementById("notesWelcome").style.display="flex",document.getElementById("notesEditorContainer").style.display="none",this.showNotification(r.t("Note supprim\xE9e"),"success")}renderNotesList(){let e=document.getElementById("notesList");if(e){if(this.notes.length===0){e.innerHTML=`
                <div class="notes-empty">
                    <i data-lucide="file-text" class="notes-empty-icon"></i>
                    <p>${r.t("Aucune note")}</p>
                    <p class="notes-empty-hint">${r.t("Cr\xE9ez votre premi\xE8re note")}</p>
                </div>
            `,window.lucide&&window.lucide.createIcons();return}e.innerHTML=this.notes.map(t=>`
            <div class="note-item ${t.id===this.currentNoteId?"active":""}" data-note-id="${t.id}">
                <div class="note-item-header">
                    <h4 class="note-item-title">${this.escapeHtml(t.title)}</h4>
                    <span class="note-item-date">${this.formatDate(t.updatedAt)}</span>
                </div>
                <p class="note-item-preview">${this.escapeHtml(t.content.substring(0,100))}</p>
                ${t.tags.length>0?`
                    <div class="note-item-tags">
                        ${t.tags.map(s=>`<span class="note-tag">${this.escapeHtml(s)}</span>`).join("")}
                    </div>
                `:""}
            </div>
        `).join(""),e.querySelectorAll(".note-item").forEach(t=>{t.addEventListener("click",()=>{this.openNote(t.dataset.noteId)})}),window.lucide&&window.lucide.createIcons()}}updateActiveNoteInList(){document.querySelectorAll(".note-item").forEach(e=>{e.classList.toggle("active",e.dataset.noteId===this.currentNoteId)})}filterNotes(e){let t=e.toLowerCase();document.querySelectorAll(".note-item").forEach(s=>{let n=s.dataset.noteId,i=this.notes.find(l=>l.id===n),a=i.title.toLowerCase().includes(t)||i.content.toLowerCase().includes(t)||i.tags.some(l=>l.toLowerCase().includes(t));s.style.display=a?"block":"none"})}setupMarkdownToolbar(){document.querySelectorAll(".toolbar-btn").forEach(e=>{e.addEventListener("click",()=>{let t=e.dataset.action;this.applyMarkdownFormat(t)})})}applyMarkdownFormat(e){let t=document.getElementById("noteContentEditor");if(!t)return;let s=t.selectionStart,n=t.selectionEnd,i=t.value.substring(s,n),a=t.value.substring(0,s),l=t.value.substring(n),o="",d=0;switch(e){case"bold":o=`**${i||r.t("texte en gras")}**`,d=i?o.length:2;break;case"italic":o=`*${i||r.t("texte en italique")}*`,d=i?o.length:1;break;case"strikethrough":o=`~~${i||r.t("texte barr\xE9")}~~`,d=i?o.length:2;break;case"heading":o=`## ${i||r.t("Titre")}`,d=o.length;break;case"quote":o=`> ${i||r.t("Citation")}`,d=o.length;break;case"code":i.includes(`
`)?(o=`\`\`\`
${i||r.t("code")}
\`\`\``,d=i?o.length-4:4):(o=`\`${i||r.t("code")}\``,d=i?o.length:1);break;case"list-ul":o=`- ${i||r.t("\xC9l\xE9ment de liste")}`,d=o.length;break;case"list-ol":o=`1. ${i||r.t("\xC9l\xE9ment de liste")}`,d=o.length;break;case"checkbox":o=`- [ ] ${i||r.t("T\xE2che")}`,d=o.length;break;case"link":o=`[${i||r.t("texte du lien")}](url)`,d=i?o.length-5:o.length-4;break;case"image":o=`![${i||r.t("description")}](url)`,d=i?o.length-5:o.length-4;break;case"table":o=`| ${r.t("Colonnes")} 1 | ${r.t("Colonnes")} 2 |
|-----------|-----------|  
| A         | B         |`,d=o.length;break;default:return}t.value=a+o+l,t.focus(),t.setSelectionRange(s+d,s+d),this.updateStats(),this.scheduleAutoSave(),this.isPreviewMode&&this.updatePreview()}handleKeyboardShortcuts(e){if(e.ctrlKey||e.metaKey)switch(e.key.toLowerCase()){case"b":e.preventDefault(),this.applyMarkdownFormat("bold");break;case"i":e.preventDefault(),this.applyMarkdownFormat("italic");break;case"s":e.preventDefault(),this.saveCurrentNote();break}}togglePreview(){this.isPreviewMode=!this.isPreviewMode;let e=document.getElementById("noteContentEditor"),t=document.getElementById("noteContentPreview"),s=document.getElementById("togglePreviewBtn");this.isPreviewMode?(e.style.display="none",t.style.display="block",this.updatePreview(),s.innerHTML='<i data-lucide="edit"></i>'):(e.style.display="block",t.style.display="none",s.innerHTML='<i data-lucide="eye"></i>'),window.lucide&&window.lucide.createIcons()}updatePreview(){let e=document.getElementById("noteContentEditor").value,t=document.getElementById("noteContentPreview");t.innerHTML=this.markdownToHtml(e)}markdownToHtml(e){let t=e;return t=t.replace(/^### (.*$)/gim,"<h3>$1</h3>"),t=t.replace(/^## (.*$)/gim,"<h2>$1</h2>"),t=t.replace(/^# (.*$)/gim,"<h1>$1</h1>"),t=t.replace(/\*\*(.*?)\*\*/gim,"<strong>$1</strong>"),t=t.replace(/\*(.*?)\*/gim,"<em>$1</em>"),t=t.replace(/~~(.*?)~~/gim,"<del>$1</del>"),t=t.replace(/```([\s\S]*?)```/gim,"<pre><code>$1</code></pre>"),t=t.replace(/`([^`]+)`/gim,"<code>$1</code>"),t=t.replace(/\[([^\]]+)\]\(([^)]+)\)/gim,'<a href="$2" target="_blank">$1</a>'),t=t.replace(/!\[([^\]]*)\]\(([^)]+)\)/gim,'<img src="$2" alt="$1">'),t=t.replace(/^> (.*$)/gim,"<blockquote>$1</blockquote>"),t=t.replace(/^\* (.*$)/gim,"<li>$1</li>"),t=t.replace(/^\d+\. (.*$)/gim,"<li>$1</li>"),t=t.replace(/(<li>.*<\/li>)/s,"<ul>$1</ul>"),t=t.replace(/\n\n/g,"</p><p>"),t="<p>"+t+"</p>",t=t.replace(/\n/g,"<br>"),t}setupAutoSave(){setInterval(()=>{this.currentNoteId&&this.saveCurrentNote()},3e4)}scheduleAutoSave(){this.showSaveStatus("saving"),this.autoSaveTimeout&&clearTimeout(this.autoSaveTimeout),this.autoSaveTimeout=setTimeout(()=>{this.saveCurrentNote()},2e3)}showSaveStatus(e){let t=document.getElementById("noteSaveStatus");if(t){switch(t.className="note-save-status",e){case"saving":t.classList.add("saving"),t.innerHTML=`<i data-lucide="loader"></i><span>${r.t("Sauvegarde...")}</span>`;break;case"saved":t.innerHTML=`<i data-lucide="check-circle"></i><span>${r.t("Sauvegard\xE9")}</span>`,this.updateLastSavedTime();break;case"error":t.classList.add("error"),t.innerHTML=`<i data-lucide="alert-circle"></i><span>${r.t("Erreur")}</span>`;break}window.lucide&&window.lucide.createIcons()}}updateStats(){let e=document.getElementById("noteContentEditor").value,t=e.trim()?e.trim().split(/\s+/).length:0,s=e.length;document.getElementById("noteWordCount").textContent=`${t} ${t>1?r.t("mots"):r.t("mot")}`,document.getElementById("noteCharCount").textContent=`${s} ${s>1?r.t("caract\xE8res"):r.t("caract\xE8re")}`}updateLastSavedTime(){let t=new Date().toLocaleTimeString(document.documentElement.lang==="fr"?"fr-FR":"en-US",{hour:"2-digit",minute:"2-digit"});document.getElementById("noteLastSaved").textContent=`${r.t("Sauvegard\xE9 \xE0")} ${t}`}async exportNoteToDatabank(e=!1){if(!this.currentNoteId)return;let t=this.notes.find(s=>s.id===this.currentNoteId);if(t)try{let s=`# ${t.title}

${t.content}`;t.databankId&&t.databankId&&await fetch(`/api/databank/${t.databankId}`,{method:"DELETE"});let n=new Blob([s],{type:"text/markdown"}),i=`${t.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.md`,a=new FormData;a.append("file",n,i);let l=await fetch("/api/databank/upload",{method:"POST",body:a});if(l.ok){let o=await l.json();t.databankId=o.id,this.saveNotesToStorage(),e||this.showNotification(r.t("Note synchronis\xE9e avec la Databank"),"success")}else throw new Error(r.t("Erreur lors de l'export"))}catch(s){console.error("Export error:",s),this.showNotification(s.message,"error")}}async syncWithDatabank(){let e=this.notes.filter(s=>s.databankId);if(e.length===0)return;let t=e.map(s=>s.databankId);try{let s=await fetch("/api/databank/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:t})});if(s.ok){let n=await s.json(),i=new Set(n.validIds),a=!1;e.forEach(l=>{i.has(l.databankId)||(console.log(`Note ${l.id} removed locally because Databank item ${l.databankId} is missing.`),this.notes=this.notes.filter(o=>o.id!==l.id),this.currentNoteId===l.id&&(this.currentNoteId=null,document.getElementById("notesWelcome").style.display="flex",document.getElementById("notesEditorContainer").style.display="none"),a=!0)}),a&&(this.saveNotesToStorage(),this.renderNotesList(),this.showNotification(r.t("Notes synchronis\xE9es avec la Databank (suppressions d\xE9tect\xE9es)"),"info"))}}catch(s){console.error("Error syncing with databank:",s)}}handleExternalDeletion(e){if(!e)return;let t=this.notes.find(s=>s.databankId===e);t&&(this.notes=this.notes.filter(s=>s.id!==t.id),this.currentNoteId===t.id&&(this.currentNoteId=null,document.getElementById("notesWelcome").style.display="flex",document.getElementById("notesEditorContainer").style.display="none"),this.saveNotesToStorage(),this.renderNotesList(),this.showNotification(r.t("Note supprim\xE9e car l'\xE9l\xE9ment Databank correspondant a \xE9t\xE9 effac\xE9."),"info"))}escapeHtml(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}formatDate(e){let t=new Date(e),n=new Date-t,i=Math.floor(n/(1e3*60*60*24));if(i===0){let a=Math.floor(n/36e5);if(a===0){let l=Math.floor(n/6e4);return l===0?r.t("\xC0 l'instant"):`${r.t("Il y a")} ${l}min`}return`${r.t("Il y a")} ${a}h`}else return i===1?r.t("Hier"):i<7?`${r.t("Il y a")} ${i}j`:t.toLocaleDateString(document.documentElement.lang==="fr"?"fr-FR":"en-US",{day:"2-digit",month:"2-digit"})}showNotification(e,t="info"){let s=new CustomEvent("app-notification",{detail:{title:t==="error"?r.t("Erreur"):t==="success"?r.t("Succ\xE8s"):"Info",message:e,type:t}});document.dispatchEvent(s)}setupAI(){this.lastAIAction=null,this.lastAIResult=null,document.getElementById("notesAiBtn")?.addEventListener("click",()=>this.openAIModal()),document.getElementById("closeAiModalBtn")?.addEventListener("click",()=>this.closeAIModal()),document.getElementById("notesAiModal")?.addEventListener("click",e=>{e.target.classList.contains("ai-modal-overlay")&&this.closeAIModal()}),document.querySelectorAll(".ai-action-btn").forEach(e=>{e.addEventListener("click",()=>{let t=e.dataset.action;this.handleAIAction(t)})}),document.getElementById("aiRetryBtn")?.addEventListener("click",()=>{this.lastAIAction&&this.handleAIAction(this.lastAIAction)}),document.getElementById("aiApplyBtn")?.addEventListener("click",()=>{this.applyAIResult()})}openAIModal(){let e=document.getElementById("notesAiModal"),t=document.getElementById("aiActionsList"),s=document.getElementById("aiProcessing"),n=document.getElementById("aiResult");t.style.display="grid",s.style.display="none",n.style.display="none",e.style.display="flex"}closeAIModal(){document.getElementById("notesAiModal").style.display="none"}async handleAIAction(e){if(!this.currentNoteId)return;let t=document.getElementById("noteContentEditor"),s=t.value,n=t.selectionStart,i=t.selectionEnd,l=s.substring(n,i).trim()||s.trim();if(!l){this.showNotification(r.t("Veuillez \xE9crire ou s\xE9lectionner du texte d'abord"),"info");return}this.lastAIAction=e,document.getElementById("aiActionsList").style.display="none",document.getElementById("aiResult").style.display="none",document.getElementById("aiProcessing").style.display="flex";let o="",d=r.t("Tu es un assistant d'\xE9criture expert. R\xE9ponds uniquement avec le contenu demand\xE9, sans bavardage.");switch(e){case"summarize":o=`${r.t("Fais un r\xE9sum\xE9 concis du texte suivant :")}

"${l}"`;break;case"fix":o=`${r.t("Corrige les fautes d'orthographe et de grammaire du texte suivant. Conserve le formatage Markdown. Renvoie uniquement le texte corrig\xE9 :")}

"${l}"`;break;case"continue":o=`${r.t("Continue la r\xE9daction du texte suivant de mani\xE8re coh\xE9rente et cr\xE9ative :")}

"${l}"`;break;case"ideas":o=`${r.t("Donne-moi 5 id\xE9es ou points cl\xE9s pertinents bas\xE9s sur le texte suivant :")}

"${l}"`;break}try{let u=await fetch("/api/chat/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:o,history:[],systemPrompt:d})});if(!u.ok)throw new Error(r.t("Erreur lors de la communication avec l'IA"));let h=await u.json();this.lastAIResult=h.reply,document.getElementById("aiProcessing").style.display="none",document.getElementById("aiResult").style.display="flex";let g=document.getElementById("aiResultContent");g.innerHTML=this.lastAIResult}catch(u){console.error(u),this.showNotification(r.t("Erreur lors de la g\xE9n\xE9ration IA"),"error"),this.closeAIModal()}}applyAIResult(){if(!this.lastAIResult)return;let e=document.getElementById("noteContentEditor"),t=e.selectionStart,s=e.selectionEnd,n=e.value,i=n.substring(0,t),a=n.substring(s),l=i+this.lastAIResult+a;e.value=l,this.updateStats(),this.scheduleAutoSave(),this.isPreviewMode&&this.updatePreview(),this.closeAIModal(),this.showNotification(r.t("Contenu ins\xE9r\xE9 avec succ\xE8s"),"success")}}});var ee,Te=L(()=>{_();ee=class{constructor(){this.dom={tab:document.getElementById("tab-torrent"),status:document.getElementById("torrentConnectionStatus"),loginOverlay:document.getElementById("torrentLoginOverlay"),user:document.getElementById("qbitUser"),pass:document.getElementById("qbitPass"),loginBtn:document.getElementById("qbitLoginBtn"),listBody:document.getElementById("torrentListBody"),addBtn:document.getElementById("torrentAddBtn"),magnetBtn:document.getElementById("torrentMagnetBtn"),fileInput:document.getElementById("torrentFileInput"),addModal:document.getElementById("addTorrentModal"),addOverlay:document.getElementById("addTorrentOverlay"),closeAddModal:document.getElementById("closeAddModal"),magnetInput:document.getElementById("magnetInput"),submitAdd:document.getElementById("submitAddTorrent"),pasteBtn:document.getElementById("pasteMagnetBtn"),totalDl:document.getElementById("totalDlSpeed"),totalUl:document.getElementById("totalUlSpeed"),pauseAll:document.getElementById("torrentPauseAllBtn"),resumeAll:document.getElementById("torrentResumeAllBtn")},this.pollingInterval=null,this.cache=new Map,this.completedTorrents=new Set,this.init()}init(){this.dom.tab&&(this.dom.loginBtn.addEventListener("click",()=>this.login()),this.dom.addBtn.addEventListener("click",()=>this.dom.fileInput.click()),this.dom.fileInput.addEventListener("change",e=>this.handleFileSelect(e)),this.dom.magnetBtn.addEventListener("click",()=>this.showAddModal()),this.dom.closeAddModal.addEventListener("click",()=>this.hideAddModal()),this.dom.addOverlay.addEventListener("click",()=>this.hideAddModal()),this.dom.submitAdd.addEventListener("click",()=>this.addTorrent()),this.dom.pasteBtn.addEventListener("click",async()=>{try{let e=await navigator.clipboard.readText();this.dom.magnetInput.value=e}catch(e){console.error("Failed to read clipboard",e)}}),this.dom.pauseAll.addEventListener("click",()=>this.globalAction("pause")),this.dom.resumeAll.addEventListener("click",()=>this.globalAction("resume")),this.startPolling())}startPolling(){this.pollingInterval=setInterval(()=>{this.dom.tab.classList.contains("active")&&this.fetchData()},2e3),setTimeout(()=>{this.dom.tab.classList.contains("active")&&this.fetchData()},500)}async login(){try{let e=this.dom.user.value,t=this.dom.pass.value;(await(await fetch("/api/torrent/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})})).json()).success?(this.dom.loginOverlay.classList.add("hidden"),this.fetchData()):alert("Login failed")}catch(e){console.error(e),alert("Login error")}}async fetchData(){try{let e=await fetch("/api/torrent/list");if(e.status===403||e.status===401){this.dom.loginOverlay.classList.remove("hidden"),this.updateStatus(!1);return}let t=await e.json();this.dom.loginOverlay.classList.add("hidden"),this.updateStatus(!0),this.render(t)}catch(e){console.error("Fetch error:",e),this.updateStatus(!1)}}updateStatus(e){e?(this.dom.status.innerHTML='<i data-lucide="check-circle" class="status-icon"></i> CONNECT\xC9',this.dom.status.className="status-badge connected"):(this.dom.status.innerHTML='<i data-lucide="power" class="status-icon"></i> D\xC9CONNECT\xC9',this.dom.status.className="status-badge disconnected"),A()}visibleTorrents=new Set;render(e){if(!Array.isArray(e)){console.error("Expected array of torrents, got:",e);return}let t=0,s=0,n=new Set;e.forEach(i=>{t+=i.dlspeed,s+=i.upspeed,n.add(i.hash);let a=this.cache.get(i.hash);a||(a=this.createRow(i),this.dom.listBody.appendChild(a),this.cache.set(i.hash,a)),this.updateRow(a,i),i.progress===1&&!this.completedTorrents.has(i.hash)&&(this.completedTorrents.add(i.hash),document.dispatchEvent(new CustomEvent("app-notification",{detail:{title:"Torrent termin\xE9",message:`Le t\xE9l\xE9chargement de "${i.name}" est fini.`,type:"success",icon:"package"}})))});for(let[i,a]of this.cache)n.has(i)||(a.remove(),this.cache.delete(i));this.dom.totalDl.textContent=D(t),this.dom.totalUl.textContent=D(s),A()}createRow(e){let t=document.createElement("div");return t.className="torrent-item",t.innerHTML=`
            <div class="torrent-icon"><i data-lucide="package"></i></div>
            <div class="torrent-name-col">
                <div class="torrent-name" title="${e.name}">${e.name}</div>
                <div class="torrent-meta">
                    <span class="meta-peers"><i data-lucide="users" class="inline-icon"></i> ${e.num_leechs}/${e.num_seeds}</span>
                    <span class="meta-eta"><i data-lucide="clock" class="inline-icon"></i> ${le(e.eta)}</span>
                </div>
            </div>
            <div class="size-col">${q(e.total_size)}</div>
            <div class="progress-col">
                <div class="progress-track">
                    <div class="progress-fill" style="width: ${e.progress*100}%"></div>
                </div>
                <div class="progress-text">${(e.progress*100).toFixed(1)}%</div>
            </div>
            <div class="speed-col">
                <div class="speed-down"><i data-lucide="arrow-down" class="inline-icon"></i> ${D(e.dlspeed)}</div>
                <div class="speed-up"><i data-lucide="arrow-up" class="inline-icon"></i> ${D(e.upspeed)}</div>
            </div>
            <div class="actions-col">
                <button class="btn-icon-s action-toggle" title="Pause/Resume">
                    <i data-lucide="${e.state==="pausedDL"||e.state==="pausedUP"?"play":"pause"}"></i>
                </button>
                <button class="btn-icon-s delete action-delete" title="Supprimer"><i data-lucide="trash-2"></i></button>
            </div>
        `,t.querySelector(".action-toggle").addEventListener("click",()=>{let s=e.state==="pausedDL"||e.state==="pausedUP";this.singleAction(s?"resume":"pause",e.hash)}),t.querySelector(".action-delete").addEventListener("click",()=>{confirm(`Supprimer ${e.name} ?`)&&this.singleAction("delete",e.hash)}),t}updateRow(e,t){e.querySelector(".torrent-name").textContent=t.name,e.querySelector(".meta-peers").innerHTML=`<i data-lucide="users" class="inline-icon"></i> ${t.num_leechs}L / ${t.num_seeds}S`,e.querySelector(".meta-eta").innerHTML=`<i data-lucide="clock" class="inline-icon"></i> ${le(t.eta)}`,e.querySelector(".size-col").textContent=q(t.total_size),e.querySelector(".progress-fill").style.width=`${t.progress*100}%`,e.querySelector(".progress-text").textContent=`${(t.progress*100).toFixed(1)}%`,e.querySelector(".speed-down").innerHTML=`<i data-lucide="arrow-down" class="inline-icon"></i> ${D(t.dlspeed)}`,e.querySelector(".speed-up").innerHTML=`<i data-lucide="arrow-up" class="inline-icon"></i> ${D(t.upspeed)}`;let s=e.querySelector(".action-toggle"),n=t.state==="pausedDL"||t.state==="pausedUP"||t.state==="stoppedDL"||t.state==="stoppedUP";s.innerHTML=`<i data-lucide="${n?"play":"pause"}"></i>`,A(),t.state.includes("error")?e.style.borderLeft="4px solid #ef4444":t.progress===1?e.style.borderLeft="4px solid #3b82f6":n?e.style.borderLeft="4px solid #6b7280":e.style.borderLeft="4px solid #10b981"}showAddModal(){this.dom.addModal.classList.add("visible"),this.dom.addOverlay.classList.add("visible"),this.dom.magnetInput.focus()}hideAddModal(){this.dom.addModal.classList.remove("visible"),this.dom.addOverlay.classList.remove("visible"),this.dom.magnetInput.value=""}async addTorrent(){let e=this.dom.magnetInput.value.trim();if(e){this.dom.submitAdd.textContent="Envoi...";try{await fetch("/api/torrent/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({urls:e})}),this.hideAddModal(),this.fetchData()}catch(t){alert("Erreur: "+t.message)}finally{this.dom.submitAdd.textContent="T\xE9l\xE9charger"}}}async handleFileSelect(e){let t=e.target.files[0];if(t){if(!t.name.endsWith(".torrent")){alert("Veuillez s\xE9lectionner un fichier .torrent");return}await this.addTorrentFile(t),e.target.value=""}}async addTorrentFile(e){let t=new FormData;t.append("torrents",e);let s=this.dom.addBtn.innerHTML;this.dom.addBtn.disabled=!0,this.dom.addBtn.innerHTML='<span class="btn-loader"></span>';try{let n=await fetch("/api/torrent/add-file",{method:"POST",body:t});if(n.ok)this.fetchData();else{let i=await n.json();alert("Erreur: "+(i.error||"\xC9chec de l'ajout du torrent"))}}catch(n){console.error(n),alert("Erreur de connexion")}finally{this.dom.addBtn.disabled=!1,this.dom.addBtn.innerHTML=s,A()}}async singleAction(e,t){try{await fetch(`/api/torrent/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hashes:t})}),setTimeout(()=>this.fetchData(),200)}catch(s){console.error(s)}}async globalAction(e){let t=Array.from(this.cache.keys()).join("|");t&&(await fetch(`/api/torrent/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({hashes:t})}),setTimeout(()=>this.fetchData(),500))}}});var te,Ce=L(()=>{te=class{constructor(){this.socket=io(),this.myId=null,this.peers=new Map,this.dataChannels=new Map,this.devicesGrid=document.getElementById("devicesGrid"),this.fileInput=document.getElementById("localdropFileInput"),this.modal=document.getElementById("transferModal"),this.targetPeerId=null,this.initSocket(),this.initEvents()}initShare(e){let t=window.location.hostname,s=window.location.port;(t==="localhost"||t==="127.0.0.1")&&e&&(t=e);let n=`http://${t}${s?":"+s:""}/#localdrop`,i=document.getElementById("localUrlDisplay");i&&(i.textContent=n);let a=document.getElementById("copyUrlBtn");a&&a.addEventListener("click",()=>{navigator.clipboard.writeText(n);let o=a.innerHTML;a.innerHTML='<i data-lucide="check"></i>',window.lucide&&window.lucide.createIcons(),setTimeout(()=>{a.innerHTML=o,window.lucide&&window.lucide.createIcons()},2e3)});let l=document.getElementById("qrcode");l&&window.QRCode&&(l.innerHTML="",new QRCode(l,{text:n,width:120,height:120,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.H}))}initSocket(){this.socket.on("init",e=>{this.myId=e.id;let t=document.getElementById("myName"),s=document.getElementById("myAvatar");t&&(t.textContent=e.name),s&&(s.textContent=e.name.charAt(0),s.style.background=this.getAvatarColor(e.name)),this.initShare(e.serverIp)}),this.socket.on("clients-list",e=>{e.forEach(t=>this.addDeviceCard(t))}),this.socket.on("client-connected",e=>{this.addDeviceCard(e)}),this.socket.on("client-disconnected",e=>{this.removeDeviceCard(e),this.peers.has(e)&&(this.peers.get(e).close(),this.peers.delete(e)),this.dataChannels.delete(e)}),this.socket.on("signal",async({from:e,signal:t})=>{this.peers.has(e)||this.createPeerConnection(e,!1);let s=this.peers.get(e);try{if(t.type==="offer"){await s.setRemoteDescription(new RTCSessionDescription(t));let n=await s.createAnswer();await s.setLocalDescription(n),this.socket.emit("signal",{to:e,from:this.myId,signal:n})}else t.type==="answer"?await s.setRemoteDescription(new RTCSessionDescription(t)):t.candidate&&await s.addIceCandidate(new RTCIceCandidate(t))}catch(n){console.error("Signal error:",n)}})}initEvents(){this.fileInput.addEventListener("change",e=>{let t=e.target.files[0];t&&this.targetPeerId&&this.sendFile(this.targetPeerId,t)})}getAvatarColor(e){let t=["#3b82f6","#10b981","#ef4444","#f59e0b","#8b5cf6","#ec4899","#06b6d4"],s=0;for(let n=0;n<e.length;n++)s=e.charCodeAt(n)+((s<<5)-s);return t[Math.abs(s)%t.length]}addDeviceCard(e){let t=this.devicesGrid.querySelector(".no-devices");if(t&&t.remove(),document.getElementById(`device-${e.id}`))return;let s=document.createElement("div");s.id=`device-${e.id}`,s.className="device-card",s.innerHTML=`
            <div class="device-avatar" style="background: ${this.getAvatarColor(e.name)}">${e.name.charAt(0)}</div>
            <div class="device-name">${e.name}</div>
        `,s.addEventListener("click",()=>{this.targetPeerId=e.id,this.fileInput.click()}),this.devicesGrid.appendChild(s)}removeDeviceCard(e){let t=document.getElementById(`device-${e}`);t&&t.remove(),this.devicesGrid.children.length===0&&(this.devicesGrid.innerHTML=`
                <div class="no-devices">
                    <div class="no-devices-icon"><i data-lucide="radar"></i></div>
                    <p>Recherche d'autres appareils sur le r\xE9seau...</p>
                    <p class="subtext">Ouvrez Ultra Dashboard sur un autre appareil pour le voir ici.</p>
                </div>
            `,window.lucide&&window.lucide.createIcons())}createPeerConnection(e,t){let s=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});if(this.peers.set(e,s),s.onicecandidate=n=>{n.candidate&&this.socket.emit("signal",{to:e,from:this.myId,signal:n.candidate})},t){let n=s.createDataChannel("fileTransfer");this.setupDataChannel(e,n),s.createOffer().then(i=>{s.setLocalDescription(i),this.socket.emit("signal",{to:e,from:this.myId,signal:i})})}else s.ondatachannel=n=>{this.setupDataChannel(e,n.channel)};return s}setupDataChannel(e,t){this.dataChannels.set(e,t);let s=[],n=null;t.onopen=()=>console.log(`Data Channel open with ${e}`),t.onclose=()=>console.log(`Data Channel closed with ${e}`),t.onmessage=i=>{let a=i.data;if(typeof a=="string"){let l=JSON.parse(a);l.type==="metadata"&&(n=l.data,s=[],this.showTransferModal(n.name,"R\xE9ception..."))}else{s.push(a);let l=Math.round(s.length*16384/n.size*100);if(this.updateProgress(l),s.length*16384>=n.size){let o=new Blob(s),d=URL.createObjectURL(o);this.updateProgress(100);let u=document.getElementById("transferStatus");u.innerHTML=`Transfert termin\xE9 ! <br><a href="${d}" download="${n.name}" class="btn-primary btn-sm" style="display:inline-block; margin-top:10px; text-decoration:none; padding: 5px 10px; background: var(--primary); color: white; border-radius: 4px;">T\xE9l\xE9charger ${n.name}</a>`;let h=u.querySelector("a");h.onclick=()=>{setTimeout(()=>{URL.revokeObjectURL(d),this.hideTransferModal(),u.textContent="Pr\xEAt"},1e3)}}}}}async sendFile(e,t){if(this.peers.has(e))this.dataChannels.get(e).readyState==="open"?this._performSend(e,t):this._performSend(e,t);else{this.createPeerConnection(e,!0);let s=setInterval(()=>{let n=this.dataChannels.get(e);n&&n.readyState==="open"&&(clearInterval(s),this._performSend(e,t))},100)}}_performSend(e,t){let s=this.dataChannels.get(e);if(!s)return;this.showTransferModal(t.name,`Envoi vers ${e}...`),s.send(JSON.stringify({type:"metadata",data:{name:t.name,size:t.size,type:t.type}}));let n=16384,i=new FileReader,a=0;i.onload=o=>{s.send(o.target.result),a+=o.target.result.byteLength;let d=Math.round(a/t.size*100);this.updateProgress(d),a<t.size?l():setTimeout(()=>this.hideTransferModal(),1e3)};let l=()=>{let o=t.slice(a,a+n);i.readAsArrayBuffer(o)};l()}showTransferModal(e,t){this.modal.classList.remove("hidden"),document.getElementById("transferFileName").textContent=e,document.getElementById("transferStatus").textContent=t,this.updateProgress(0)}updateProgress(e){e=Math.min(e,100),document.getElementById("transferPercent").textContent=`${e}%`,document.getElementById("transferProgressFill").style.width=`${e}%`}hideTransferModal(){this.modal.classList.add("hidden")}}});var se,xe=L(()=>{M();se=class{constructor(){this.widgets=[],this.locked=!1,this.initialized=!1,this.init()}async init(){if(this.initialized)return;let e=[{id:"clock",type:"clock",title:"Heure & Date",w:6},{id:"weather",type:"weather",title:"M\xE9t\xE9o",w:3},{id:"quick-actions",type:"quick-actions",title:"Actions Rapides",w:3}];this.widgets=await m.get("ultra-home-widgets",e),this.locked=await m.get("ultra-home-locked",!1),this.renderWidgets(),this.startClock(),this.bindEvents(),this.updateAllWeather(),this.initialized=!0,console.log("\u{1F3E0} Home Module Initialized (SQLite)")}bindEvents(){let e=document.getElementById("addWidgetBtn"),t=document.getElementById("lockWidgetsBtn"),s=document.getElementById("closeWidgetStore"),n=document.getElementById("widgetStoreOverlay");e&&e.addEventListener("click",()=>this.openWidgetStore()),t&&(t.addEventListener("click",()=>this.toggleLock()),this.updateLockUI()),s&&s.addEventListener("click",()=>this.closeWidgetStore()),n&&n.addEventListener("click",u=>{u.target===n&&this.closeWidgetStore()}),document.querySelectorAll(".store-item").forEach(u=>{u.addEventListener("click",()=>{let h=u.dataset.widgetType;this.addWidget(h),this.closeWidgetStore()})});let a=document.getElementById("closeWidgetSettings");a&&a.addEventListener("click",()=>this.closeWidgetSettings());let l=document.getElementById("saveWidgetSettings");l&&l.addEventListener("click",()=>this.saveCurrentWidgetSettings());let o=document.getElementById("widgetSettingsOverlay");o&&o.addEventListener("click",u=>{u.target===o&&this.closeWidgetSettings()}),document.querySelectorAll(".store-nav-item").forEach(u=>{u.addEventListener("click",()=>{this.filterStoreByCategory(u.dataset.category)})})}openWidgetStore(){let e=document.getElementById("widgetStoreOverlay");e&&e.classList.add("active")}closeWidgetStore(){let e=document.getElementById("widgetStoreOverlay");e&&e.classList.remove("active")}openWidgetSettings(e){let t=this.widgets.find(i=>i.id===e);if(!t)return;this.currentConfiguringWidgetId=e;let s=document.getElementById("widgetSettingsOverlay"),n=document.getElementById("widgetSettingsContent");s&&n&&(n.innerHTML=this.getWidgetSettingsHTML(t),s.classList.add("active"),this.bindSettingsEvents())}closeWidgetSettings(){let e=document.getElementById("widgetSettingsOverlay");e&&e.classList.remove("active"),this.currentConfiguringWidgetId=null}filterStoreByCategory(e){document.querySelectorAll(".store-nav-item").forEach(s=>{s.classList.toggle("active",s.dataset.category===e)}),document.querySelectorAll(".store-item").forEach(s=>{let n=s.dataset.categories||"";e==="all"?s.style.display="flex":s.style.display=n.includes(e)?"flex":"none"})}async toggleLock(){this.locked=!this.locked,await m.set("ultra-home-locked",this.locked),this.updateLockUI(),this.renderWidgets()}updateLockUI(){let e=document.getElementById("lockWidgetsBtn"),t=document.getElementById("addWidgetBtn");e&&(this.locked?(e.innerHTML='<i data-lucide="lock"></i>',e.classList.add("locked"),e.title="D\xE9verrouiller le dashboard",t&&(t.style.display="none")):(e.innerHTML='<i data-lucide="unlock"></i>',e.classList.remove("locked"),e.title="Verrouiller le dashboard",t&&(t.style.display="flex")),window.lucide&&window.lucide.createIcons())}async addWidget(e){if(this.widgets.find(s=>s.type===e)){console.warn("Widget already exists");return}let t={id:e+"-"+Date.now(),type:e,title:this.getWidgetTitle(e),w:this.getWidgetWidth(e),config:this.getDefaultConfig(e)};this.widgets.push(t),await this.saveWidgets(),this.renderWidgets()}async saveWidgets(){await m.set("ultra-home-widgets",this.widgets)}getWidgetWidth(e){switch(e){case"clock":return 6;case"weather":return 3;case"quick-actions":return 3;case"system":return 3;case"note":return 4;case"news":return 4;case"downloads":return 4;case"notifications":return 4;default:return 3}}getWidgetTitle(e){switch(e){case"clock":return"Heure & Date";case"weather":return"M\xE9t\xE9o";case"quick-actions":return"Actions Rapides";case"system":return"Syst\xE8me";case"note":return"Notes";case"news":return"Actualit\xE9s";case"downloads":return"T\xE9l\xE9chargements";case"notifications":return"Notifications";default:return"Widget"}}getDefaultConfig(e){switch(e){case"news":return{rssUrl:"https://www.franceinfo.fr/titres.rss",limit:4};case"quick-actions":return{actions:["convert","youtube"]};default:return{}}}isConfigurable(e){return["news","quick-actions"].includes(e)}renderWidgets(){let e=document.getElementById("homeWidgetGrid");e&&(e.innerHTML="",this.widgets.forEach(t=>{let s=document.createElement("div");s.id=`widget-instance-${t.id}`,s.className=`widget-card widget-${t.type}`,s.style.gridColumn=`span ${t.w}`,s.innerHTML=this.getWidgetHTML(t);let n=s.querySelector(".btn-remove-widget");n&&n.addEventListener("click",async a=>{a.stopPropagation(),this.widgets=this.widgets.filter(l=>l.id!==t.id),await this.saveWidgets(),this.renderWidgets()});let i=s.querySelector(".btn-widget-settings");i&&i.addEventListener("click",a=>{a.stopPropagation(),this.openWidgetSettings(t.id)}),e.appendChild(s),t.type==="weather"?this.fetchWeatherForWidget(t.id):t.type==="note"?this.initNoteWidget(t.id):t.type==="news"?this.fetchNewsForWidget(t.id):t.type==="downloads"?this.updateDownloadsForWidget(t.id):t.type==="notifications"&&this.updateNotificationsForWidget(t.id)}),window.lucide&&window.lucide.createIcons())}getWidgetHTML(e){let t=`
            <div class="widget-header">
                <span class="widget-title">
                    <i data-lucide="${this.getWidgetIcon(e.type)}"></i> ${e.title}
                </span>
                <div class="widget-controls">
                    ${this.locked?"":`
                        ${this.isConfigurable(e.type)?'<button class="btn-widget-control btn-widget-settings"><i data-lucide="settings"></i></button>':""}
                        <button class="btn-widget-control btn-remove-widget"><i data-lucide="x"></i></button>
                    `}
                </div>
            </div>
        `,s="";switch(e.type){case"clock":s=`
                    <div class="clock-display">
                        <div class="time" id="widgetTime">00:00</div>
                        <div class="date" id="widgetDate">Lundi 1 Janvier</div>
                    </div>
                `;break;case"weather":s=`
                    <div class="weather-content" id="weather-content-${e.id}">
                        <div class="weather-info">
                            <span class="weather-temp">--\xB0C</span>
                            <span class="weather-desc">Chargement...</span>
                        </div>
                        <div class="weather-icon-large">\u23F3</div>
                    </div>
                    <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 8px;" id="weather-location-${e.id}">
                        <i data-lucide="map-pin" style="width: 12px"></i> Localisation...
                    </div>
                `;break;case"quick-actions":let n=e.config?.actions||["convert","youtube"];s=`
                    <div class="quick-actions-grid">
                        ${n.includes("convert")?`
                        <button class="quick-action-btn" onclick="document.querySelector('[data-tab=\\'convert\\']').click()">
                            <i data-lucide="refresh-cw"></i> <span>Convertir</span>
                        </button>`:""}
                        ${n.includes("youtube")?`
                        <button class="quick-action-btn" onclick="document.querySelector('[data-tab=\\'youtube\\']').click()">
                            <i data-lucide="youtube"></i> <span>YouTube</span>
                        </button>`:""}
                        ${n.includes("torrent")?`
                        <button class="quick-action-btn" onclick="document.querySelector('[data-tab=\\'torrent\\']').click()">
                            <i data-lucide="download"></i> <span>Torrents</span>
                        </button>`:""}
                        ${n.includes("databank")?`
                        <button class="quick-action-btn" onclick="document.querySelector('[data-tab=\\'databank\\']').click()">
                            <i data-lucide="database"></i> <span>Databank</span>
                        </button>`:""}
                        ${n.includes("chat")?`
                        <button class="quick-action-btn" onclick="document.querySelector('[data-tab=\\'chat\\']').click()">
                            <i data-lucide="message-square"></i> <span>AI Chat</span>
                        </button>`:""}
                    </div>
                `;break;case"note":s=`
                    <textarea id="note-${e.id}" placeholder="\xC9crire une note..."></textarea>
                `;break;case"news":s=`
                    <div class="news-list" id="news-list-${e.id}">
                        <div style="color: var(--text-muted); padding: 20px; text-align: center;">Chargement des actus...</div>
                    </div>
                `;break;case"downloads":s=`
                    <div class="download-status-list" id="download-list-${e.id}">
                        <div style="color: var(--text-muted); padding: 20px; text-align: center;">Aucun t\xE9l\xE9chargement actif</div>
                    </div>
                `;break;case"notifications":s=`
                    <div class="notifications-list" id="notifications-list-${e.id}">
                        <div style="color: var(--text-muted); padding: 20px; text-align: center;">Aucune notification</div>
                    </div>
                `;break;default:s='<div style="padding: 20px; text-align: center; color: var(--text-muted)">Contenu du widget...</div>'}return t+s}async initNoteWidget(e){let t=document.getElementById(`note-${e}`);t&&(t.value=await m.get(`ultra-note-${e}`,""),t.addEventListener("input",async s=>{await m.set(`ultra-note-${e}`,s.target.value)}))}async fetchNewsForWidget(e){let t=document.getElementById(`news-list-${e}`);if(!t)return;let s=this.widgets.find(a=>a.id===e),n=s?.config?.rssUrl||"https://www.franceinfo.fr/titres.rss",i=s?.config?.limit||4;try{let a=`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(n)}`,o=await(await fetch(a)).json();if(o.status==="ok"){let d=o.items.slice(0,i);t.innerHTML=d.map(u=>`
                    <a href="${u.link}" target="_blank" class="news-item">
                        <span class="news-title">${u.title}</span>
                        <span class="news-meta">${o.feed.title||"RSS"} \u2022 ${new Date(u.pubDate).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"})}</span>
                    </a>
                `).join("")}else throw new Error("RSS conversion failed")}catch(a){console.error("News fetch error:",a),t.innerHTML='<div style="color: var(--error); font-size: 0.82rem; text-align: center; padding: 15px;">Impossible de charger les actualit\xE9s.</div>'}}async updateDownloadsForWidget(e){let t=document.getElementById(`download-list-${e}`);if(t)try{let s=await fetch("/api/torrent/list");if(s.ok){let n=await s.json(),i=(Array.isArray(n)?n:[]).filter(a=>a.progress<1).slice(0,2);i.length>0?t.innerHTML=i.map(a=>`
                        <div class="download-item">
                            <div class="download-info">
                                <span class="download-name">${a.name}</span>
                                <span class="download-percent">${Math.round(a.progress*100)}%</span>
                            </div>
                            <div class="progress-bar-bg">
                                <div class="progress-bar-fill" style="width: ${a.progress*100}%"></div>
                            </div>
                        </div>
                    `).join(""):t.innerHTML='<div style="color: var(--text-muted); font-size: 0.85rem; text-align: center; padding: 10px;">Aucun t\xE9l\xE9chargement en cours</div>'}}catch{t.innerHTML='<div style="color: var(--text-muted); font-size: 0.85rem; text-align: center; padding: 10px;">Service indisponible</div>'}}async updateNotificationsForWidget(e){let t=document.getElementById(`notifications-list-${e}`);if(!t)return;let n=(await m.get("ultra-notifications",[])).slice(0,3);n.length>0?(t.innerHTML=n.map(i=>`
                <div class="notification-item ${i.type} ${i.read?"read":"unread"}">
                    <div class="notification-icon">
                        <i data-lucide="${i.icon||"bell"}"></i>
                    </div>
                    <div class="notification-body">
                        <div class="notification-header-row">
                            <span class="notification-title">${i.title}</span>
                            <span class="notification-time">${this.formatRelativeTime(i.time)}</span>
                        </div>
                        <div class="notification-message">${i.message||""}</div>
                    </div>
                </div>
            `).join(""),window.lucide&&window.lucide.createIcons()):t.innerHTML='<div style="color: var(--text-muted); font-size: 0.85rem; text-align: center; padding: 20px;">Tout est en ordre !</div>'}formatRelativeTime(e){let t=new Date(e),n=new Date-t;if(isNaN(n))return"R\xE9cemment";if(n<6e4)return"\xC0 l'instant";let i=Math.floor(n/6e4);if(i<60)return`Il y a ${i}m`;let a=Math.floor(i/60);return a<24?`Il y a ${a}h`:t.toLocaleDateString("fr-FR",{day:"numeric",month:"short"})}updateAllWeather(){this.widgets.filter(e=>e.type==="weather").forEach(e=>this.fetchWeatherForWidget(e.id))}async fetchWeatherForWidget(e){let t={latitude:48.8566,longitude:2.3522,name:"Paris, France"};if(!navigator.geolocation){this.fetchWeatherFromAPI(e,t.latitude,t.longitude,t.name);return}navigator.geolocation.getCurrentPosition(async s=>{let{latitude:n,longitude:i}=s.coords;this.fetchWeatherFromAPI(e,n,i,"Position actuelle")},s=>{this.fetchWeatherFromAPI(e,t.latitude,t.longitude,t.name)},{timeout:5e3})}async fetchWeatherFromAPI(e,t,s,n){try{let i=`https://api.open-meteo.com/v1/forecast?latitude=${t}&longitude=${s}&current_weather=true&timezone=auto`,l=await(await fetch(i)).json();if(l.current_weather){let o={temp:Math.round(l.current_weather.temperature),code:l.current_weather.weathercode,lat:t,lon:s,locationName:n};this.updateWeatherUI(e,o)}}catch(i){console.error("Weather fetch error:",i),this.updateWeatherUI(e,{error:"Erreur API"})}}updateWeatherUI(e,t){let s=document.getElementById(`weather-content-${e}`),n=document.getElementById(`weather-location-${e}`);if(!s)return;if(t.error){s.innerHTML=`<div style="color: var(--error); font-size: 0.9rem; padding: 10px;">${t.error}</div>`;return}let i=this.getWeatherIconByCode(t.code),a=this.getWeatherDescByCode(t.code);s.innerHTML=`
            <div class="weather-info">
                <span class="weather-temp">${t.temp}\xB0C</span>
                <span class="weather-desc">${a}</span>
            </div>
            <div class="weather-icon-large">${i}</div>
        `,n&&(n.innerHTML=`<i data-lucide="map-pin" style="width: 12px"></i> ${t.locationName||"Position actuelle"}`,window.lucide&&window.lucide.createIcons())}getWeatherIconByCode(e){return e===0?"\u2600\uFE0F":e<=3?"\u{1F324}\uFE0F":e<=48?"\u2601\uFE0F":e<=67?"\u{1F327}\uFE0F":e<=77?"\u2744\uFE0F":e<=82?"\u{1F327}\uFE0F":e<=99?"\u26A1":"\u2600\uFE0F"}getWeatherDescByCode(e){return{0:"Ciel d\xE9gag\xE9",1:"Principalement d\xE9gag\xE9",2:"Partiellement nuageux",3:"Couvert",45:"Brouillard",48:"Brouillard givrant",51:"Bruine l\xE9g\xE8re",53:"Bruine mod\xE9r\xE9e",55:"Bruine dense",61:"Pluie l\xE9g\xE8re",63:"Pluie mod\xE9r\xE9e",65:"Pluie forte",71:"Neige l\xE9g\xE8re",73:"Neige mod\xE9r\xE9e",75:"Neige forte",80:"Averses de pluie l\xE9g\xE8res",81:"Averses de pluie mod\xE9r\xE9es",82:"Averses de pluie violentes",95:"Orage",96:"Orage avec gr\xEAle l\xE9g\xE8re",99:"Orage avec gr\xEAle forte"}[e]||"Ensoleill\xE9"}getWidgetIcon(e){switch(e){case"clock":return"clock";case"weather":return"cloud-sun";case"quick-actions":return"zap";case"system":return"cpu";case"note":return"sticky-note";case"news":return"newspaper";case"downloads":return"download";case"notifications":return"bell";default:return"layout"}}startClock(){let e=()=>{let t=document.getElementById("widgetTime"),s=document.getElementById("widgetDate");if(t&&s){let n=new Date;t.textContent=n.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),s.textContent=n.toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long"})}};e(),setInterval(e,1e3)}getWidgetSettingsHTML(e){switch(e.type){case"news":return`
                    <div class="widget-config-form">
                        <div class="config-group">
                            <label>URL du flux RSS</label>
                            <input type="url" id="config-rss-url" value="${e.config?.rssUrl||""}" placeholder="https://example.com/rss">
                        </div>
                        <div class="config-group">
                            <label>Nombre d'actualit\xE9s</label>
                            <input type="number" id="config-rss-limit" value="${e.config?.limit||4}" min="1" max="10">
                        </div>
                    </div>
                `;case"quick-actions":let t=e.config?.actions||[];return`
                    <div class="widget-config-form">
                        <label>Actions \xE0 afficher</label>
                        <div class="actions-selector">
                            ${[{id:"convert",label:"Convertir",icon:"refresh-cw"},{id:"youtube",label:"YouTube",icon:"youtube"},{id:"torrent",label:"Torrents",icon:"download"},{id:"databank",label:"Databank",icon:"database"},{id:"chat",label:"AI Chat",icon:"message-square"}].map(n=>`
                                <div class="action-checkbox" data-action-id="${n.id}">
                                    <input type="checkbox" value="${n.id}" ${t.includes(n.id)?"checked":""}>
                                    <i data-lucide="${n.icon}"></i>
                                    <span>${n.label}</span>
                                </div>
                            `).join("")}
                        </div>
                    </div>
                `;default:return`<p style="text-align: center; color: var(--text-muted); padding: 20px;">Ce widget n'a pas de param\xE8tres configurables.</p>`}}bindSettingsEvents(){document.querySelectorAll(".action-checkbox").forEach(t=>{t.addEventListener("click",()=>{let n=t.querySelector("input");n.checked=!n.checked,t.classList.toggle("selected",n.checked)}),t.querySelector("input").checked&&t.classList.add("selected")}),window.lucide&&window.lucide.createIcons()}async saveCurrentWidgetSettings(){let e=this.widgets.find(t=>t.id===this.currentConfiguringWidgetId);if(e){if(e.type==="news"){let t=document.getElementById("config-rss-url").value,s=parseInt(document.getElementById("config-rss-limit").value);e.config={rssUrl:t,limit:s}}else if(e.type==="quick-actions"){let t=Array.from(document.querySelectorAll(".action-checkbox input:checked")).map(s=>s.value);e.config={actions:t}}await this.saveWidgets(),this.closeWidgetSettings(),this.renderWidgets()}}}});var ne,ke=L(()=>{ne=class{constructor(){this.items=[],this.folders=[],this.currentFolderId="root",this.breadcrumbs=[{id:"root",name:"Racine"}],this.currentPage=1,this.limit=20,this.isLoading=!1,this.refreshInterval=null,this.elements={grid:document.getElementById("databankGrid"),refreshBtn:document.getElementById("databankRefreshBtn"),clearBtn:document.getElementById("databankClearBtn"),search:document.getElementById("databankSearch"),filterType:document.getElementById("databankFilterType"),prevBtn:document.getElementById("databankPrevBtn"),nextBtn:document.getElementById("databankNextBtn"),pageInfo:document.getElementById("databankPageInfo"),pagination:document.getElementById("databankPagination"),previewModal:document.getElementById("databankPreviewModal"),closePreviewBtn:document.getElementById("closePreviewModal"),previewBody:document.getElementById("previewBody"),previewTitle:document.getElementById("previewTitle"),previewDownloadBtn:document.getElementById("previewDownloadBtn"),previewMeta:document.getElementById("previewMeta"),newFolderBtn:document.getElementById("databankNewFolderBtn"),breadcrumbs:document.getElementById("databankBreadcrumbs"),folderModal:document.getElementById("databankFolderModal"),closeFolderModal:document.getElementById("closeFolderModal"),confirmFolderBtn:document.getElementById("confirmFolderBtn"),cancelFolderBtn:document.getElementById("cancelFolderBtn"),folderNameInput:document.getElementById("folderName"),moveModal:document.getElementById("databankMoveModal"),closeMoveModal:document.getElementById("closeMoveModal"),folderList:document.getElementById("folderList")},this.init()}escapeHtml(e){return typeof e!="string"?e:e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}sanitizeUrl(e){return!e||e.startsWith("javascript:")?"":this.escapeHtml(e)}init(){this.setupEventListeners(),document.addEventListener("tab-changed",t=>{t.detail.tabId==="databank"?this.onTabActivate():this.onTabDeactivate()});let e=document.querySelector(".tab-content.active");e&&e.id==="tab-databank"&&this.onTabActivate(),window.databankModule=this}onTabActivate(){console.log("\u{1F4CA} Databank Activated"),this.loadItems(),this.startAutoRefresh()}onTabDeactivate(){this.stopAutoRefresh()}startAutoRefresh(){this.stopAutoRefresh(),this.refreshInterval=setInterval(()=>{this.loadItems(null,!0)},3e4)}stopAutoRefresh(){this.refreshInterval&&(clearInterval(this.refreshInterval),this.refreshInterval=null)}setupEventListeners(){this.elements.refreshBtn.addEventListener("click",()=>this.loadItems()),this.elements.clearBtn.addEventListener("click",()=>this.clearAll()),this.elements.search.addEventListener("input",this.debounce(()=>this.loadItems(1),500)),this.elements.filterType.addEventListener("change",()=>this.loadItems(1)),this.elements.prevBtn.addEventListener("click",()=>{this.currentPage>1&&this.loadItems(this.currentPage-1)}),this.elements.nextBtn.addEventListener("click",()=>{this.loadItems(this.currentPage+1)}),this.elements.newFolderBtn.addEventListener("click",()=>{this.elements.folderNameInput.value="",this.elements.folderModal.classList.add("active"),this.elements.folderNameInput.focus()}),this.elements.closeFolderModal.addEventListener("click",()=>this.elements.folderModal.classList.remove("active")),this.elements.cancelFolderBtn.addEventListener("click",()=>this.elements.folderModal.classList.remove("active")),this.elements.confirmFolderBtn.addEventListener("click",()=>this.createFolder()),this.elements.closePreviewBtn.addEventListener("click",()=>{this.elements.previewModal.classList.remove("active")}),this.elements.closeMoveModal.addEventListener("click",()=>this.elements.moveModal.classList.remove("active")),[this.elements.previewModal,this.elements.folderModal,this.elements.moveModal].forEach(e=>{e.addEventListener("click",t=>{t.target===e&&e.classList.remove("active")})})}async loadItems(e=null,t=!1){if(this.isLoading)return;this.isLoading=!0,e&&(this.currentPage=e);let s=(this.currentPage-1)*this.limit,n=this.elements.filterType.value!=="all"?this.elements.filterType.value:"",i=this.elements.search.value.trim();t||(this.elements.grid.innerHTML=`
                <div class="loading-spinner">
                    <div class="spinner"></div>
                    <p>Chargement...</p>
                </div>
            `);try{let a=new URL("/api/databank",window.location.origin);a.searchParams.append("limit",this.limit),a.searchParams.append("offset",s),n&&a.searchParams.append("type",n),i&&a.searchParams.append("search",i),this.currentFolderId!=="all"&&a.searchParams.append("folderId",this.currentFolderId==="root"?"root":this.currentFolderId);let l=[];if(this.currentFolderId!=="all"){let u=new URL("/api/databank/folders",window.location.origin);i&&u.searchParams.append("search",i),this.currentFolderId!=="root"&&!i&&u.searchParams.append("parentId",this.currentFolderId);let h=await fetch(u);h.ok&&(l=(await h.json()).folders||[])}let o=await fetch(a);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);let d=await o.json();this.items=d.items||[],this.folders=l,this.renderItems(),this.renderBreadcrumbs(),this.updatePagination(this.items.length)}catch(a){console.error("Error loading databank:",a),this.elements.grid.innerHTML='<div class="error-message"><p>Erreur lors du chargement des donn\xE9es</p></div>'}finally{this.isLoading=!1}}renderItems(){if(this.elements.grid.innerHTML="",this.items.length===0&&this.folders.length===0){this.elements.grid.innerHTML=`
                <div class="empty-state" style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--text-secondary);">
                    <i data-lucide="database" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
                    <p>Aucune donn\xE9e trouv\xE9e</p>
                </div>
            `,window.lucide&&window.lucide.createIcons();return}this.folders.forEach(e=>{let t=document.createElement("div");t.className="databank-item folder-item",t.innerHTML=`
                <div class="databank-preview">
                    <i data-lucide="folder"></i>
                    <div class="databank-actions">
                        <button class="action-btn" title="Supprimer" onclick="event.stopPropagation(); window.databankModule.deleteFolder(${e.id})">
                            <i data-lucide="trash-2"></i>
                        </button>
                    </div>
                </div>
                <div class="databank-info">
                    <h4>${this.escapeHtml(e.name)}</h4>
                    <p>Dossier</p>
                </div>
            `,t.addEventListener("click",()=>this.navigateToFolder(e.id,e.name)),this.elements.grid.appendChild(t)}),this.items.forEach(e=>{let t=document.createElement("div");t.className="databank-item",e.metadata.tool==="plexus"&&t.classList.add("item-plexus");let s="";if(e.type==="image")s=`<img src="${this.sanitizeUrl(e.content)}" alt="Image" loading="lazy">`;else if(e.type==="audio")s=e.metadata.thumbnail?`<img src="${this.sanitizeUrl(e.metadata.thumbnail)}" alt="Thumb">`:'<i data-lucide="music"></i>';else if(e.type==="video")s=e.metadata.thumbnail?`<img src="${this.sanitizeUrl(e.metadata.thumbnail)}" alt="Thumb">`:'<i data-lucide="video"></i>';else if(e.type==="text"){let o=e.content,d=o.length>200?o.substring(0,200)+"...":o;s=`<div class="text-preview-snippet">${this.escapeHtml(d)}</div>`}else s='<i data-lucide="file-text"></i>';let n=new Date(e.created_at).toLocaleString(),i=e.metadata.originalName||e.metadata.title;!i&&e.type==="text"&&(i=e.content.split(`
`)[0].substring(0,50)),i||(i=`Item #${e.id}`);let a=e.metadata.tool||"Unknown",l=a==="plexus"?"sparkles":"cpu";t.innerHTML=`
                <div class="databank-preview">
                    ${s}
                    <span class="databank-type-badge">${this.escapeHtml(e.type)}</span>
                    <div class="databank-actions">
                        <button class="action-btn" title="T\xE9l\xE9charger" onclick="event.stopPropagation(); window.databankModule.downloadItem(${e.id})">
                            <i data-lucide="download"></i>
                        </button>
                        <button class="move-action" title="D\xE9placer" onclick="event.stopPropagation(); window.databankModule.openMoveModal(${e.id})">
                            <i data-lucide="folder-output"></i>
                        </button>
                        <button class="action-btn" title="Supprimer" onclick="event.stopPropagation(); window.databankModule.deleteItem(${e.id})">
                            <i data-lucide="trash-2"></i>
                        </button>
                    </div>
                </div>
                <div class="databank-info">
                    <h4>${this.escapeHtml(i)}</h4>
                    <p><i data-lucide="${l}" style="width:12px; height:12px;"></i> ${this.escapeHtml(a)} \u2022 ${n}</p>
                </div>
            `,t.addEventListener("click",()=>this.openPreview(e)),this.elements.grid.appendChild(t)}),window.lucide&&window.lucide.createIcons()}renderBreadcrumbs(){this.elements.breadcrumbs.innerHTML="",this.breadcrumbs.forEach((e,t)=>{let s=document.createElement("span");s.className=`breadcrumb-item ${t===this.breadcrumbs.length-1?"active":""}`,s.innerHTML=e.id==="root"?'<i data-lucide="home"></i> Racine':e.name,s.addEventListener("click",()=>this.navigateToBreadcrumb(t)),this.elements.breadcrumbs.appendChild(s)}),window.lucide&&window.lucide.createIcons()}navigateToFolder(e,t){this.currentFolderId=e,this.breadcrumbs.push({id:e,name:t}),this.currentPage=1,this.loadItems()}navigateToBreadcrumb(e){e!==this.breadcrumbs.length-1&&(this.breadcrumbs=this.breadcrumbs.slice(0,e+1),this.currentFolderId=this.breadcrumbs[e].id,this.currentPage=1,this.loadItems())}async createFolder(){let e=this.elements.folderNameInput.value.trim();if(e)try{(await fetch("/api/databank/folders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,parentId:this.currentFolderId==="root"?null:this.currentFolderId})})).ok&&(this.elements.folderModal.classList.remove("active"),this.loadItems())}catch(t){console.error("Error creating folder:",t)}}async deleteFolder(e){if(confirm("Voulez-vous supprimer ce dossier ? Les \xE9l\xE9ments qu'il contient seront d\xE9plac\xE9s vers le parent."))try{await fetch(`/api/databank/folders/${e}`,{method:"DELETE"}),this.loadItems()}catch(t){console.error("Error deleting folder:",t)}}async openMoveModal(e){this.elements.folderList.innerHTML='<div class="loading-spinner"><div class="spinner"></div></div>',this.elements.moveModal.classList.add("active");try{let n=(await(await fetch("/api/databank/folders")).json()).folders||[];this.elements.folderList.innerHTML="";let i=document.createElement("div");i.className="folder-select-item",i.innerHTML='<i data-lucide="home"></i><span>Racine</span>',i.onclick=()=>this.moveItemToFolder(e,null),this.elements.folderList.appendChild(i),n.forEach(a=>{let l=document.createElement("div");l.className="folder-select-item",l.innerHTML=`<i data-lucide="folder"></i><span>${a.name}</span>`,l.onclick=()=>this.moveItemToFolder(e,a.id),this.elements.folderList.appendChild(l)}),window.lucide&&window.lucide.createIcons()}catch(t){console.error("Error loading move folders:",t)}}async moveItemToFolder(e,t){try{await fetch(`/api/databank/${e}/folder`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({folderId:t})}),this.elements.moveModal.classList.remove("active"),this.loadItems()}catch(s){console.error("Error moving item:",s)}}updatePagination(e){this.elements.pagination.classList.toggle("hidden",e<this.limit&&this.currentPage===1),this.elements.pageInfo.textContent=`Page ${this.currentPage}`,this.elements.prevBtn.disabled=this.currentPage===1,this.elements.nextBtn.disabled=e<this.limit}openPreview(e){if(this.elements.previewTitle.textContent=e.metadata.originalName||`Item #${e.id}`,e.type==="image")this.elements.previewBody.innerHTML=`<img src="${this.sanitizeUrl(e.content)}" class="preview-image-full" alt="Preview">`;else if(e.type==="text"){let s=this.escapeHtml(e.content);this.elements.previewBody.innerHTML=`<div class="preview-text-full">${s}</div>`}else if(e.type==="audio"){let s=e.metadata.thumbnail?`<img src="${this.sanitizeUrl(e.metadata.thumbnail)}" class="preview-image-full" style="max-height: 300px;">`:"";s+=`<div style="padding: 20px;"><audio controls style="width: 100%;"><source src="${this.sanitizeUrl(e.content)}"></audio></div>`,this.elements.previewBody.innerHTML=s}else if(e.type==="video")this.elements.previewBody.innerHTML=`<div style="padding: 20px;"><video controls style="width: 100%; max-height: 70vh;"><source src="${this.sanitizeUrl(e.content)}"></video></div>`;else if(e.type==="md"){this.elements.previewBody.innerHTML='<div class="loading-spinner"><div class="spinner"></div><p>Chargement du document...</p></div>';let s=e.content.replace(/\\/g,"/");s.startsWith("/")||(s="/"+s),fetch(s).then(n=>{if(!n.ok)throw new Error("Impossible de charger le fichier");return n.text()}).then(n=>{if(window.marked&&window.marked.parse)try{let a=window.marked.parse(n).replace(/<script\b[^>]*>([\s\S]*?)<\/script>/gim,"").replace(/javascript:/gim,"").replace(/on\w+=/gim,"data-blocked-event=");this.elements.previewBody.innerHTML=`<div class="markdown-preview" style="padding: 20px; max-height: 60vh; overflow-y: auto; background: var(--surface-secondary); border-radius: 8px;">${a}</div>`}catch{this.elements.previewBody.innerText=n}else this.elements.previewBody.innerHTML=`<pre class="preview-text-full" style="white-space: pre-wrap;">${this.escapeHtml(n)}</pre>`}).catch(n=>{this.elements.previewBody.innerHTML=`<div class="error-message" style="padding: 20px; color: var(--error);">Erreur: ${this.escapeHtml(n.message)}</div>`})}else this.elements.previewBody.innerHTML='<div style="text-align: center; padding: 40px;"><i data-lucide="file" style="font-size: 64px;"></i><p>Aper\xE7u non disponible</p></div>';let t=Object.entries(e.metadata).map(([s,n])=>`
            <div class="preview-meta-item">
                <strong>${this.escapeHtml(s)}</strong>
                <span>${this.escapeHtml(String(n||"N/A"))}</span>
            </div>
        `).join("");this.elements.previewMeta.innerHTML=`
            <div class="preview-meta-grid">
                <div class="preview-meta-item"><strong>ID</strong><span>#${e.id}</span></div>
                <div class="preview-meta-item"><strong>Type</strong><span>${e.type}</span></div>
                <div class="preview-meta-item"><strong>Date</strong><span>${new Date(e.created_at).toLocaleString()}</span></div>
                ${t}
            </div>
        `,this.elements.previewDownloadBtn.onclick=()=>this.downloadItem(e.id),this.elements.previewModal.classList.add("active"),window.lucide&&window.lucide.createIcons()}async downloadItem(e){let t=this.items.find(n=>n.id===e);if(!t)return;let s=document.createElement("a");s.href=t.content,s.download=t.metadata.originalName||`item-${e}`,s.click()}async deleteItem(e){if(confirm("Supprimer cet \xE9l\xE9ment ?"))try{await fetch(`/api/databank/${e}`,{method:"DELETE"}),this.loadItems();let t=new CustomEvent("databank-item-deleted",{detail:{id:e}});document.dispatchEvent(t)}catch(t){console.error("Error deleting item:",t)}}async clearAll(){if(confirm("TOUT effacer ? Cette action est irr\xE9versible."))try{await fetch("/api/databank/clear",{method:"POST"}),this.loadItems()}catch(e){console.error("Error clearing all:",e)}}debounce(e,t){let s;return function(...i){let a=()=>{clearTimeout(s),e(...i)};clearTimeout(s),s=setTimeout(a,t)}}}});var ie,Be=L(()=>{M();P();ie=class{constructor(){this.notifications=[],this.initialized=!1,this.init()}async init(){this.initialized||(this.notifications=await m.get("ultra-notifications",[]),this.render(),this.updateBadge(),this.bindEvents(),this.initialized=!0,window.pushNotification=e=>this.push(e),document.addEventListener("app-notification",e=>{this.push(e.detail)}),console.log("\u{1F514} Notification Module Initialized"))}bindEvents(){let e=document.getElementById("clearAllNotifications");e&&e.addEventListener("click",()=>this.clearAll()),document.addEventListener("tab-changed",t=>{t.detail.tabId==="notifications"&&this.markAllAsRead()})}async push({title:e,message:t,type:s="info",icon:n=null}){let i={id:Date.now(),title:e,message:t,type:s,icon:n||this.getDefaultIcon(s),time:new Date().toISOString(),read:!1};this.notifications.unshift(i),this.notifications.length>50&&this.notifications.pop(),await m.set("ultra-notifications",this.notifications),this.render(),this.updateBadge(),Notification.permission==="granted"&&new Notification(e,{body:t})}async markAllAsRead(){let e=!1;this.notifications.forEach(t=>{t.read||(t.read=!0,e=!0)}),e&&(await m.set("ultra-notifications",this.notifications),this.updateBadge(),this.render())}async clearAll(){this.notifications=[],await m.set("ultra-notifications",this.notifications),this.render(),this.updateBadge()}updateBadge(){let e=document.getElementById("notifBadge");if(!e)return;let t=this.notifications.filter(s=>!s.read).length;t>0?(e.hidden=!1,e.textContent=t>9?"9+":t):e.hidden=!0}render(){let e=document.getElementById("notificationsList");e&&(this.notifications.length===0?e.innerHTML=`
                <div class="empty-notifications">
                    <div class="empty-icon">
                        <i data-lucide="bell-off"></i>
                    </div>
                    <h3>${r.t("Aucune notification")}</h3>
                    <p>${r.t("Vos nouvelles notifications appara\xEEtront ici.")}</p>
                </div>
            `:e.innerHTML=this.notifications.map(t=>`
                <div class="notification-item ${t.read?"":"unread"}" data-id="${t.id}">
                    <div class="notification-icon type-${t.type}">
                        <i data-lucide="${t.icon}"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-header">
                            <span class="notification-title">${t.title}</span>
                            <span class="notification-time">${this.formatTime(t.time)}</span>
                        </div>
                        <div class="notification-message">${t.message}</div>
                    </div>
                </div>
            `).join(""),window.lucide&&window.lucide.createIcons())}getDefaultIcon(e){switch(e){case"success":return"check-circle";case"error":return"alert-circle";case"warning":return"alert-triangle";default:return"info"}}formatTime(e){let t=new Date(e),n=new Date-t,i=document.documentElement.getAttribute("lang")||"en";if(n<6e4)return r.t("\xC0 l'instant");let a=new Intl.RelativeTimeFormat(i,{numeric:"auto"});return n<36e5?a.format(-Math.floor(n/6e4),"minute"):n<864e5?a.format(-Math.floor(n/36e5),"hour"):t.toLocaleDateString(i,{day:"numeric",month:"short"})}}});var Ae,Me=L(()=>{M();P();Ae=()=>{let c=document.getElementById("plexusForm"),e=document.getElementById("plexusInput"),t=document.getElementById("plexusSendBtn"),s=document.getElementById("plexusSearchWrapper"),n=document.getElementById("plexusLogoContainer"),i=document.getElementById("plexusSuggestions"),a=document.getElementById("plexusResultsArea"),l=document.getElementById("plexusCurrentQuery"),o=document.getElementById("plexusBackBtn"),d=document.getElementById("plexusThinking"),u=document.getElementById("plexusThinkingSteps"),h=document.getElementById("plexusAnswer"),g=document.getElementById("plexusSourcesList"),E=document.getElementById("plexusFollowup"),y=document.getElementById("plexusFollowupList"),b=!1,w=[];window.lucide&&window.lucide.createIcons(),v();async function v(){try{let f=await(await fetch("/api/plexus/health",{credentials:"same-origin"})).json();f.searxng!=="connected"&&console.warn("[Plexus] SearXNG not connected:",f)}catch(p){console.error("[Plexus] Health check failed:",p)}}function S(){d.classList.remove("hidden"),h.innerHTML="",h.classList.remove("typing");let p=document.getElementById("plexusDeepResearch"),f=p?p.checked:!1;u.innerHTML=`
            <div class="thinking-step active">
                <i data-lucide="${f?"microscope":"search"}"></i>
                <span>${f?r.t("Deep Research: Exploration approfondie..."):r.t("Recherche sur le web...")}</span>
            </div>
        `,window.lucide&&window.lucide.createIcons()}function I(p){let f={searching:{done:[`
                    <div class="thinking-step done">
                        <i data-lucide="check"></i>
                        <span>${r.t("Sources trouv\xE9es")}</span>
                    </div>
                `],active:`
                    <div class="thinking-step active">
                        <i data-lucide="brain"></i>
                        <span>${r.t("Analyse et synth\xE8se...")}</span>
                    </div>
                `},generating:{done:[`
                    <div class="thinking-step done">
                        <i data-lucide="check"></i>
                        <span>${r.t("Sources trouv\xE9es")}</span>
                    </div>`,`<div class="thinking-step done">
                        <i data-lucide="check"></i>
                        <span>${r.t("Analyse termin\xE9e")}</span>
                    </div>
                `],active:`
                    <div class="thinking-step active">
                        <i data-lucide="sparkles"></i>
                        <span>${r.t("R\xE9daction de la r\xE9ponse...")}</span>
                    </div>
                `}};f[p]&&(u.innerHTML=f[p].done.join("")+f[p].active,window.lucide&&window.lucide.createIcons())}function T(){d.classList.add("hidden")}function R(p){if(!p||p.length===0){g.innerHTML=`
                <div style="color: var(--text-muted); font-size: 13px; text-align: center; padding: 20px;">
                    ${r.t("Aucune source trouv\xE9e")}
                </div>
            `;return}g.innerHTML=p.map(f=>{let C=new URL(f.url).hostname,x=`https://www.google.com/s2/favicons?domain=${C}&sz=32`;return`
                <a href="${f.url}" target="_blank" rel="noopener noreferrer" class="plexus-source-card">
                    <div class="plexus-source-header">
                        <img src="${x}" alt="" class="source-favicon">
                        <div class="plexus-source-index">${f.index}</div>
                    </div>
                    <div class="plexus-source-info">
                        <div class="plexus-source-title">${j(f.title)}</div>
                        <div class="plexus-source-url">${C}</div>
                    </div>
                </a>
            `}).join("")}function $e(){g.innerHTML=`
            <div class="plexus-sources-loading">
                <div class="plexus-source-skeleton"></div>
                <div class="plexus-source-skeleton"></div>
                <div class="plexus-source-skeleton"></div>
                <div class="plexus-source-skeleton"></div>
            </div>
        `}function ce(p){T();let f="";window.marked?f=marked.parse(p):f=p.replace(/\n/g,"<br>"),w&&w.length>0&&(f=f.replace(/(\[\d+\])+/g,C=>{let x=C.match(/\d+/g);if(!x)return C;let N=parseInt(x[0])-1,k=w[N];if(k){let U=new URL(k.url).hostname,$=U.replace("www.","").split(".")[0],H=`https://www.google.com/s2/favicons?domain=${U}&sz=32`,F=x.length-1,ae=F>0?`<span class="citation-plus">+${F}</span>`:"";return`<span class="plexus-citation" data-indices="${x.map(oe=>parseInt(oe)-1).join(",")}">
                        <img src="${H}" alt="" class="citation-favicon">
                        <span class="citation-domain">${$}</span>
                        ${ae}
                    </span>`}return C})),h.innerHTML=f,h.querySelectorAll(".plexus-citation").forEach(C=>{C.addEventListener("click",()=>{let x=C.dataset.indices.split(","),N=parseInt(x[0]),k=g.querySelectorAll(".plexus-source-card");k[N]&&(k[N].scrollIntoView({behavior:"smooth",block:"center"}),x.forEach(U=>{let $=k[parseInt(U)];$&&($.classList.add("highlight"),setTimeout(()=>$.classList.remove("highlight"),3e3))}))})})}function De(p){if(!p||p.length===0){E.classList.add("hidden");return}E.classList.remove("hidden"),y.innerHTML=p.map(f=>`
            <button class="plexus-followup-item" data-query="${j(f)}">
                <i data-lucide="corner-down-right"></i>
                <span>${j(f)}</span>
            </button>
        `).join(""),window.lucide&&window.lucide.createIcons(),y.querySelectorAll(".plexus-followup-item").forEach(f=>{f.addEventListener("click",()=>{let C=f.dataset.query;W(C)})})}function Re(p){s.classList.add("hidden"),a.classList.remove("hidden"),l.textContent=p}function Ne(){a.classList.add("hidden"),s.classList.remove("hidden"),e.value="",e.focus()}async function W(p){if(!b&&(p=p.trim(),!!p)){b=!0,t.disabled=!0,Re(p),S(),$e(),E.classList.add("hidden");try{let f=await m.get("ultra-plexus-source-count",3),C=await m.get("ultra-plexus-extra-info",""),x=document.getElementById("plexusDeepResearch"),N=x?x.checked:!1,k=await fetch("/api/plexus/search",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify({query:p,settings:{sourceCount:f,extraInfo:C,deepResearch:N}})});if(!k.ok)throw new Error(`Erreur serveur: ${k.status}`);let U=k.body.getReader(),$=new TextDecoder,H="",F="";for(;;){let{done:ae,value:oe}=await U.read();if(ae)break;let Ue=$.decode(oe,{stream:!0});F+=Ue;let de=F.split(`
`);F=de.pop();for(let ue of de)if(ue.trim())try{let B=JSON.parse(ue);if(B.type==="sources")w=B.data||[],I("searching"),R(w),await new Promise(G=>setTimeout(G,200)),I("generating");else if(B.type==="chunk")H+=B.content,ce(H);else if(B.type==="done"){T();let G=H.replace(/(?:\*\*|#)?\s*QUESTIONS_SUIVI\s*(?:\*\*|#)?\s*:?\s*([\s\S]+)$/i,"").trim();G&&ce(G),De(B.followUpQuestions)}else if(B.type==="error")throw new Error(B.message)}catch(B){console.warn("Error parsing stream line:",B)}}b=!1,t.disabled=!1}catch(f){console.error("[Plexus] Search error:",f),T(),h.innerHTML=`
                <div style="color: var(--error); padding: 20px; text-align: center;">
                    <p><strong>${r.t("Erreur lors de la recherche")}</strong></p>
                    <p style="font-size: 13px; margin-top: 8px;">${j(f.message)}</p>
                </div>
            `}finally{b=!1,t.disabled=!1}}}function j(p){let f=document.createElement("div");return f.textContent=p,f.innerHTML}c.addEventListener("submit",p=>{p.preventDefault(),W(e.value)}),e.addEventListener("keydown",p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),W(e.value))}),e.addEventListener("input",function(){this.style.height="auto",this.style.height=Math.min(this.scrollHeight,120)+"px"}),o.addEventListener("click",Ne),i.querySelectorAll(".plexus-suggestion").forEach(p=>{p.addEventListener("click",()=>{let f=p.dataset.query;W(f)})})}});var z,Pe=L(()=>{P();z=class{static async check(){try{return(await(await fetch("/api/auth/status")).json()).authenticated?(this.hideOverlay(),!0):(this.showOverlay(),!1)}catch(e){return console.error("Auth check failed:",e),this.showOverlay(),!1}}static showOverlay(){let e=document.getElementById("authOverlay"),t=document.querySelector(".app");e&&e.classList.remove("hidden"),t&&(t.style.display="none"),window.lucide&&window.lucide.createIcons()}static hideOverlay(){let e=document.getElementById("authOverlay"),t=document.querySelector(".app");e&&e.classList.add("hidden"),t&&(t.style.display="flex")}static async init(){let e=document.getElementById("authForm");if(!e)return;let t=document.getElementById("setupNotice"),s=document.getElementById("authTitle"),n=document.getElementById("authSubtitle"),i=document.getElementById("authSubmit"),a=i.querySelector(".btn-text"),l=document.getElementById("authToggleBtn"),o=document.getElementById("authToggleText"),d=!1,u=!1;try{(await(await fetch("/api/auth/status")).json()).needsSetup&&(d=!0,t.classList.remove("hidden"),n.textContent=r.t("Configuration initiale"),a.textContent=r.t("Cr\xE9er le compte"),l&&(l.parentElement.style.display="none"))}catch{}l&&l.addEventListener("click",h=>{h.preventDefault(),u=!u,u?(n.textContent=r.t("Cr\xE9ation de compte"),a.textContent=r.t("S'inscrire"),o.textContent=r.t("D\xE9j\xE0 un compte ?"),l.textContent=r.t("Se connecter")):(n.textContent=r.t("Authentification requise"),a.textContent=r.t("Se connecter"),o.textContent=r.t("Pas de compte ?"),l.textContent=r.t("Cr\xE9er un compte"))}),e.addEventListener("submit",async h=>{h.preventDefault();let g=document.getElementById("authUsername").value,E=document.getElementById("authPassword").value,y=document.getElementById("authError");y.classList.add("hidden"),i.disabled=!0,a.textContent=r.t("Traitement...");try{let b="/api/auth/login";d?b="/api/auth/setup":u&&(b="/api/auth/register");let w=await fetch(b,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:g,password:E})}),v=await w.json();w.ok?window.location.reload():(y.textContent=v.error||r.t("Erreur de connexion"),y.classList.remove("hidden"),i.disabled=!1,d?a.textContent=r.t("Cr\xE9er le compte"):u?a.textContent=r.t("S'inscrire"):a.textContent=r.t("Se connecter"))}catch{y.textContent=r.t("Erreur serveur"),y.classList.remove("hidden"),i.disabled=!1,d?a.textContent=r.t("Cr\xE9er le compte"):u?a.textContent=r.t("S'inscrire"):a.textContent=r.t("Se connecter")}}),this.check()}static async logout(){try{await fetch("/api/auth/logout",{method:"POST"}),window.location.reload()}catch(e){console.error("Logout failed:",e)}}}});var _e=qe(()=>{me();ge();ve();fe();ye();we();Ie();Se();Le();Te();Ce();xe();ke();Be();Me();Pe();P();document.addEventListener("DOMContentLoaded",async()=>{await r.init(),await z.init(),new V,new ie,new Q,new J,new Z,new Y,new K,new ee,new te,new ne,new se,new X,be(),Ee(),Ae(),document.querySelectorAll(".nav-section-header").forEach(s=>{s.addEventListener("click",()=>{s.parentElement.classList.toggle("collapsed")})});let e=document.querySelector(".nav-item.active");if(e){let s=e.closest(".nav-section");s&&s.classList.remove("collapsed")}window.lucide&&window.lucide.createIcons();let t=document.getElementById("logoutBtn");t&&t.addEventListener("click",()=>z.logout()),console.log("\u{1F680} Ultra Dashboard Loaded (Modular)")})});export default _e();
